<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ninebot ES Controller</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
</head>
<body>
  <div class="container">
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
      <h1>üöÄ Ninebot ES Controller</h1>
      <p>–ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∞—à–µ–≥–æ —Å–∞–º–æ–∫–∞—Ç–∞</p>
    </div>

    <!-- –¢–∞–±—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ -->
    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-button active" onclick="switchTab('main')">–û—Å–Ω–æ–≤–Ω–æ–µ</button>
        <button class="tab-button" onclick="switchTab('extended')">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
        <button class="tab-button" onclick="switchTab('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        <button class="tab-button" onclick="switchTab('lights')">–ü–æ–¥—Å–≤–µ—Ç–∫–∞</button>
        <button class="tab-button" onclick="switchTab('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button class="tab-button" onclick="switchTab('system')">–°–∏—Å—Ç–µ–º–∞</button>
        <button class="tab-button" onclick="switchTab('research')">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</button>
        <button class="tab-button" onclick="switchTab('ota')">üîÑ OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ -->
      <div id="main-tab" class="tab-content active">
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="dashboard">
          <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ -->
          <div class="card status-card" id="statusCard">
            <div class="status-icon">üîí</div>
            <div class="status-text" id="statusText">–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù</div>
            <div class="status-subtext" id="statusSubtext">–°–∞–º–æ–∫–∞—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</div>
            
            <div class="data-grid">
              <div class="data-item">
                <div class="data-value" id="batteryValue">0%</div>
                <div class="data-label">–ë–∞—Ç–∞—Ä–µ—è</div>
              </div>
              <div class="data-item">
                <div class="data-value" id="speedValue">0</div>
                <div class="data-label">–∫–º/—á</div>
              </div>
              <div class="data-item">
                <div class="data-value" id="tempValue">0¬∞</div>
                <div class="data-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
              </div>
              <div class="data-item">
                <div class="data-value" id="mileageValue">0</div>
                <div class="data-label">–∫–º</div>
              </div>
            </div>
          </div>

          <!-- –ë—ã—Å—Ç—Ä–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
          <div class="card">
            <h3>‚ö° –ë—ã—Å—Ç—Ä–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <div class="button-grid" style="margin-top: 20px;">
              <button class="btn btn-success" onclick="sendCommand('unlock')">
                <span>üîì</span> –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
              </button>
              <button class="btn btn-danger" onclick="sendCommand('lock')">
                <span>üîí</span> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
              </button>
              <button class="btn btn-primary" onclick="sendCommand('open_deck')">
                <span>üîì</span> –û—Ç–∫—Ä—ã—Ç—å –î–µ–∫—É
              </button>
              <button class="btn btn-warning" onclick="sendCommand('toggle_limit')">
                <span>üìè</span> –õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
              </button>
              <button class="btn btn-primary" onclick="toggleDataRefresh()" id="refreshBtn">
                <span>üîÑ</span> –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
              </button>
            </div>
          </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏ -->
        <div class="control-section">
          <div class="section-title">üéõÔ∏è –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã</div>
          <div class="button-grid">
            <button class="btn btn-info" onclick="sendCommand('mode_normal')">
              <span>üö∂</span> NORMAL
            </button>
            <button class="btn btn-info" onclick="sendCommand('mode_eco')">
              <span>üåø</span> ECO
            </button>
            <button class="btn btn-info" onclick="sendCommand('mode_sport')">
              <span>üèéÔ∏è</span> SPORT
            </button>
          </div>
        </div>

        <!-- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ -->
        <div class="control-section">
          <div class="section-title">üìè –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏</div>
          <div class="button-grid">
            <button class="btn btn-warning" onclick="setSpeedLimit(150)">15 –∫–º/—á</button>
            <button class="btn btn-warning" onclick="setSpeedLimit(200)">20 –∫–º/—á</button>
            <button class="btn btn-warning" onclick="setSpeedLimit(250)">25 –∫–º/—á</button>
            <button class="btn btn-warning" onclick="setSpeedLimit(300)">30 –∫–º/—á</button>
            <button class="btn btn-warning" onclick="setSpeedLimit(350)">35 –∫–º/—á</button>
          </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
        <div class="control-section">
          <div class="section-title">üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</div>
          <div class="button-grid">
            <button class="btn btn-toggle" onclick="sendCommand('headlight_toggle')" id="headlightBtn">
              <span>üí°</span> –§–∞—Ä—ã –í–ö–õ
            </button>
            <button class="btn btn-toggle" onclick="sendCommand('beep_toggle')" id="beepBtn">
              <span>üîä</span> –ó–≤—É–∫ –í–ö–õ
            </button>
            <button class="btn btn-toggle" onclick="sendCommand('cruise_toggle')" id="cruiseBtn">
              <span>‚è±Ô∏è</span> –ö—Ä—É–∏–∑ –û–¢–ö–õ
            </button>
            <button class="btn btn-toggle" onclick="sendCommand('engine_on')" id="engineBtn">
              <span>‚ö°</span> –î–≤–∏–≥–∞—Ç–µ–ª—å –í–ö–õ
            </button>
          </div>
        </div>
      </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è -->
      <div id="research-tab" class="tab-content">
        <div class="dashboard">
          <!-- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ -->
          <div class="card">
            <h3>üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤</h3>
            <p style="margin-bottom: 20px; color: #666;">
              –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ —Å–∞–º–æ–∫–∞—Ç–∞
            </p>

            <div class="scan-controls">
              <button class="scan-btn safe" onclick="startSafeScan()">
                üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—á—Ç–µ–Ω–∏–µ)
              </button>
              <button class="scan-btn warning" onclick="startBruteForceScan()">
                ‚ö†Ô∏è –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞–ø–∏—Å—å)
              </button>
              <button class="scan-btn danger" onclick="startDeepScan()">
                üö® –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
              </button>
            </div>

            <div class="scan-progress">
              <div class="scan-progress-bar" id="scanProgress" style="width: 0%"></div>
            </div>

            <div style="text-align: center; margin: 10px 0;">
              <span id="scanStatus">–ì–æ—Ç–æ–≤ –∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é</span>
              <span id="scanProgressText">0/256</span>
            </div>

            <div class="manual-test">
              <input type="text" id="manualIndex" placeholder="–ò–Ω–¥–µ–∫—Å (hex, –Ω–∞–ø—Ä–∏–º–µ—Ä: 0x70)" style="font-family: monospace">
              <input type="text" id="manualValue" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ (hex, –Ω–∞–ø—Ä–∏–º–µ—Ä: 0x0001)" style="font-family: monospace">
              <button class="btn btn-primary" onclick="manualTest()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <div class="scan-results" id="scanResults">
              <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
          </div>

          <!-- –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã -->
          <div class="card">
            <h3>üéØ –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã</h3>
            <div id="foundRegisters" style="max-height: 300px; overflow-y: auto;">
              <p style="color: #666; text-align: center; padding: 20px;">
                –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
              </p>
            </div>
          </div>

          <!-- –õ–æ–≥ –ø–∞–∫–µ—Ç–æ–≤ -->
          <div class="card">
            <h3>üìã –õ–æ–≥ –ø–∞–∫–µ—Ç–æ–≤</h3>
            <div style="margin-bottom: 15px;">
              <button class="btn btn-primary" onclick="startPacketLog()">–ù–∞—á–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
              <button class="btn btn-danger" onclick="stopPacketLog()">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
              <button class="btn" onclick="clearPacketLog()" style="background: #636e72; color: white;">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="packetLog" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.8rem;">
            </div>
          </div>
          <!-- –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã -->
          <div class="card">
            <h3>üìã –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã</h3>
            <div style="margin-top: 15px;">
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x51, –ö—É—Ä–æ–∫ –≥–∞–∑–∞:</strong> <span id="UnkReg18">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x52, –¢–æ—Ä–º–æ–∑:</strong> <span id="UnkReg19">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x2C(–ö–∞–∫ 56):</strong> <span id="UnkReg8">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x4C(–Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è):</strong> <span id="UnkReg15">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x54(–ö–∞–∫ 56):</strong> <span id="UnkReg20">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x56(–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è1-5):</strong> <span id="UnkReg21">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x57–Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è:</strong> <span id="UnkReg22">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x66(–Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è):</strong> <span id="UnkReg26">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x7F(–Ω–µ —Ç—Ä–æ–≥–∞—Ç—å, –æ—à–∏–±–∫–∞ 32):</strong> <span id="UnkReg28">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x80(–§–∞—Ä–∞:0 - –í—ã–∫–ª,1 - –í–∫–ª, 2 - –°—Ç—Ä–æ–±, –¥–∏—Å–ø–ª–µ–π –≤—ã–∫–ª):</strong> <span id="UnkReg30">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x0:</strong> <span id="UnkReg1">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x1:</strong> <span id="UnkReg2">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0xD:</strong> <span id="UnkReg3">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0xE:</strong> <span id="UnkReg4">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0xF:</strong> <span id="UnkReg5">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x23:</strong> <span id="UnkReg6">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x27:</strong> <span id="UnkReg7">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x2D:</strong> <span id="UnkReg9">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x2E:</strong> <span id="UnkReg10">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x48:</strong> <span id="UnkReg11">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x49:</strong> <span id="UnkReg12">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x4A:</strong> <span id="UnkReg13">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x4B:</strong> <span id="UnkReg14">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x4D:</strong> <span id="UnkReg16">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x4E:</strong> <span id="UnkReg17">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x60:</strong> <span id="UnkReg23">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x61:</strong> <span id="UnkReg24">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x64:</strong> <span id="UnkReg25">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x67:</strong> <span id="UnkReg27">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x7F:</strong> <span id="UnkReg29">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x84:</strong> <span id="UnkReg31">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x8C:</strong> <span id="UnkReg32">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x8D:</strong> <span id="UnkReg33">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x8F:</strong> <span id="UnkReg34">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x9B:</strong> <span id="UnkReg35">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0x9F:</strong> <span id="UnkReg36">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0xC4:</strong> <span id="UnkReg37">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0xC5:</strong> <span id="UnkReg38">N/A</span></p>
              <p><strong>–†–µ–≥–∏—Å—Ç—Ä 0xCF:</strong> <span id="UnkReg39">N/A</span></p>
            </div>
            <div id="packetLog" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.8rem;">
            </div>
          </div>
        </div>
      </div>

      <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <div id="extended-tab" class="tab-content">
        <div class="dashboard">
          <!-- –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div class="card">
            <h3>üîß –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div class="extended-grid">
              <div class="info-item">
                <div class="info-value" id="driveVoltageValue">0.0</div>
                <div class="info-label">–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ (–í)</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="motorCurrentValue">0.0</div>
                <div class="info-label">–¢–æ–∫ (–ê)</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="powerValue">0</div>
                <div class="info-label">–ú–æ—â–Ω–æ—Å—Ç—å (–í—Ç)</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="avgSpeedValue">0</div>
                <div class="info-label">–°—Ä. —Å–∫–æ—Ä–æ—Å—Ç—å</div>
              </div>
            </div>
          </div>

          <!-- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã -->
          <div class="card">
            <h3>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</h3>
            <div class="extended-grid">
              <div class="info-item">
                <div class="info-value" id="bodyTempValue">0¬∞</div>
                <div class="info-label">–ö–æ—Ä–ø—É—Å</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="bat1TempValue">0¬∞</div>
                <div class="info-label">–ë–∞—Ç–∞—Ä–µ—è 1</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="bat2TempValue">0¬∞</div>
                <div class="info-label">–ë–∞—Ç–∞—Ä–µ—è 2</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="mosTempValue">0¬∞</div>
                <div class="info-label">MOS</div>
              </div>
            </div>
          </div>

          <!-- –ë–∞—Ç–∞—Ä–µ–∏ -->
          <div class="card">
            <h3>üîã –ë–∞—Ç–∞—Ä–µ–∏</h3>
            <div class="extended-grid">
              <div class="info-item">
                <div class="info-value" id="battery1Value">0%</div>
                <div class="info-label">–ë–∞—Ç–∞—Ä–µ—è 1</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="battery2Value">0%</div>
                <div class="info-label">–ë–∞—Ç–∞—Ä–µ—è 2</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="actualRangeValue">0</div>
                <div class="info-label">–ó–∞–ø–∞—Å —Ö–æ–¥–∞ (–∫–º)</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="predictedRangeValue">0</div>
                <div class="info-label">–ü—Ä–æ–≥–Ω–æ–∑ (–∫–º)</div>
              </div>
            </div>
          </div>

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
          <div class="card">
            <h3>üìä –°–∏—Å—Ç–µ–º–∞</h3>
            <div style="margin-top: 15px;">
              <p><strong>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä:</strong> <span id="serialValue">N/A</span></p>
              <p><strong>BMS –≤–µ—Ä—Å–∏—è:</strong> <span id="bmsVersionValue">N/A</span></p>
              <p><strong>–í–Ω–µ—à–Ω—è—è BMS:</strong> <span id="bms2VersionValue">N/A</span></p>
              <p><strong>BLE –≤–µ—Ä—Å–∏—è:</strong> <span id="bleVersionValue">N/A</span></p>
              <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="boolStatusValue">N/A</span></p>
              <p><strong>–¢—Ä–µ–≤–æ–≥–∏:</strong> <span id="alarmStatusValue">–ù–µ—Ç</span></p>
              <p><strong>–û—à–∏–±–∫–∏:</strong> <span id="errorValue">0</span></p>
            </div>
          </div>
        </div>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div id="stats-tab" class="tab-content">
        <div class="dashboard">
          <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–µ–∑–¥–æ–∫ -->
          <div class="card">
            <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–µ–∑–¥–æ–∫</h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="singleMileageValue">0</div>
                <div class="stat-label">–ü—Ä–æ–±–µ–≥ –ø–æ–µ–∑–¥–∫–∏ (–∫–º)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="singleRideTimeValue">0</div>
                <div class="stat-label">–í—Ä–µ–º—è –ø–æ–µ–∑–¥–∫–∏ (–º–∏–Ω)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="totalOperationTimeValue">0</div>
                <div class="stat-label">–û–±—â–µ–µ –≤—Ä–µ–º—è (—á)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="totalRideTimeValue">0</div>
                <div class="stat-label">–í—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è (—á)</div>
              </div>
            </div>
          </div>

          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
          <div class="card">
            <h3>üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div style="margin-top: 15px;">
              <p><strong>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</strong> <span id="workModeValue">N/A</span></p>
              <p><strong>–õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏:</strong> <span id="speedLimitValue">0</span> –∫–º/—á</p>
              <p><strong>–ö–æ–¥ –æ—à–∏–±–∫–∏:</strong> <span id="errorCodeValue">0</span></p>
              <p><strong>–ö—Ä—É–∏–∑-–∫–æ–Ω—Ç—Ä–æ–ª—å:</strong> <span id="cruiseValue">–í–´–ö–õ</span></p>
              <p><strong>–§–∞—Ä—ã:</strong> <span id="headlightValue">–í–ö–õ</span></p>
              <p><strong>–ó–≤—É–∫:</strong> <span id="beepValue">–í–ö–õ</span></p>
            </div>
          </div>
        </div>
      </div>

      <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ -->
      <div id="lights-tab" class="tab-content">
        <div class="dashboard">
          <!-- –†–µ–∂–∏–º—ã –ø–æ–¥—Å–≤–µ—Ç–∫–∏ -->
          <div class="card">
            <h3>üåà –†–µ–∂–∏–º—ã –ø–æ–¥—Å–≤–µ—Ç–∫–∏</h3>
            <div class="led-mode-grid">
              <div class="led-mode-btn" onclick="setLedMode(0)" id="ledMode0">–í—ã–∫–ª—é—á–µ–Ω–æ</div>
              <div class="led-mode-btn" onclick="setLedMode(1)" id="ledMode1">–û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ</div>
              <div class="led-mode-btn" onclick="setLedMode(2)" id="ledMode2">–í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ</div>
              <div class="led-mode-btn" onclick="setLedMode(3)" id="ledMode3">–î–≤–∞ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ</div>
              <div class="led-mode-btn" onclick="setLedMode(4)" id="ledMode4">–í—Å–µ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ</div>
              <div class="led-mode-btn" onclick="setLedMode(5)" id="ledMode5">–û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ</div>
              <div class="led-mode-btn" onclick="setLedMode(6)" id="ledMode6">–í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ</div>
              <div class="led-mode-btn" onclick="setLedMode(7)" id="ledMode7">–ü–æ–ª–∏—Ü–∏—è 1</div>
              <div class="led-mode-btn" onclick="setLedMode(8)" id="ledMode8">–ü–æ–ª–∏—Ü–∏—è 2</div>
              <div class="led-mode-btn" onclick="setLedMode(9)" id="ledMode9">–ü–æ–ª–∏—Ü–∏—è 3</div>
            </div>
          </div>

          <!-- –¶–≤–µ—Ç–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ -->
          <div class="card">
            <h3>üé® –¶–≤–µ—Ç–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏</h3>
            <div style="margin: 20px 0;">
              <h4>–¶–≤–µ—Ç 1 (–û—Å–Ω–æ–≤–Ω–æ–π)</h4>
              <div class="color-picker">
                <div class="color-option" style="background: rgb(0, 0, 255);" onclick="setLedColor(1, 0xA0F0)" title="–°–∏–Ω–∏–π"></div>
                <div class="color-option" style="background: rgb(0, 255, 0);" onclick="setLedColor(1, 0x50F0)" title="–ó–µ–ª–µ–Ω—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 0, 0);" onclick="setLedColor(1, 0x00F0)" title="–ö—Ä–∞—Å–Ω—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 0, 255);" onclick="setLedColor(1, 0xC8F0)" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 255, 255);" onclick="setLedColor(1, 0xF0F0)" title="–ë–µ–ª—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 255, 0);" onclick="setLedColor(1, 0xFFF0)" title="–ñ–µ–ª—Ç—ã–π"></div>
              </div>
            </div>
            
            <div style="margin: 20px 0;">
              <h4>–¶–≤–µ—Ç 2 (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π)</h4>
              <div class="color-picker">
                <div class="color-option" style="background: rgb(0, 0, 255);" onclick="setLedColor(2, 0xA0F0)" title="–°–∏–Ω–∏–π"></div>
                <div class="color-option" style="background: rgb(0, 255, 0);" onclick="setLedColor(2, 0x50F0)" title="–ó–µ–ª–µ–Ω—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 0, 0);" onclick="setLedColor(2, 0x00F0)" title="–ö—Ä–∞—Å–Ω—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 0, 255);" onclick="setLedColor(2, 0xC8F0)" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 255, 255);" onclick="setLedColor(2, 0xF0F0)" title="–ë–µ–ª—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 255, 0);" onclick="setLedColor(2, 0xFFF0)" title="–ñ–µ–ª—Ç—ã–π"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div id="settings-tab" class="tab-content">
        <div class="dashboard">
          <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π -->
          <div class="card">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π</h3>
            <div style="margin-top: 20px;">
              <div class="setting-row">
                <span class="setting-label">–§–∞—Ä—ã –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω—ã</span>
                <label class="switch">
                  <input type="checkbox" id="headlightAlwaysOn" onchange="toggleSetting('headlight_always_on', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–°–∫–æ—Ä–æ—Å—Ç—å –≤ MPH (–≤–º–µ—Å—Ç–æ KM/H)</span>
                <label class="switch">
                  <input type="checkbox" id="speedInMPH" onchange="toggleSetting('speed_mph', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–û—Ç–∫–ª—é—á–∏—Ç—å —Ç—Ä–µ–≤–æ–≥—É –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ</span>
                <label class="switch">
                  <input type="checkbox" id="noAlarmLock" onchange="toggleSetting('no_alarm_lock', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">Bluetooth broadcast</span>
                <label class="switch">
                  <input type="checkbox" id="btBroadcast" onchange="toggleSetting('bt_broadcast', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏</span>
                <label class="switch">
                  <input type="checkbox" id="buttonSpeedMode" checked onchange="toggleSetting('button_speed_mode', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>

          <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞ –∏ —Å–≤–µ—Ç–∞ -->
          <div class="card">
            <h3>üîä –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞ –∏ —Å–≤–µ—Ç–∞</h3>
            <div style="margin-top: 20px;">
              <div class="setting-row">
                <span class="setting-label">–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª</span>
                <label class="switch">
                  <input type="checkbox" id="beepAlarm" checked onchange="toggleBeepAlarm(this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–û–±—â–∏–π –∑–≤—É–∫</span>
                <label class="switch">
                  <input type="checkbox" id="beepTotal" checked onchange="toggleBeepTotal(this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–§–∞—Ä—ã</span>
                <label class="switch">
                  <input type="checkbox" id="headlight" checked onchange="toggleHeadlight(this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

            <!-- OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ -->
      <div id="ota-tab" class="tab-content">
        <div class="dashboard">
          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
          <div class="card">
            <h3>üíª –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h3>
            <div id="systemInfo" style="margin-top: 15px;">
              <p><strong>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</strong></p>
            </div>
            <button class="btn btn-primary" onclick="loadSystemInfo()" style="margin-top: 10px;">
              üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            </button>
          </div>

          <!-- OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
          <div class="card">
            <h3>üöÄ OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏</h3>
            <div style="margin: 20px 0;">
              <p><strong>–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:</strong> <span id="currentVersion">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
              <p><strong>–°–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å:</strong> <span id="freeMemory">-</span></p>
              <p><strong>ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> <span id="deviceId">-</span></p>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h4>üì§ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h4>
              <p style="margin-bottom: 15px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ESP8266 –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</p>
              
              <div class="button-grid">
                <a href="/update" target="_blank" class="btn btn-success" style="text-decoration: none;">
                  üì§ –û—Ç–∫—Ä—ã—Ç—å OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                </a>
                <button class="btn btn-info" onclick="checkForUpdates()">
                  üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                </button>
              </div>
              
              <div style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                <p><strong>–õ–æ–≥–∏–Ω:</strong> admin</p>
                <p><strong>–ü–∞—Ä–æ–ª—å:</strong> NinebotOTA123!</p>
              </div>
            </div>

            <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É -->
            <div style="margin-top: 20px;">
              <h4>üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</h4>
              <form id="otaForm" action="/update" method="POST" enctype="multipart/form-data" target="_blank">
                <div style="margin: 15px 0;">
                  <label style="display: block; margin-bottom: 10px; font-weight: bold;">
                    üì§ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏ (.bin):
                  </label>
                  <input type="file" name="update" accept=".bin" required 
                        style="width: 100%; padding: 10px; border: 2px dashed #ddd; border-radius: 8px;">
                </div>
                
                <button type="submit" class="btn btn-warning">
                  ‚ö° –ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
                </button>
              </form>
            </div>
          </div>

          <!-- –°—Ç–∞—Ç—É—Å OTA -->
          <div class="card">
            <h3>üìä –°—Ç–∞—Ç—É—Å OTA</h3>
            <div id="otaStatus" style="margin-top: 15px;">
              <p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> <span id="lastUpdate">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span></p>
              <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="updateStatus">–ì–æ—Ç–æ–≤ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é</span></p>
            </div>
            
            <div class="button-grid" style="margin-top: 15px;">
              <button class="btn btn-info" onclick="testOTAConnection()">
                üß™ –¢–µ—Å—Ç OTA —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
              </button>
              <button class="btn btn-danger" onclick="showOTAInstructions()">
                üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- –°–∏—Å—Ç–µ–º–∞ -->
      <div id="system-tab" class="tab-content">
        <div class="dashboard">
          <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã -->
          <div class="card">
            <h3>üõ†Ô∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>
            <div class="button-grid" style="margin-top: 20px;">
              <button class="btn btn-warning" onclick="sendCommand('find_scooter')">
                <span>üîç</span> –ù–∞–π—Ç–∏ —Å–∞–º–æ–∫–∞—Ç
              </button>
              <button class="btn btn-info" onclick="sendCommand('reboot')">
                <span>üîÑ</span> –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
              </button>
              <button class="btn btn-danger" onclick="sendCommand('power_off')">
                <span>‚≠ï</span> –í—ã–∫–ª—é—á–∏—Ç—å
              </button>
            </div>
          </div>

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
          <div class="card">
            <h3>üíª –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div style="margin-top: 15px;">
              <p><strong>–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –ø–æ–¥—Å–≤–µ—Ç–∫–∏:</strong> <span id="currentLedMode">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span></p>
              <p><strong>–í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:</strong> <span id="fwVersion">N/A</span></p>
              <p><strong>–†–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞:</strong> <span id="workSystem">1</span></p>
              <p><strong>–°—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</strong> <span id="lockStatus">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span></p>
              <p><strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–≤–∏–≥–∞—Ç–µ–ª—è:</strong> <span id="engineStatus">–í–ö–õ</span></p>
            </div>
          </div>

          <!-- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -->
          <div class="card">
            <h3>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
            <div style="margin-top: 15px;">
              <p><strong>–ö–æ–¥ –æ—à–∏–±–∫–∏:</strong> <span id="diagnosticError">0</span></p>
              <p><strong>–ö–æ–¥ —Ç—Ä–µ–≤–æ–≥–∏:</strong> <span id="diagnosticAlarm">0</span></p>
              <p><strong>–ë—É–ª–µ–≤—ã —Å—Ç–∞—Ç—É—Å—ã:</strong> <span id="diagnosticBool">0x0000</span></p>
              <p><strong>–ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞—Ç—É—Å—ã:</strong> <span id="diagnosticQuickBool">0x0000</span></p>
              <button class="btn btn-primary" onclick="loadDiagnostics()" style="margin-top: 10px;">
                –û–±–Ω–æ–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div class="notification" id="notification"></div>

</body>
</html>
—è –º–µ–Ω—è—é –¥–∏–∑–∞–π–Ω, –≤–æ—Ç —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å
<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Ninebot ES Controller</title>
  <style>
    :root {
      --primary: #2d3436;
      --secondary: #636e72;
      --accent: #0984e3;
      --success: #00b894;
      --danger: #d63031;
      --warning: #fdcb6e;
      --info: #6c5ce7;
      --light: #f8f9fa;
      --dark: #2d3436;
      --gray: #dfe6e9;
      --card-bg: #ffffff;
      --body-bg: #f5f6fa;
      --border-radius: 16px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      height: 100%;
      -webkit-text-size-adjust: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
      background: var(--body-bg);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      min-height: -webkit-fill-available;
      padding: 0;
      touch-action: manipulation;
      overscroll-behavior: none;
    }

    /* –ú–æ–±–∏–ª—å–Ω—ã–π header */
    .mobile-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--light);
      color: white;
      padding: calc(12px + var(--safe-top, 0px)) 16px 12px;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      height: 60px;
    }

    .menu-toggle {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      padding: 8px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mobile-title {
      font-size: 1.1rem;
      font-weight: 600;
      flex: 1;
      text-align: center;
      margin: 0 10px;
    }

    .mobile-actions {
      display: flex;
      gap: 8px;
      width: 120px;
      justify-content: flex-end;
    }

    /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .sidebar {
      width: 280px;
      background: var(--light);
      color: white;
      padding: 30px 20px;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      height: 100dvh;
      box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
      z-index: 1001;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      padding-top: max(30px, var(--safe-top, 30px));
      padding-bottom: max(20px, var(--safe-bottom, 20px));
      transform: translateX(-100%);
    }

    .sidebar.mobile-visible {
      transform: translateX(0);
    }

    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: none;
    }

    .sidebar-overlay.active {
      display: block;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
    .main-content {
      flex: 1;
      padding: 0;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding-top: 60px;
      padding-bottom: 80px;
      padding-left: 16px;
      padding-right: 16px;
      width: 100%;
      min-height: 100vh;
      position: relative;
    }

    /* –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å) */
    .mobile-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card-bg);
      border-top: 1px solid var(--gray);
      display: flex;
      justify-content: space-around;
      padding: 8px 4px calc(8px + var(--safe-bottom, 0px));
      z-index: 999;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      height: 80px;
    }

    .mobile-nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 4px;
      border-radius: 12px;
      text-decoration: none;
      color: var(--secondary);
      font-size: 0.7rem;
      transition: var(--transition);
      min-height: 56px;
      cursor: pointer;
      border: none;
      background: transparent;
    }

    .mobile-nav-item.active {
      color: var(--accent);
      background: rgba(9, 132, 227, 0.1);
    }

    .mobile-nav-icon {
      font-size: 20px;
      margin-bottom: 4px;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 16px;
      margin-top: 20px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border: 1px solid transparent;
    }

    .card.interactive {
      cursor: pointer;
    }

    .card.interactive:active {
      transform: scale(0.98);
    }

    /* –ö–Ω–æ–ø–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–∞ */
    .btn {
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-align: center;
      min-height: 48px;
      touch-action: manipulation;
      user-select: none;
      position: relative;
      overflow: hidden;
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-block {
      width: 100%;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--gray);
      color: var(--secondary);
    }

    .btn-outline.active {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(9, 132, 227, 0.1);
    }

    /* –°–≤–∞–π–ø-–ø–∞–Ω–µ–ª—å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .swipe-control {
      background: linear-gradient(135deg, var(--accent), var(--info));
      color: white;
      padding: 20px;
      border-radius: var(--border-radius);
      margin: 16px 0;
      text-align: center;
      position: relative;
      overflow: hidden;
      user-select: none;
    }

    .swipe-track {
      position: relative;
      height: 60px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 30px;
      margin: 20px 0;
      overflow: hidden;
    }

    .swipe-handle {
      position: absolute;
      left: 4px;
      top: 4px;
      background: rgba(255, 255, 255, 0.9);
      color: var(--light);
      height: 52px;
      width: 52px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      cursor: grab;
      touch-action: none;
      z-index: 2;
    }

    .swipe-progress {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      background: rgba(255, 255, 255, 0.3);
      width: 0%;
      transition: width 0.1s;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
    .value-display {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--primary);
      line-height: 1;
      text-align: center;
    }

    .value-unit {
      font-size: 1rem;
      color: var(--secondary);
      font-weight: 500;
    }

    /* –ü–æ–ª–∑—É–Ω–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .slider-container {
      padding: 20px 0;
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: var(--gray);
      outline: none;
      margin: 15px 0;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      border: 3px solid white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    /* –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ –º–µ–Ω—é */
    .action-sheet {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card-bg);
      border-radius: 20px 20px 0 0;
      padding: 20px;
      padding-bottom: calc(20px + var(--safe-bottom, 0px));
      z-index: 1002;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
      max-height: 90vh;
      overflow-y: auto;
    }

    .action-sheet.active {
      transform: translateY(0);
    }

    .action-sheet-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--gray);
    }

    .action-sheet-item {
      padding: 16px;
      border-bottom: 1px solid var(--gray);
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      background: transparent;
      border: none;
      width: 100%;
      text-align: left;
      font-size: 1rem;
      color: var(--dark);
    }

    .action-sheet-item:active {
      background: var(--gray);
    }

    .action-sheet-cancel {
      margin-top: 12px;
      padding: 16px;
      text-align: center;
      color: var(--danger);
      font-weight: 600;
      border-radius: 12px;
      background: rgba(214, 48, 49, 0.1);
      cursor: pointer;
      border: none;
      width: 100%;
    }

    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .notification {
      position: fixed;
      top: 20px;
      left: 16px;
      right: 16px;
      background: var(--card-bg);
      color: var(--dark);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      transform: translateY(-100px);
      transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 1003;
      border-left: 4px solid var(--success);
      display: flex;
      align-items: center;
      gap: 12px;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    .notification.error {
      border-left-color: var(--danger);
    }

    .notification.warning {
      border-left-color: var(--warning);
    }

    .notification.info {
      border-left-color: var(--accent);
    }

    .notification.show {
      transform: translateY(0);
    }

    .notification-icon {
      font-size: 20px;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã */
    @media (max-width: 768px) {
      .grid-2 {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .grid-3 {
        grid-template-columns: repeat(2, 1fr);
      }

      .mobile-nav-item {
        min-height: 52px;
        padding: 6px 2px;
        font-size: 0.65rem;
      }

      .mobile-nav-icon {
        font-size: 18px;
      }

      .swipe-control {
        padding: 16px;
      }

      .swipe-handle {
        width: 50px;
        height: 50px;
      }

      .value-display {
        font-size: 2rem;
      }
    }

    @media (max-width: 480px) {
      .grid-3 {
        grid-template-columns: repeat(2, 1fr);
      }

      .value-display {
        font-size: 1.8rem;
      }

      .mobile-nav-item span {
        font-size: 0.6rem;
      }

      .card {
        padding: 16px;
      }
    }

    /* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ */
    @media (orientation: landscape) and (max-height: 600px) {
      .mobile-nav {
        display: none;
      }

      .main-content {
        padding-bottom: 20px;
      }
    }

    /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media (prefers-color-scheme: dark) {
      :root {
        --primary: #ffffff;
        /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ —á–µ—Ä–Ω–æ–≥–æ */
        --secondary: #b2bec3;
        /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π –¥–ª—è –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
        --accent: #74b9ff;
        /* –ë–æ–ª–µ–µ —Å–≤–µ—Ç–ª—ã–π –≥–æ–ª—É–±–æ–π –¥–ª—è —Ç–µ–º–Ω–æ–≥–æ —Ñ–æ–Ω–∞ */
        --success: #00cec9;
        /* –Ø—Ä–∫–∏–π –±–∏—Ä—é–∑–æ–≤—ã–π */
        --danger: #ff7675;
        /* –ú—è–≥–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π */
        --warning: #fdcb6e;
        /* –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–ø–ª—ã–π –∂–µ–ª—Ç—ã–π */
        --info: #a29bfe;
        /* –ë–æ–ª–µ–µ —Å–≤–µ—Ç–ª—ã–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
        --light: #2d3436;
        /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è —Å–≤–µ—Ç–ª—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        --dark: #ffffff;
        /* –¢–µ–º–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–µ–ª—ã–º */
        --gray: #4a4a4a;
        /* –ë–æ–ª–µ–µ —Ç–µ–º–Ω—ã–π —Å–µ—Ä—ã–π –¥–ª—è –≥—Ä–∞–Ω–∏—Ü */
        --card-bg: #2d3436;
        /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        --body-bg: #1a1a1a;
        /* –ü–æ—á—Ç–∏ —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω */
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.4);
      }

      .mobile-nav {
        background: #2d3436;
        border-top: 1px solid #4a4a4a;
      }

      .action-sheet {
        background: #2d3436;
      }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-slide {
      animation: slideUp 0.3s ease-out;
    }

    /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ zoom –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ iOS */
    input,
    select,
    textarea {
      font-size: 16px !important;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .scrollable {
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }

    /* –°–∫—Ä—ã—Ç–∏–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .scrollable::-webkit-scrollbar {
      display: none;
    }

    /* –í–∫–ª–∞–¥–∫–∏ */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* –õ–æ–≥–æ –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .logo-icon {
      font-size: 32px;
      background: linear-gradient(135deg, var(--accent), var(--info));
      padding: 12px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 56px;
      height: 56px;
    }

    .logo-text h1 {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .logo-text p {
      font-size: 0.85rem;
      opacity: 0.8;
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
    .nav-menu {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
      overflow-y: auto;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border-radius: 12px;
      text-decoration: none;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 500;
      transition: var(--transition);
      cursor: pointer;
      border: none;
      background: transparent;
      text-align: left;
      font-size: 1rem;
    }

    .nav-item:hover,
    .nav-item:active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      transform: translateX(5px);
    }

    .nav-item.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 5px 15px rgba(9, 132, 227, 0.3);
    }

    .nav-item .icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    /* –°—Ç–∞—Ç—É—Å –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
    .status-bar {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid rgba(255, 255, 255, 0.1);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      margin-bottom: 10px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }

      100% {
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <!-- –ú–æ–±–∏–ª—å–Ω—ã–π —Ö–µ–¥–µ—Ä -->
  <div class="mobile-header">
    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
    <div class="mobile-title" id="mobileTitle">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
  </div>

  <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ -->
  <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

  <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="sidebar">
    <div class="logo" style="margin-bottom: 30px;">
      <div class="logo-icon">üõ¥</div>
      <div class="logo-text">
        <h1>Ninebot ES</h1>
        <p>–ú–æ–±–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä</p>
      </div>
    </div>

    <nav class="nav-menu scrollable">
      <button class="nav-item active" onclick="switchTab('dashboard')">
        <span class="icon">üìä</span>
        <span>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
      </button>
      <button class="nav-item" onclick="switchTab('extended')">
        <span class="icon">üîç</span>
        <span>–î–µ—Ç–∞–ª–∏</span>
      </button>
      <button class="nav-item" onclick="switchTab('lights')">
        <span class="icon">üåà</span>
        <span>–ü–æ–¥—Å–≤–µ—Ç–∫–∞</span>
      </button>
      <button class="nav-item" onclick="switchTab('stats')">
        <span class="icon">üìà</span>
        <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
      </button>
      <button class="nav-item" onclick="switchTab('settings')">
        <span class="icon">‚öôÔ∏è</span>
        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
      </button>
      <button class="nav-item" onclick="switchTab('research')">
        <span class="icon">üî¨</span>
        <span>–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</span>
      </button>
      <button class="nav-item" onclick="switchTab('system')">
        <span class="icon">üíª</span>
        <span>–°–∏—Å—Ç–µ–º–∞</span>
      </button>
      <button class="nav-item" onclick="switchTab('ota')">
        <span class="icon">üîÑ</span>
        <span>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
      </button>
    </nav>

    <div class="status-bar">
      <div class="status-indicator">
        <div class="status-dot"></div>
        <div>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</div>
      </div>
      <div style="font-size: 0.85rem; opacity: 0.8; text-align: center; margin-top: 10px;">
        <div>–ë–∞—Ç–∞—Ä–µ—è: <span id="sidebarBattery">0%</span></div>
        <div>–í–µ—Ä—Å–∏—è: 2.1.0</div>
      </div>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
  <div class="main-content scrollable">
    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div id="dashboard-tab" class="tab-content active">
      <!-- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ç—É—Å -->
      <div class="card animate-slide">
        <div class="grid-3">
          <div style="text-align: center;">
            <div class="value-display" id="batteryValue">0<span class="value-unit">%</span></div>
            <div style="font-size: 0.85rem; color: var(--secondary); margin-top: 4px;">–ë–∞—Ç–∞—Ä–µ—è</div>
          </div>
          <div style="text-align: center;">
            <div class="value-display" id="speedValue">0<span class="value-unit">–∫–º/—á</span></div>
            <div style="font-size: 0.85rem; color: var(--secondary); margin-top: 4px;">–°–∫–æ—Ä–æ—Å—Ç—å</div>
          </div>
          <div style="text-align: center;">
            <div class="value-display" id="tempValue">0<span class="value-unit">¬∞C</span></div>
            <div style="font-size: 0.85rem; color: var(--secondary); margin-top: 4px;">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
          </div>
        </div>
      </div>

      <!-- –°–≤–∞–π–ø-–∫–æ–Ω—Ç—Ä–æ–ª—å –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ -->
      <div class="swipe-control animate-slide" id="swipeControl">
        <div style="margin-bottom: 12px; font-weight: 600;">–°–≤–∞–π–ø –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</div>
        <div class="swipe-track">
          <div class="swipe-progress" id="swipeProgress"></div>
          <div class="swipe-handle" id="swipeHandle" ontouchstart="handleSwipeStart(event)"
            ontouchmove="handleSwipeMove(event)" ontouchend="handleSwipeEnd(event)">
            ‚ûú
          </div>
        </div>
        <div style="font-size: 0.85rem; opacity: 0.9; margin-top: 12px;">–ü–æ—Ç—è–Ω–∏—Ç–µ –≤–ø—Ä–∞–≤–æ —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</div>
      </div>

      <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
      <div class="card animate-slide">
        <div style="font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
          <span>‚ö°</span> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
        </div>
        <div class="grid-3">
          <button class="btn btn-outline" onclick="sendCommand('open_deck')"
            style="flex-direction: column; padding: 12px;">
            <span style="font-size: 20px;">üì¶</span>
            <span style="font-size: 0.75rem;">–î–µ–∫a</span>
          </button>
          <button class="btn btn-outline" onclick="sendCommand('find_scooter')"
            style="flex-direction: column; padding: 12px;">
            <span style="font-size: 20px;">üîç</span>
            <span style="font-size: 0.75rem;">–ù–∞–π—Ç–∏</span>
          </button>
          <button class="btn btn-outline" onclick="showActionSheet('power')"
            style="flex-direction: column; padding: 12px;">
            <span style="font-size: 20px;">üîã</span>
            <span style="font-size: 0.75rem;">–ü–∏—Ç–∞–Ω–∏–µ</span>
          </button>
          <button class="btn btn-outline" onclick="toggleDataRefresh()" style="flex-direction: column; padding: 12px;">
            <span style="font-size: 20px;">üîÑ</span>
            <span style="font-size: 0.75rem;">–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
          </button>
        </div>
      </div>

      <!-- –†–µ–∂–∏–º—ã —Å–∫–æ—Ä–æ—Å—Ç–∏ -->
      <div class="card animate-slide">
        <div style="font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
          <span>üéÆ</span> –†–µ–∂–∏–º —Å–∫–æ—Ä–æ—Å—Ç–∏
        </div>
        <div class="grid-3">
          <button class="btn btn-outline" onclick="sendCommand('mode_normal')" style="padding: 12px;">
            –°—Ç–∞–Ω–¥–∞—Ä—Ç
          </button>
          <button class="btn btn-outline" onclick="sendCommand('mode_eco')" style="padding: 12px;">
            –≠–∫–æ
          </button>
          <button class="btn btn-outline active" onclick="sendCommand('mode_sport')" style="padding: 12px;">
            –°–ø–æ—Ä—Ç
          </button>
        </div>
      </div>

      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ -->
      <div class="card animate-slide">
        <div style="font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
          <span>üîß</span> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        </div>
        <div class="grid-2">
          <button class="btn btn-outline" onclick="toggleFunction('headlight')" id="headlightBtn"
            style="padding: 14px;">
            <span>üí°</span> –§–∞—Ä—ã
          </button>
          <button class="btn btn-outline" onclick="toggleFunction('beep')" id="beepBtn" style="padding: 14px;">
            <span>üîä</span> –ó–≤—É–∫
          </button>
        </div>
      </div>

      <!-- –õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ -->
      <div class="card animate-slide">
        <div
          style="font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span>üìè</span> –õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
          </div>
          <div style="font-size: 1.2rem; font-weight: 700;" id="speedLimitValue">35 –∫–º/—á</div>
        </div>
        <div class="slider-container">
          <input type="range" min="15" max="35" value="35" step="5" class="slider" id="speedSlider"
            oninput="updateSpeedLimit(this.value)">
          <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--secondary);">
            <span>15</span>
            <span>20</span>
            <span>25</span>
            <span>30</span>
            <span>35</span>
          </div>
        </div>
      </div>
    </div>

    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
    <div id="extended-tab" class="tab-content">
      <div class="card">
        <h3 style="margin-bottom: 16px;">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <p>–ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –±—É–¥–µ—Ç –∑–¥–µ—Å—å</p>
      </div>
    </div>

    <div id="lights-tab" class="tab-content">
      <div class="card">
        <h3 style="margin-bottom: 16px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π</h3>
        <p>–ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å</p>
      </div>
    </div>

    <div id="stats-tab" class="tab-content">
      <div class="card">
          <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–µ–∑–¥–æ–∫ -->
          <div class="card">
            <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–µ–∑–¥–æ–∫</h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="singleMileageValue">0</div>
                <div class="stat-label">–ü—Ä–æ–±–µ–≥ –ø–æ–µ–∑–¥–∫–∏ (–∫–º)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="singleRideTimeValue">0</div>
                <div class="stat-label">–í—Ä–µ–º—è –ø–æ–µ–∑–¥–∫–∏ (–º–∏–Ω)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="totalOperationTimeValue">0</div>
                <div class="stat-label">–û–±—â–µ–µ –≤—Ä–µ–º—è (—á)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="totalRideTimeValue">0</div>
                <div class="stat-label">–í—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è (—á)</div>
              </div>
            </div>
          </div>

          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
          <div class="card">
            <h3>üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div style="margin-top: 15px;">
              <p><strong>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</strong> <span id="workModeValue">N/A</span></p>
              <p><strong>–õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏:</strong> <span id="speedLimitValue">0</span> –∫–º/—á</p>
              <p><strong>–ö–æ–¥ –æ—à–∏–±–∫–∏:</strong> <span id="errorCodeValue">0</span></p>
              <p><strong>–ö—Ä—É–∏–∑-–∫–æ–Ω—Ç—Ä–æ–ª—å:</strong> <span id="cruiseValue">–í–´–ö–õ</span></p>
              <p><strong>–§–∞—Ä—ã:</strong> <span id="headlightValue">–í–ö–õ</span></p>
              <p><strong>–ó–≤—É–∫:</strong> <span id="beepValue">–í–ö–õ</span></p>
            </div>
          </div>
      </div>
    </div>

    <div id="settings-tab" class="tab-content">
      <div class="card">
        <h3 style="margin-bottom: 16px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <p>–ö–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±—É–¥–µ—Ç –∑–¥–µ—Å—å</p>
      </div>
    </div>

    <div id="research-tab" class="tab-content">
      <div class="card">
        <h3 style="margin-bottom: 16px;">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</h3>
        <p>–ö–æ–Ω—Ç–µ–Ω—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –∑–¥–µ—Å—å</p>
      </div>
    </div>

    <div id="system-tab" class="tab-content">
      <div class="card">
        <h3 style="margin-bottom: 16px;">–°–∏—Å—Ç–µ–º–∞</h3>
        <p>–ö–æ–Ω—Ç–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã –±—É–¥–µ—Ç –∑–¥–µ—Å—å</p>
      </div>
    </div>

    <div id="ota-tab" class="tab-content">
      <div class="card">
          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
          <div class="card">
            <h3>üíª –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h3>
            <div id="systemInfo" style="margin-top: 15px;">
              <p><strong>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</strong></p>
            </div>
            <button class="btn btn-primary" onclick="loadSystemInfo()" style="margin-top: 10px;">
              üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            </button>
          </div>

          <!-- OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
          <div class="card">
            <h3>üöÄ OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏</h3>
            <div style="margin: 20px 0;">
              <p><strong>–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:</strong> <span id="currentVersion">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
              <p><strong>–°–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å:</strong> <span id="freeMemory">-</span></p>
              <p><strong>ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> <span id="deviceId">-</span></p>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h4>üì§ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h4>
              <p style="margin-bottom: 15px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ESP8266 –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</p>
              
              <div class="button-grid">
                <a href="/update" target="_blank" class="btn btn-success" style="text-decoration: none;">
                  üì§ –û—Ç–∫—Ä—ã—Ç—å OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                </a>
                <button class="btn btn-info" onclick="checkForUpdates()">
                  üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                </button>
              </div>
              
              <div style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                <p><strong>–õ–æ–≥–∏–Ω:</strong> admin</p>
                <p><strong>–ü–∞—Ä–æ–ª—å:</strong> NinebotOTA123!</p>
              </div>
            </div>

            <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É -->
            <div style="margin-top: 20px;">
              <h4>üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</h4>
              <form id="otaForm" action="/update" method="POST" enctype="multipart/form-data" target="_blank">
                <div style="margin: 15px 0;">
                  <label style="display: block; margin-bottom: 10px; font-weight: bold;">
                    üì§ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏ (.bin):
                  </label>
                  <input type="file" name="update" accept=".bin" required 
                        style="width: 100%; padding: 10px; border: 2px dashed #ddd; border-radius: 8px;">
                </div>
                
                <button type="submit" class="btn btn-warning">
                  ‚ö° –ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
                </button>
              </form>
            </div>
          </div>

          <!-- –°—Ç–∞—Ç—É—Å OTA -->
          <div class="card">
            <h3>üìä –°—Ç–∞—Ç—É—Å OTA</h3>
            <div id="otaStatus" style="margin-top: 15px;">
              <p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> <span id="lastUpdate">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span></p>
              <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="updateStatus">–ì–æ—Ç–æ–≤ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é</span></p>
            </div>
            
            <div class="button-grid" style="margin-top: 15px;">
              <button class="btn btn-info" onclick="testOTAConnection()">
                üß™ –¢–µ—Å—Ç OTA —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
              </button>
              <button class="btn btn-danger" onclick="showOTAInstructions()">
                üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
              </button>
            </div>
          </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="mobile-nav">
    <button class="mobile-nav-item active" onclick="switchTab('dashboard')">
      <span class="mobile-nav-icon">üìä</span>
      <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </button>
    <button class="mobile-nav-item" onclick="switchTab('lights')">
      <span class="mobile-nav-icon">üåà</span>
      <span>–°–≤–µ—Ç</span>
    </button>
    <button class="mobile-nav-item" onclick="switchTab('stats')">
      <span class="mobile-nav-icon">üìà</span>
      <span>–°—Ç–∞—Ç—ã</span>
    </button>
    <button class="mobile-nav-item" onclick="showActionSheet('more')">
      <span class="mobile-nav-icon">‚ãØ</span>
      <span>–ï—â–µ</span>
    </button>
  </div>

  <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –º–µ–Ω—é -->
  <div class="action-sheet" id="actionSheet">
    <div class="action-sheet-title" id="actionSheetTitle">–î–µ–π—Å—Ç–≤–∏—è</div>
    <div id="actionSheetContent">
      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
    <button class="action-sheet-cancel" onclick="hideActionSheet()">–û—Ç–º–µ–Ω–∞</button>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
  <div class="notification" id="notification">
    <div class="notification-icon">‚úÖ</div>
    <div id="notificationText">–ì–æ—Ç–æ–≤–æ</div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    let currentTab = 'dashboard';
    let isLocked = true;
    let swipeStartX = 0;
    let autoRefreshInterval = null;
    let lastTapTime = 0;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function () {
      initApp();
      loadStatus();
      startAutoRefresh();

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω –¥–ª—è iOS
      if (isIOS) {
        setupIOSSafeAreas();
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    function initApp() {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤–∞–π–ø-–∫–æ–Ω—Ç—Ä–æ–ª—è
      initSwipeControl();

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
      setupDoubleTap();

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
      setupLongPress();

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫—É
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function () {
          if (window.innerWidth <= 768) {
            toggleSidebar();
          }
        });
      });
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω –¥–ª—è iOS
    function setupIOSSafeAreas() {
      const style = document.createElement('style');
      style.textContent = `
        .mobile-header { padding-top: calc(12px + constant(safe-area-inset-top)) !important; }
        .sidebar { padding-top: calc(30px + constant(safe-area-inset-top)) !important; }
        .mobile-nav { padding-bottom: calc(8px + constant(safe-area-inset-bottom)) !important; }
        .action-sheet { padding-bottom: calc(20px + constant(safe-area-inset-bottom)) !important; }
      `;
      document.head.appendChild(style);
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª—å—é
    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.sidebar-overlay');

      if (sidebar.classList.contains('mobile-visible')) {
        sidebar.classList.remove('mobile-visible');
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
      } else {
        sidebar.classList.add('mobile-visible');
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤–∞–π–ø-–∫–æ–Ω—Ç—Ä–æ–ª—è
    function initSwipeControl() {
      const swipeHandle = document.getElementById('swipeHandle');
      const swipeTrack = document.querySelector('.swipe-track');
      const swipeProgress = document.getElementById('swipeProgress');

      let isDragging = false;
      let startX = 0;
      let currentX = 0;
      const maxSwipe = swipeTrack.offsetWidth - swipeHandle.offsetWidth - 8;

      swipeHandle.addEventListener('touchstart', function (e) {
        e.preventDefault();
        isDragging = true;
        startX = e.touches[0].clientX;
        swipeHandle.style.transition = 'none';
        swipeProgress.style.transition = 'none';
      });

      swipeHandle.addEventListener('touchmove', function (e) {
        if (!isDragging) return;
        e.preventDefault();

        currentX = e.touches[0].clientX - startX;
        if (currentX < 0) currentX = 0;
        if (currentX > maxSwipe) currentX = maxSwipe;

        swipeHandle.style.transform = `translateX(${currentX}px)`;
        swipeProgress.style.width = `${(currentX / maxSwipe) * 100}%`;

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞
        if (currentX > maxSwipe * 0.8) {
          document.getElementById('swipeControl').style.background = 'linear-gradient(135deg, var(--success), var(--info))';
        } else {
          document.getElementById('swipeControl').style.background = 'linear-gradient(135deg, var(--accent), var(--info))';
        }
      });

      swipeHandle.addEventListener('touchend', function (e) {
        if (!isDragging) return;
        isDragging = false;

        swipeHandle.style.transition = 'transform 0.3s ease';
        swipeProgress.style.transition = 'width 0.3s ease';

        if (currentX > maxSwipe * 0.8 && isLocked) {
          // –£—Å–ø–µ—à–Ω—ã–π —Å–≤–∞–π–ø
          sendCommand('unlock');
          vibrate();
        }

        // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏
        setTimeout(() => {
          swipeHandle.style.transform = 'translateX(0)';
          swipeProgress.style.width = '0%';
          document.getElementById('swipeControl').style.background = 'linear-gradient(135deg, var(--accent), var(--info))';
        }, 300);
      });
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
    function setupDoubleTap() {
      document.addEventListener('touchend', function (e) {
        const currentTime = new Date().getTime();
        const tapLength = currentTime - lastTapTime;

        if (tapLength < 300 && tapLength > 0) {
          // –î–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
          toggleLock();
          e.preventDefault();
        }

        lastTapTime = currentTime;
      });
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
    function setupLongPress() {
      const elements = ['headlightBtn', 'beepBtn'];

      elements.forEach(id => {
        const element = document.getElementById(id);
        let pressTimer;

        element.addEventListener('touchstart', function (e) {
          pressTimer = setTimeout(() => {
            if (id === 'headlightBtn') {
              showActionSheet('lights');
            } else if (id === 'beepBtn') {
              showActionSheet('sound');
            }
            vibrate(50);
          }, 500);
        });

        element.addEventListener('touchend', function () {
          clearTimeout(pressTimer);
        });

        element.addEventListener('touchmove', function () {
          clearTimeout(pressTimer);
        });
      });
    }

    // –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ –º–µ–Ω—é
    function showActionSheet(type) {
      const sheet = document.getElementById('actionSheet');
      const title = document.getElementById('actionSheetTitle');
      const content = document.getElementById('actionSheetContent');

      let html = '';

      switch (type) {
        case 'power':
          title.textContent = '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏–µ–º';
          html = `
            <button class="action-sheet-item" onclick="sendCommand('reboot'); hideActionSheet();">
              <span>üîÑ</span>
              <span>–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</span>
            </button>
            <button class="action-sheet-item" onclick="sendCommand('power_off'); hideActionSheet();">
              <span>‚≠ï</span>
              <span>–í—ã–∫–ª—é—á–∏—Ç—å</span>
            </button>
          `;
          break;

        case 'lights':
          title.textContent = '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π';
          html = `
            <button class="action-sheet-item" onclick="setLedMode(0); hideActionSheet();">
              <span>‚ö™</span>
              <span>–í—ã–∫–ª—é—á–∏—Ç—å</span>
            </button>
            <button class="action-sheet-item" onclick="setLedMode(1); hideActionSheet();">
              <span>üåà</span>
              <span>–î—ã—Ö–∞–Ω–∏–µ</span>
            </button>
            <button class="action-sheet-item" onclick="setLedMode(5); hideActionSheet();">
              <span>‚ú®</span>
              <span>–ú–µ—Ä—Ü–∞–Ω–∏–µ</span>
            </button>
            <button class="action-sheet-item" onclick="setLedMode(7); hideActionSheet();">
              <span>üö®</span>
              <span>–ü–æ–ª–∏—Ü–∏—è</span>
            </button>
          `;
          break;

        case 'sound':
          title.textContent = '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–æ–º';
          html = `
            <button class="action-sheet-item" onclick="sendCommand('beep_toggle'); hideActionSheet();">
              <span>üîä</span>
              <span>–í–∫–ª/–í—ã–∫–ª –∑–≤—É–∫</span>
            </button>
            <button class="action-sheet-item" onclick="toggleBeepAlarm(true); hideActionSheet();">
              <span>üö®</span>
              <span>–í–∫–ª—é—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª</span>
            </button>
            <button class="action-sheet-item" onclick="toggleBeepTotal(false); hideActionSheet();">
              <span>üîá</span>
              <span>–í—ã–∫–ª—é—á–∏—Ç—å –≤—Å–µ –∑–≤—É–∫–∏</span>
            </button>
          `;
          break;

        case 'more':
          title.textContent = '–ù–∞–≤–∏–≥–∞—Ü–∏—è';
          html = `
            <button class="action-sheet-item" onclick="switchTab('extended'); hideActionSheet();">
              <span>üîç</span>
              <span>–î–µ—Ç–∞–ª–∏</span>
            </button>
            <button class="action-sheet-item" onclick="switchTab('settings'); hideActionSheet();">
              <span>‚öôÔ∏è</span>
              <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </button>
            <button class="action-sheet-item" onclick="switchTab('research'); hideActionSheet();">
              <span>üî¨</span>
              <span>–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</span>
            </button>
            <button class="action-sheet-item" onclick="switchTab('ota'); hideActionSheet();">
              <span>üîÑ</span>
              <span>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
            </button>
          `;
          break;
      }

      content.innerHTML = html;
      sheet.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function hideActionSheet() {
      const sheet = document.getElementById('actionSheet');
      sheet.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // –í–∏–±—Ä–∞—Ü–∏—è
    function vibrate(duration = 30) {
      if (navigator.vibrate) {
        navigator.vibrate(duration);
      }
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    function switchTab(tabName) {
      // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });

      // –°–∫—Ä—ã—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
      document.querySelectorAll('.mobile-nav-item').forEach(item => {
        item.classList.remove('active');
      });
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
      const tabElement = document.getElementById(tabName + '-tab');
      if (tabElement) {
        tabElement.classList.add('active');
        tabElement.classList.add('animate-slide');

        // –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
        document.getElementById('mobileTitle').textContent = getTabTitle(tabName);

        // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∏–∫–æ–Ω–∫—É –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        if (tabName === 'dashboard') {
          document.querySelectorAll('.mobile-nav-item')[0].classList.add('active');
          document.querySelectorAll('.nav-item')[0].classList.add('active');
        } else if (tabName === 'lights') {
          document.querySelectorAll('.mobile-nav-item')[1].classList.add('active');
          document.querySelectorAll('.nav-item')[2].classList.add('active');
        } else if (tabName === 'stats') {
          document.querySelectorAll('.mobile-nav-item')[2].classList.add('active');
          document.querySelectorAll('.nav-item')[3].classList.add('active');
        }
      }

      currentTab = tabName;

      // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –Ω–∞—á–∞–ª—É
      document.querySelector('.main-content').scrollTop = 0;
    }

    function getTabTitle(tabName) {
      const titles = {
        'dashboard': '–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è',
        'extended': '–î–µ—Ç–∞–ª–∏',
        'lights': '–ü–æ–¥—Å–≤–µ—Ç–∫–∞',
        'stats': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
        'settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
        'research': '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
        'system': '–°–∏—Å—Ç–µ–º–∞',
        'ota': '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ'
      };
      return titles[tabName] || '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ';
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    function updateMobileStatus(data) {
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
      document.getElementById('batteryValue').innerHTML = `${data.battery || 0}<span class="value-unit">%</span>`;
      document.getElementById('speedValue').innerHTML = `${data.speed || 0}<span class="value-unit">–∫–º/—á</span>`;
      document.getElementById('tempValue').innerHTML = `${data.temperature || 0}<span class="value-unit">¬∞C</span>`;

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞
      document.getElementById('sidebarBattery').textContent = `${data.battery || 0}%`;

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      if (data.isLocked !== undefined) {
        isLocked = data.isLocked;
        updateLockStatus(isLocked);
      }
    }

    function updateLockStatus(locked) {
      const icon = document.getElementById('lockIcon');
      const text = document.getElementById('lockStatusText');
      const badge = document.getElementById('lockBadge');

      if (locked) {
        icon.textContent = 'üîí';
        text.textContent = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
        badge.textContent = '–ë–ª–æ–∫';
        badge.style.background = 'var(--danger)';
      } else {
        icon.textContent = 'üîì';
        text.textContent = '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
        badge.textContent = '–û—Ç–∫—Ä—ã—Ç';
        badge.style.background = 'var(--success)';
      }
    }

    function toggleLock() {
      if (isLocked) {
        sendCommand('unlock');
      } else {
        sendCommand('lock');
      }
      vibrate();
    }

    function toggleFunction(func) {
      sendCommand(func + '_toggle');
      vibrate();
    }

    function updateSpeedLimit(value) {
      const limit = parseInt(value) * 10;
      document.getElementById('speedLimitValue').textContent = value + ' –∫–º/—á';
      setSpeedLimit(limit);
    }

    // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ API
    async function loadStatus() {
      try {
        const [statusRes, dataRes] = await Promise.all([
          fetch('/status'),
          fetch('/data')
        ]);

        const statusData = await statusRes.json();
        const scooterData = await dataRes.json();

        if (statusData.success) {
          updateMobileStatus({ ...statusData, ...scooterData });
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
      }
    }

    async function sendCommand(cmd) {
      try {
        vibrate();
        const response = await fetch('/' + cmd);
        const data = await response.json();

        if (data.success) {
          showNotification(data.message || '–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞');
          setTimeout(loadStatus, 500);
        } else {
          showNotification('–û—à–∏–±–∫–∞: ' + data.message, 'error');
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã:', error);
        showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
      }
    }

    function setSpeedLimit(limit) {
      fetch('/speed_limit?limit=' + limit)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ' + (limit / 10) + ' –∫–º/—á');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, 'error');
          }
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–∏–º–∏—Ç–∞:', error);
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
        });
    }

    function setLedMode(mode) {
      fetch('/led_mode?mode=' + mode)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–†–µ–∂–∏–º –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, 'error');
          }
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏:', error);
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
        });
    }

    function toggleBeepAlarm(enabled) {
      fetch('/beep_alarm?enabled=' + (enabled ? '1' : '0'))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification(enabled ? '–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –≤–∫–ª—é—á–µ–Ω' : '–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –≤—ã–∫–ª—é—á–µ–Ω');
          }
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞:', error);
        });
    }

    function toggleBeepTotal(enabled) {
      fetch('/beep_total?enabled=' + (enabled ? '1' : '0'))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification(enabled ? '–û–±—â–∏–π –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω' : '–û–±—â–∏–π –∑–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω');
          }
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ–±—â–µ–≥–æ –∑–≤—É–∫–∞:', error);
        });
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    function startAutoRefresh() {
      autoRefreshInterval = setInterval(loadStatus, 3000);
    }

    function toggleDataRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
        showNotification('–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ');
      } else {
        startAutoRefresh();
        showNotification('–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ');
      }
    }

    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const text = document.getElementById('notificationText');
      const icon = notification.querySelector('.notification-icon');

      text.textContent = message;
      notification.className = `notification ${type}`;

      switch (type) {
        case 'error': icon.textContent = '‚ùå'; break;
        case 'warning': icon.textContent = '‚ö†Ô∏è'; break;
        case 'success': icon.textContent = '‚úÖ'; break;
        default: icon.textContent = '‚ÑπÔ∏è';
      }

      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
    window.addEventListener('online', () => {
      showNotification('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
      loadStatus();
    });

    window.addEventListener('offline', () => {
      showNotification('–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
    });

    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–Ω–∞ —ç–∫—Ä–∞–Ω–∞ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
    let wakeLock = null;
    if ('wakeLock' in navigator && isMobile) {
      try {
        navigator.wakeLock.request('screen').then(wl => {
          wakeLock = wl;
        });
      } catch (err) {
        console.log('Wake Lock –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
      }
    }

    // –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ Wake Lock –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    window.addEventListener('beforeunload', () => {
      if (wakeLock) {
        wakeLock.release();
        wakeLock = null;
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.addEventListener('resize', function () {
      // –ó–∞–∫—Ä—ã—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö
      if (window.innerWidth > 768) {
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        sidebar.classList.remove('mobile-visible');
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
      }
    });
  </script>
</body>

</html>