<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ninebot ES Controller</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }

    .status-card {
      text-align: center;
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
    }

    .status-card.unlocked {
      background: linear-gradient(135deg, #00b894, #00a085);
    }

    .status-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }

    .status-text {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .data-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .data-item {
      text-align: center;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .data-value {
      font-size: 1.8rem;
      font-weight: bold;
      color: white;
    }

    .data-label {
      font-size: 0.9rem;
      opacity: 0.8;
      color: white;
    }

    .control-section {
      margin-bottom: 25px;
    }

    .section-title {
      color: rgb(0, 0, 0);
      margin-bottom: 15px;
      font-size: 1.3rem;
      border-left: 4px solid #ff6b6b;
      padding-left: 15px;
    }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
    }

    .btn {
      padding: 15px 20px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn-primary {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
    }

    .btn-success {
      background: linear-gradient(135deg, #00b894, #00a085);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ff7675, #d63031);
      color: white;
    }

    .btn-warning {
      background: linear-gradient(135deg, #fdcb6e, #e17055);
      color: white;
    }

    .btn-info {
      background: linear-gradient(135deg, #a29bfe, #6c5ce7);
      color: white;
    }

    .btn-toggle {
      background: linear-gradient(135deg, #dfe6e9, #b2bec3);
      color: #2d3436;
    }

    .btn-active {
      background: linear-gradient(135deg, #00cec9, #00b894);
      color: white;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
    .extended-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .info-item {
      background: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid rgba(0,0,0,0.05);
    }

    .info-value {
      font-size: 1.6rem;
      font-weight: bold;
      color: #2d3436;
      margin-bottom: 8px;
    }

    .info-label {
      font-size: 0.85rem;
      color: #636e72;
      font-weight: 500;
    }

    .tab-container {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .tab-buttons {
      display: flex;
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      flex-wrap: wrap;
    }

    .tab-button {
      flex: 1;
      padding: 15px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .tab-button.active {
      background: white;
      color: #667eea;
      border-bottom: 3px solid #667eea;
    }

    .tab-content {
      padding: 25px;
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
    }

    .stat-card {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ */
    .color-picker {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .color-option {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.3s ease;
    }

    .color-option:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }

    .color-option.active {
      border-color: #2d3436;
      transform: scale(1.1);
    }

    .led-mode-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }

    .led-mode-btn {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .led-mode-btn.active {
      border-color: #667eea;
      background: #667eea;
      color: white;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π */
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
      margin: 0 10px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #00b894;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }

    .setting-label {
      font-weight: 500;
      color: #2d3436;
    }

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è */
    .scan-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .scan-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .scan-btn.safe {
      background: #00b894;
      color: white;
    }

    .scan-btn.warning {
      background: #fdcb6e;
      color: #2d3436;
    }

    .scan-btn.danger {
      background: #d63031;
      color: white;
    }

    .scan-progress {
      width: 100%;
      height: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      margin: 15px 0;
      overflow: hidden;
    }

    .scan-progress-bar {
      height: 100%;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      transition: width 0.3s ease;
    }

    .scan-results {
      max-height: 400px;
      overflow-y: auto;
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
    }

    .scan-result-item {
      padding: 10px;
      border-bottom: 1px solid #dee2e6;
      font-family: monospace;
      font-size: 0.9rem;
    }

    .scan-result-item.found {
      background: #d4edda;
      color: #155724;
    }

    .scan-result-item.error {
      background: #f8d7da;
      color: #721c24;
    }

    .manual-test {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      margin: 20px 0;
    }

    .manual-test input {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: monospace;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      background: #00b894;
      color: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.error {
      background: #d63031;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .card {
        padding: 20px;
      }

      .button-grid {
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      }

      .btn {
        padding: 12px 15px;
        font-size: 0.9rem;
      }

      .data-value {
        font-size: 1.5rem;
      }

      .tab-buttons {
        flex-direction: column;
      }

      .tab-button {
        min-width: auto;
      }

      .extended-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .setting-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
    }

      .scan-controls {
        flex-direction: column;
      }

      .manual-test {
        grid-template-columns: 1fr;
      }

    @media (max-width: 480px) {
      .dashboard {
        grid-template-columns: 1fr;
      }

      .button-grid {
        grid-template-columns: 1fr;
      }

      .data-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .extended-grid {
        grid-template-columns: 1fr;
      }

      .led-mode-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
      <h1>üöÄ Ninebot ES Controller</h1>
      <p>–ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∞—à–µ–≥–æ —Å–∞–º–æ–∫–∞—Ç–∞</p>
    </div>

    <!-- –¢–∞–±—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ -->
    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-button active" onclick="switchTab('main')">–û—Å–Ω–æ–≤–Ω–æ–µ</button>
        <button class="tab-button" onclick="switchTab('extended')">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
        <button class="tab-button" onclick="switchTab('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        <button class="tab-button" onclick="switchTab('lights')">–ü–æ–¥—Å–≤–µ—Ç–∫–∞</button>
        <button class="tab-button" onclick="switchTab('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button class="tab-button" onclick="switchTab('system')">–°–∏—Å—Ç–µ–º–∞</button>
        <button class="tab-button" onclick="switchTab('research')">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</button>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ -->
      <div id="main-tab" class="tab-content active">
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="dashboard">
          <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ -->
          <div class="card status-card" id="statusCard">
            <div class="status-icon">üîí</div>
            <div class="status-text" id="statusText">–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù</div>
            <div class="status-subtext" id="statusSubtext">–°–∞–º–æ–∫–∞—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</div>
            
            <div class="data-grid">
              <div class="data-item">
                <div class="data-value" id="batteryValue">0%</div>
                <div class="data-label">–ë–∞—Ç–∞—Ä–µ—è</div>
              </div>
              <div class="data-item">
                <div class="data-value" id="speedValue">0</div>
                <div class="data-label">–∫–º/—á</div>
              </div>
              <div class="data-item">
                <div class="data-value" id="tempValue">0¬∞</div>
                <div class="data-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
              </div>
              <div class="data-item">
                <div class="data-value" id="mileageValue">0</div>
                <div class="data-label">–∫–º</div>
              </div>
            </div>
          </div>

          <!-- –ë—ã—Å—Ç—Ä–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
          <div class="card">
            <h3>‚ö° –ë—ã—Å—Ç—Ä–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <div class="button-grid" style="margin-top: 20px;">
              <button class="btn btn-success" onclick="sendCommand('unlock')">
                <span>üîì</span> –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
              </button>
              <button class="btn btn-danger" onclick="sendCommand('lock')">
                <span>üîí</span> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
              </button>
              <button class="btn btn-warning" onclick="sendCommand('toggle_limit')">
                <span>üìè</span> –õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
              </button>
              <button class="btn btn-primary" onclick="toggleDataRefresh()" id="refreshBtn">
                <span>üîÑ</span> –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
              </button>
            </div>
          </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏ -->
        <div class="control-section">
          <div class="section-title">üéõÔ∏è –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã</div>
          <div class="button-grid">
            <button class="btn btn-info" onclick="sendCommand('mode_normal')">
              <span>üö∂</span> NORMAL
            </button>
            <button class="btn btn-info" onclick="sendCommand('mode_eco')">
              <span>üåø</span> ECO
            </button>
            <button class="btn btn-info" onclick="sendCommand('mode_sport')">
              <span>üèéÔ∏è</span> SPORT
            </button>
          </div>
        </div>

        <!-- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ -->
        <div class="control-section">
          <div class="section-title">üìè –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏</div>
          <div class="button-grid">
            <button class="btn btn-warning" onclick="setSpeedLimit(150)">15 –∫–º/—á</button>
            <button class="btn btn-warning" onclick="setSpeedLimit(200)">20 –∫–º/—á</button>
            <button class="btn btn-warning" onclick="setSpeedLimit(250)">25 –∫–º/—á</button>
            <button class="btn btn-warning" onclick="setSpeedLimit(300)">30 –∫–º/—á</button>
            <button class="btn btn-warning" onclick="setSpeedLimit(350)">35 –∫–º/—á</button>
          </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
        <div class="control-section">
          <div class="section-title">üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</div>
          <div class="button-grid">
            <button class="btn btn-toggle" onclick="sendCommand('headlight_toggle')" id="headlightBtn">
              <span>üí°</span> –§–∞—Ä—ã –í–ö–õ
            </button>
            <button class="btn btn-toggle" onclick="sendCommand('beep_toggle')" id="beepBtn">
              <span>üîä</span> –ó–≤—É–∫ –í–ö–õ
            </button>
            <button class="btn btn-toggle" onclick="sendCommand('cruise_toggle')" id="cruiseBtn">
              <span>‚è±Ô∏è</span> –ö—Ä—É–∏–∑ –û–¢–ö–õ
            </button>
            <button class="btn btn-toggle" onclick="sendCommand('engine_on')" id="engineBtn">
              <span>‚ö°</span> –î–≤–∏–≥–∞—Ç–µ–ª—å –í–ö–õ
            </button>
          </div>
        </div>
      </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è -->
      <div id="research-tab" class="tab-content">
        <div class="dashboard">
          <!-- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ -->
          <div class="card">
            <h3>üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤</h3>
            <p style="margin-bottom: 20px; color: #666;">
              –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ —Å–∞–º–æ–∫–∞—Ç–∞
            </p>

            <div class="scan-controls">
              <button class="scan-btn safe" onclick="startSafeScan()">
                üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—á—Ç–µ–Ω–∏–µ)
              </button>
              <button class="scan-btn warning" onclick="startBruteForceScan()">
                ‚ö†Ô∏è –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞–ø–∏—Å—å)
              </button>
              <button class="scan-btn danger" onclick="startDeepScan()">
                üö® –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
              </button>
            </div>

            <div class="scan-progress">
              <div class="scan-progress-bar" id="scanProgress" style="width: 0%"></div>
            </div>

            <div style="text-align: center; margin: 10px 0;">
              <span id="scanStatus">–ì–æ—Ç–æ–≤ –∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é</span>
              <span id="scanProgressText">0/256</span>
            </div>

            <div class="manual-test">
              <input type="text" id="manualIndex" placeholder="–ò–Ω–¥–µ–∫—Å (hex, –Ω–∞–ø—Ä–∏–º–µ—Ä: 0x70)" style="font-family: monospace">
              <input type="text" id="manualValue" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ (hex, –Ω–∞–ø—Ä–∏–º–µ—Ä: 0x0001)" style="font-family: monospace">
              <button class="btn btn-primary" onclick="manualTest()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <div class="scan-results" id="scanResults">
              <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
          </div>

          <!-- –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã -->
          <div class="card">
            <h3>üéØ –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã</h3>
            <div id="foundRegisters" style="max-height: 300px; overflow-y: auto;">
              <p style="color: #666; text-align: center; padding: 20px;">
                –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
              </p>
            </div>
          </div>

          <!-- –õ–æ–≥ –ø–∞–∫–µ—Ç–æ–≤ -->
          <div class="card">
            <h3>üìã –õ–æ–≥ –ø–∞–∫–µ—Ç–æ–≤</h3>
            <div style="margin-bottom: 15px;">
              <button class="btn btn-primary" onclick="startPacketLog()">–ù–∞—á–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
              <button class="btn btn-danger" onclick="stopPacketLog()">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
              <button class="btn" onclick="clearPacketLog()" style="background: #636e72; color: white;">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="packetLog" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.8rem;">
            </div>
          </div>
        </div>
      </div>

      <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <div id="extended-tab" class="tab-content">
        <div class="dashboard">
          <!-- –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div class="card">
            <h3>üîß –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div class="extended-grid">
              <div class="info-item">
                <div class="info-value" id="driveVoltageValue">0.0</div>
                <div class="info-label">–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ (–í)</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="motorCurrentValue">0.0</div>
                <div class="info-label">–¢–æ–∫ (–ê)</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="powerValue">0</div>
                <div class="info-label">–ú–æ—â–Ω–æ—Å—Ç—å (–í—Ç)</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="avgSpeedValue">0</div>
                <div class="info-label">–°—Ä. —Å–∫–æ—Ä–æ—Å—Ç—å</div>
              </div>
            </div>
          </div>

          <!-- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã -->
          <div class="card">
            <h3>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</h3>
            <div class="extended-grid">
              <div class="info-item">
                <div class="info-value" id="bodyTempValue">0¬∞</div>
                <div class="info-label">–ö–æ—Ä–ø—É—Å</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="bat1TempValue">0¬∞</div>
                <div class="info-label">–ë–∞—Ç–∞—Ä–µ—è 1</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="bat2TempValue">0¬∞</div>
                <div class="info-label">–ë–∞—Ç–∞—Ä–µ—è 2</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="mosTempValue">0¬∞</div>
                <div class="info-label">MOS</div>
              </div>
            </div>
          </div>

          <!-- –ë–∞—Ç–∞—Ä–µ–∏ -->
          <div class="card">
            <h3>üîã –ë–∞—Ç–∞—Ä–µ–∏</h3>
            <div class="extended-grid">
              <div class="info-item">
                <div class="info-value" id="battery1Value">0%</div>
                <div class="info-label">–ë–∞—Ç–∞—Ä–µ—è 1</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="battery2Value">0%</div>
                <div class="info-label">–ë–∞—Ç–∞—Ä–µ—è 2</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="actualRangeValue">0</div>
                <div class="info-label">–ó–∞–ø–∞—Å —Ö–æ–¥–∞ (–∫–º)</div>
              </div>
              <div class="info-item">
                <div class="info-value" id="predictedRangeValue">0</div>
                <div class="info-label">–ü—Ä–æ–≥–Ω–æ–∑ (–∫–º)</div>
              </div>
            </div>
          </div>

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
          <div class="card">
            <h3>üìä –°–∏—Å—Ç–µ–º–∞</h3>
            <div style="margin-top: 15px;">
              <p><strong>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä:</strong> <span id="serialValue">N/A</span></p>
              <p><strong>BMS –≤–µ—Ä—Å–∏—è:</strong> <span id="bmsVersionValue">N/A</span></p>
              <p><strong>–í–Ω–µ—à–Ω—è—è BMS:</strong> <span id="bms2VersionValue">N/A</span></p>
              <p><strong>BLE –≤–µ—Ä—Å–∏—è:</strong> <span id="bleVersionValue">N/A</span></p>
              <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="boolStatusValue">N/A</span></p>
              <p><strong>–¢—Ä–µ–≤–æ–≥–∏:</strong> <span id="alarmStatusValue">–ù–µ—Ç</span></p>
              <p><strong>–û—à–∏–±–∫–∏:</strong> <span id="errorValue">0</span></p>
            </div>
          </div>
        </div>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div id="stats-tab" class="tab-content">
        <div class="dashboard">
          <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–µ–∑–¥–æ–∫ -->
          <div class="card">
            <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–µ–∑–¥–æ–∫</h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="singleMileageValue">0</div>
                <div class="stat-label">–ü—Ä–æ–±–µ–≥ –ø–æ–µ–∑–¥–∫–∏ (–∫–º)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="singleRideTimeValue">0</div>
                <div class="stat-label">–í—Ä–µ–º—è –ø–æ–µ–∑–¥–∫–∏ (–º–∏–Ω)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="totalOperationTimeValue">0</div>
                <div class="stat-label">–û–±—â–µ–µ –≤—Ä–µ–º—è (—á)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="totalRideTimeValue">0</div>
                <div class="stat-label">–í—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è (—á)</div>
              </div>
            </div>
          </div>

          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
          <div class="card">
            <h3>üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div style="margin-top: 15px;">
              <p><strong>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</strong> <span id="workModeValue">N/A</span></p>
              <p><strong>–õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏:</strong> <span id="speedLimitValue">0</span> –∫–º/—á</p>
              <p><strong>–ö–æ–¥ –æ—à–∏–±–∫–∏:</strong> <span id="errorCodeValue">0</span></p>
              <p><strong>–ö—Ä—É–∏–∑-–∫–æ–Ω—Ç—Ä–æ–ª—å:</strong> <span id="cruiseValue">–í–´–ö–õ</span></p>
              <p><strong>–§–∞—Ä—ã:</strong> <span id="headlightValue">–í–ö–õ</span></p>
              <p><strong>–ó–≤—É–∫:</strong> <span id="beepValue">–í–ö–õ</span></p>
            </div>
          </div>
        </div>
      </div>

      <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ -->
      <div id="lights-tab" class="tab-content">
        <div class="dashboard">
          <!-- –†–µ–∂–∏–º—ã –ø–æ–¥—Å–≤–µ—Ç–∫–∏ -->
          <div class="card">
            <h3>üåà –†–µ–∂–∏–º—ã –ø–æ–¥—Å–≤–µ—Ç–∫–∏</h3>
            <div class="led-mode-grid">
              <div class="led-mode-btn" onclick="setLedMode(0)" id="ledMode0">–í—ã–∫–ª—é—á–µ–Ω–æ</div>
              <div class="led-mode-btn" onclick="setLedMode(1)" id="ledMode1">–û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ</div>
              <div class="led-mode-btn" onclick="setLedMode(2)" id="ledMode2">–í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ</div>
              <div class="led-mode-btn" onclick="setLedMode(3)" id="ledMode3">–î–≤–∞ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ</div>
              <div class="led-mode-btn" onclick="setLedMode(4)" id="ledMode4">–í—Å–µ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ</div>
              <div class="led-mode-btn" onclick="setLedMode(5)" id="ledMode5">–û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ</div>
              <div class="led-mode-btn" onclick="setLedMode(6)" id="ledMode6">–í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ</div>
              <div class="led-mode-btn" onclick="setLedMode(7)" id="ledMode7">–ü–æ–ª–∏—Ü–∏—è 1</div>
              <div class="led-mode-btn" onclick="setLedMode(8)" id="ledMode8">–ü–æ–ª–∏—Ü–∏—è 2</div>
              <div class="led-mode-btn" onclick="setLedMode(9)" id="ledMode9">–ü–æ–ª–∏—Ü–∏—è 3</div>
            </div>
          </div>

          <!-- –¶–≤–µ—Ç–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ -->
          <div class="card">
            <h3>üé® –¶–≤–µ—Ç–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏</h3>
            <div style="margin: 20px 0;">
              <h4>–¶–≤–µ—Ç 1 (–û—Å–Ω–æ–≤–Ω–æ–π)</h4>
              <div class="color-picker">
                <div class="color-option" style="background: rgb(0, 0, 255);" onclick="setLedColor(1, 0xA0F0)" title="–°–∏–Ω–∏–π"></div>
                <div class="color-option" style="background: rgb(0, 255, 0);" onclick="setLedColor(1, 0x50F0)" title="–ó–µ–ª–µ–Ω—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 0, 0);" onclick="setLedColor(1, 0x00F0)" title="–ö—Ä–∞—Å–Ω—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 0, 255);" onclick="setLedColor(1, 0xC8F0)" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 255, 255);" onclick="setLedColor(1, 0xF0F0)" title="–ë–µ–ª—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 255, 0);" onclick="setLedColor(1, 0xFFF0)" title="–ñ–µ–ª—Ç—ã–π"></div>
              </div>
            </div>
            
            <div style="margin: 20px 0;">
              <h4>–¶–≤–µ—Ç 2 (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π)</h4>
              <div class="color-picker">
                <div class="color-option" style="background: rgb(0, 0, 255);" onclick="setLedColor(2, 0xA0F0)" title="–°–∏–Ω–∏–π"></div>
                <div class="color-option" style="background: rgb(0, 255, 0);" onclick="setLedColor(2, 0x50F0)" title="–ó–µ–ª–µ–Ω—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 0, 0);" onclick="setLedColor(2, 0x00F0)" title="–ö—Ä–∞—Å–Ω—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 0, 255);" onclick="setLedColor(2, 0xC8F0)" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 255, 255);" onclick="setLedColor(2, 0xF0F0)" title="–ë–µ–ª—ã–π"></div>
                <div class="color-option" style="background: rgb(255, 255, 0);" onclick="setLedColor(2, 0xFFF0)" title="–ñ–µ–ª—Ç—ã–π"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div id="settings-tab" class="tab-content">
        <div class="dashboard">
          <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π -->
          <div class="card">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π</h3>
            <div style="margin-top: 20px;">
              <div class="setting-row">
                <span class="setting-label">–§–∞—Ä—ã –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω—ã</span>
                <label class="switch">
                  <input type="checkbox" id="headlightAlwaysOn" onchange="toggleSetting('headlight_always_on', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–°–∫–æ—Ä–æ—Å—Ç—å –≤ MPH (–≤–º–µ—Å—Ç–æ KM/H)</span>
                <label class="switch">
                  <input type="checkbox" id="speedInMPH" onchange="toggleSetting('speed_mph', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–û—Ç–∫–ª—é—á–∏—Ç—å —Ç—Ä–µ–≤–æ–≥—É –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ</span>
                <label class="switch">
                  <input type="checkbox" id="noAlarmLock" onchange="toggleSetting('no_alarm_lock', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">Bluetooth broadcast</span>
                <label class="switch">
                  <input type="checkbox" id="btBroadcast" onchange="toggleSetting('bt_broadcast', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏</span>
                <label class="switch">
                  <input type="checkbox" id="buttonSpeedMode" checked onchange="toggleSetting('button_speed_mode', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>

          <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞ –∏ —Å–≤–µ—Ç–∞ -->
          <div class="card">
            <h3>üîä –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞ –∏ —Å–≤–µ—Ç–∞</h3>
            <div style="margin-top: 20px;">
              <div class="setting-row">
                <span class="setting-label">–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª</span>
                <label class="switch">
                  <input type="checkbox" id="beepAlarm" checked onchange="toggleBeepAlarm(this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–û–±—â–∏–π –∑–≤—É–∫</span>
                <label class="switch">
                  <input type="checkbox" id="beepTotal" checked onchange="toggleBeepTotal(this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              
              <div class="setting-row">
                <span class="setting-label">–§–∞—Ä—ã</span>
                <label class="switch">
                  <input type="checkbox" id="headlight" checked onchange="toggleHeadlight(this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –°–∏—Å—Ç–µ–º–∞ -->
      <div id="system-tab" class="tab-content">
        <div class="dashboard">
          <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã -->
          <div class="card">
            <h3>üõ†Ô∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>
            <div class="button-grid" style="margin-top: 20px;">
              <button class="btn btn-warning" onclick="sendCommand('find_scooter')">
                <span>üîç</span> –ù–∞–π—Ç–∏ —Å–∞–º–æ–∫–∞—Ç
              </button>
              <button class="btn btn-info" onclick="sendCommand('reboot')">
                <span>üîÑ</span> –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
              </button>
              <button class="btn btn-danger" onclick="sendCommand('power_off')">
                <span>‚≠ï</span> –í—ã–∫–ª—é—á–∏—Ç—å
              </button>
            </div>
          </div>

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
          <div class="card">
            <h3>üíª –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div style="margin-top: 15px;">
              <p><strong>–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –ø–æ–¥—Å–≤–µ—Ç–∫–∏:</strong> <span id="currentLedMode">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span></p>
              <p><strong>–í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:</strong> <span id="fwVersion">N/A</span></p>
              <p><strong>–†–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞:</strong> <span id="workSystem">1</span></p>
              <p><strong>–°—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</strong> <span id="lockStatus">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span></p>
              <p><strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–≤–∏–≥–∞—Ç–µ–ª—è:</strong> <span id="engineStatus">–í–ö–õ</span></p>
            </div>
          </div>

          <!-- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -->
          <div class="card">
            <h3>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
            <div style="margin-top: 15px;">
              <p><strong>–ö–æ–¥ –æ—à–∏–±–∫–∏:</strong> <span id="diagnosticError">0</span></p>
              <p><strong>–ö–æ–¥ —Ç—Ä–µ–≤–æ–≥–∏:</strong> <span id="diagnosticAlarm">0</span></p>
              <p><strong>–ë—É–ª–µ–≤—ã —Å—Ç–∞—Ç—É—Å—ã:</strong> <span id="diagnosticBool">0x0000</span></p>
              <p><strong>–ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞—Ç—É—Å—ã:</strong> <span id="diagnosticQuickBool">0x0000</span></p>
              <button class="btn btn-primary" onclick="loadDiagnostics()" style="margin-top: 10px;">
                –û–±–Ω–æ–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div class="notification" id="notification"></div>

  <script>
    let autoRefreshInterval = null;
    let currentStatus = true;
    let currentLedMode = 1;
    let scanInProgress = false;
    let packetLogging = false;
    let packetLog = [];

    async function startSafeScan() {
        if (scanInProgress) {
            showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', true);
            return;
        }

        scanInProgress = true;
        const results = document.getElementById('scanResults');
        results.innerHTML = '';
        updateScanProgress(0, 256);

        let foundCount = 0;

        for (let index = 0; index <= 0xFF; index++) {
            if (!scanInProgress) break;

            updateScanProgress(index + 1, 256);
            document.getElementById('scanStatus').textContent = `–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: 0x${index.toString(16).toUpperCase()}`;

            try {
                const response = await fetch(`/scan_read?index=0x${index.toString(16)}`);
                const data = await response.json();

                if (data.success && data.value !== undefined) {
                    foundCount++;
                    addScanResult(`üéØ 0x${index.toString(16).toUpperCase()}: ${data.value} (0x${data.value.toString(16)})`, 'found');
                    addFoundRegister(index, data.value, 'read');
                }
            } catch (error) {
                addScanResult(`‚ùå 0x${index.toString(16).toUpperCase()}: –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è`, 'error');
            }

            // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
            await new Promise(resolve => setTimeout(resolve, 50));
        }

        scanInProgress = false;
        showNotification(`–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–π–¥–µ–Ω–æ: ${foundCount} —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤`);
    }

    // –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞–ø–∏—Å—å —Å –æ—Ç–≤–µ—Ç–æ–º)
    async function startBruteForceScan() {
        if (!confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∞–º–æ–∫–∞—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }

        if (scanInProgress) {
            showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', true);
            return;
        }

        scanInProgress = true;
        const results = document.getElementById('scanResults');
        results.innerHTML = '';
        updateScanProgress(0, 256);

        let foundCount = 0;

        for (let index = 0; index <= 0xFF; index++) {
            if (!scanInProgress) break;

            updateScanProgress(index + 1, 256);
            document.getElementById('scanStatus').textContent = `–ë—Ä—É—Ç—Ñ–æ—Ä—Å: 0x${index.toString(16).toUpperCase()}`;

            try {
                const response = await fetch(`/scan_write?index=0x${index.toString(16)}&value=0x0001`);
                const data = await response.json();

                if (data.success) {
                    foundCount++;
                    addScanResult(`üéØ 0x${index.toString(16).toUpperCase()}: –ó–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–π —Ä–µ–≥–∏—Å—Ç—Ä!`, 'found');
                    addFoundRegister(index, 1, 'write');
                }
            } catch (error) {
                addScanResult(`‚ùå 0x${index.toString(16).toUpperCase()}: –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏`, 'error');
            }

            await new Promise(resolve => setTimeout(resolve, 100));
        }

        scanInProgress = false;
        showNotification(`–ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–π–¥–µ–Ω–æ: ${foundCount} —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤`);
    }

    // –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    async function startDeepScan() {
        if (!confirm('üö® –û–ü–ê–°–ù–û: –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –ø–æ–≤—Ä–µ–¥–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–º–æ–∫–∞—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }
        showNotification('–ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ', true);
    }

    // –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    async function manualTest() {
        const indexInput = document.getElementById('manualIndex').value;
        const valueInput = document.getElementById('manualValue').value;

        if (!indexInput) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', true);
            return;
        }

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –≤ —á–∏—Å–ª–æ
        const index = parseInt(indexInput.replace('0x', ''), 16);
        if (isNaN(index)) {
            showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–Ω–¥–µ–∫—Å–∞', true);
            return;
        }

        try {
            let response, data;

            if (valueInput) {
                // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
                const value = parseInt(valueInput.replace('0x', ''), 16);
                response = await fetch(`/scan_write?index=0x${index.toString(16)}&value=0x${value.toString(16)}`);
            } else {
                // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
                response = await fetch(`/scan_read?index=0x${index.toString(16)}`);
            }

            data = await response.json();
            
            if (data.success) {
                showNotification(`‚úÖ –£—Å–ø–µ—Ö! ${valueInput ? '–ó–∞–ø–∏—Å—å' : '–ß—Ç–µ–Ω–∏–µ'} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞`);
                addScanResult(`üîß 0x${index.toString(16).toUpperCase()}: ${valueInput ? `–ó–∞–ø–∏—Å—å 0x${value.toString(16)}` : `–ß—Ç–µ–Ω–∏–µ ${data.value}`}`, 'found');
            } else {
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${data.message}`, true);
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        }
    }

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
    function startPacketLog() {
        packetLogging = true;
        packetLog = [];
        showNotification('–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –∑–∞–ø—É—â–µ–Ω–æ');
        
        // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ WebSocket)
        simulatePacketLog();
    }

    function stopPacketLog() {
        packetLogging = false;
        showNotification('–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    }

    function clearPacketLog() {
        document.getElementById('packetLog').innerHTML = '';
    }

    function simulatePacketLog() {
        if (!packetLogging) return;
        
        // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        setTimeout(() => {
            if (packetLogging) {
                const logEntry = `[${new Date().toLocaleTimeString()}] –ü–∞–∫–µ—Ç: 5A A5 02 3D 20 04 3E 36 01`;
                packetLog.push(logEntry);
                
                const logElement = document.getElementById('packetLog');
                logElement.innerHTML = packetLog.slice(-10).join('<br>');
                logElement.scrollTop = logElement.scrollHeight;
                
                simulatePacketLog();
            }
        }, 1000);
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function updateScanProgress(current, total) {
        const progress = (current / total) * 100;
        document.getElementById('scanProgress').style.width = `${progress}%`;
        document.getElementById('scanProgressText').textContent = `${current}/${total}`;
    }

    function addScanResult(message, type = '') {
        const results = document.getElementById('scanResults');
        const item = document.createElement('div');
        item.className = `scan-result-item ${type}`;
        item.textContent = message;
        results.appendChild(item);
        results.scrollTop = results.scrollHeight;
    }

    function addFoundRegister(index, value, type) {
        const foundElement = document.getElementById('foundRegisters');
        const registerInfo = document.createElement('div');
        registerInfo.style.padding = '8px';
        registerInfo.style.borderBottom = '1px solid #eee';
        registerInfo.style.fontFamily = 'monospace';
        
        const typeIcon = type === 'read' ? 'üìñ' : '‚úèÔ∏è';
        registerInfo.innerHTML = `${typeIcon} <strong>0x${index.toString(16).toUpperCase()}</strong>: ${value} <span style="color: #666;">(${type})</span>`;
        
        foundElement.appendChild(registerInfo);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
      loadStatus();
      startAutoRefresh();
      updateLedModeButtons();
    });

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
    async function startSafeScan() {
        if (scanInProgress) {
            showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', true);
            return;
        }

        scanInProgress = true;
        const results = document.getElementById('scanResults');
        results.innerHTML = '';
        updateScanProgress(0, 256);

        let foundCount = 0;

        for (let index = 0; index <= 0xFF; index++) {
            if (!scanInProgress) break;

            updateScanProgress(index + 1, 256);
            document.getElementById('scanStatus').textContent = `–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: 0x${index.toString(16).toUpperCase()}`;

            try {
                const response = await fetch(`/scan_read?index=0x${index.toString(16)}`);
                const data = await response.json();

                if (data.success && data.value !== undefined) {
                    foundCount++;
                    addScanResult(`üéØ 0x${index.toString(16).toUpperCase()}: ${data.value} (0x${data.value.toString(16)})`, 'found');
                    addFoundRegister(index, data.value, 'read');
                }
            } catch (error) {
                addScanResult(`‚ùå 0x${index.toString(16).toUpperCase()}: –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è`, 'error');
            }

            // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
            await new Promise(resolve => setTimeout(resolve, 50));
        }

        scanInProgress = false;
        showNotification(`–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–π–¥–µ–Ω–æ: ${foundCount} —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤`);
    }

    // –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞–ø–∏—Å—å —Å –æ—Ç–≤–µ—Ç–æ–º)
    async function startBruteForceScan() {
        if (!confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∞–º–æ–∫–∞—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }

        if (scanInProgress) {
            showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', true);
            return;
        }

        scanInProgress = true;
        const results = document.getElementById('scanResults');
        results.innerHTML = '';
        updateScanProgress(0, 256);

        let foundCount = 0;

        for (let index = 0; index <= 0xFF; index++) {
            if (!scanInProgress) break;

            updateScanProgress(index + 1, 256);
            document.getElementById('scanStatus').textContent = `–ë—Ä—É—Ç—Ñ–æ—Ä—Å: 0x${index.toString(16).toUpperCase()}`;

            try {
                const response = await fetch(`/scan_write?index=0x${index.toString(16)}&value=0x0001`);
                const data = await response.json();

                if (data.success) {
                    foundCount++;
                    addScanResult(`üéØ 0x${index.toString(16).toUpperCase()}: –ó–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–π —Ä–µ–≥–∏—Å—Ç—Ä!`, 'found');
                    addFoundRegister(index, 1, 'write');
                }
            } catch (error) {
                addScanResult(`‚ùå 0x${index.toString(16).toUpperCase()}: –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏`, 'error');
            }

            await new Promise(resolve => setTimeout(resolve, 100));
        }

        scanInProgress = false;
        showNotification(`–ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–π–¥–µ–Ω–æ: ${foundCount} —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤`);
    }

    // –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    async function startDeepScan() {
        if (!confirm('üö® –û–ü–ê–°–ù–û: –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –ø–æ–≤—Ä–µ–¥–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–º–æ–∫–∞—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }
        showNotification('–ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ', true);
    }

    // –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    async function manualTest() {
        const indexInput = document.getElementById('manualIndex').value;
        const valueInput = document.getElementById('manualValue').value;

        if (!indexInput) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', true);
            return;
        }

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –≤ —á–∏—Å–ª–æ
        const index = parseInt(indexInput.replace('0x', ''), 16);
        if (isNaN(index)) {
            showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–Ω–¥–µ–∫—Å–∞', true);
            return;
        }

        try {
            let response, data;

            if (valueInput) {
                // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
                const value = parseInt(valueInput.replace('0x', ''), 16);
                response = await fetch(`/scan_write?index=0x${index.toString(16)}&value=0x${value.toString(16)}`);
            } else {
                // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
                response = await fetch(`/scan_read?index=0x${index.toString(16)}`);
            }

            data = await response.json();
            
            if (data.success) {
                showNotification(`‚úÖ –£—Å–ø–µ—Ö! ${valueInput ? '–ó–∞–ø–∏—Å—å' : '–ß—Ç–µ–Ω–∏–µ'} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞`);
                addScanResult(`üîß 0x${index.toString(16).toUpperCase()}: ${valueInput ? `–ó–∞–ø–∏—Å—å 0x${value.toString(16)}` : `–ß—Ç–µ–Ω–∏–µ ${data.value}`}`, 'found');
            } else {
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${data.message}`, true);
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        }
    }

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
    function startPacketLog() {
        packetLogging = true;
        packetLog = [];
        showNotification('–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –∑–∞–ø—É—â–µ–Ω–æ');
        
        // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ WebSocket)
        simulatePacketLog();
    }

    function stopPacketLog() {
        packetLogging = false;
        showNotification('–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    }

    function clearPacketLog() {
        document.getElementById('packetLog').innerHTML = '';
    }

    function simulatePacketLog() {
        if (!packetLogging) return;
        
        // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        setTimeout(() => {
            if (packetLogging) {
                const logEntry = `[${new Date().toLocaleTimeString()}] –ü–∞–∫–µ—Ç: 5A A5 02 3D 20 04 3E 36 01`;
                packetLog.push(logEntry);
                
                const logElement = document.getElementById('packetLog');
                logElement.innerHTML = packetLog.slice(-10).join('<br>');
                logElement.scrollTop = logElement.scrollHeight;
                
                simulatePacketLog();
            }
        }, 1000);
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function updateScanProgress(current, total) {
        const progress = (current / total) * 100;
        document.getElementById('scanProgress').style.width = `${progress}%`;
        document.getElementById('scanProgressText').textContent = `${current}/${total}`;
    }

    function addScanResult(message, type = '') {
        const results = document.getElementById('scanResults');
        const item = document.createElement('div');
        item.className = `scan-result-item ${type}`;
        item.textContent = message;
        results.appendChild(item);
        results.scrollTop = results.scrollHeight;
    }

    function addFoundRegister(index, value, type) {
        const foundElement = document.getElementById('foundRegisters');
        const registerInfo = document.createElement('div');
        registerInfo.style.padding = '8px';
        registerInfo.style.borderBottom = '1px solid #eee';
        registerInfo.style.fontFamily = 'monospace';
        
        const typeIcon = type === 'read' ? 'üìñ' : '‚úèÔ∏è';
        registerInfo.innerHTML = `${typeIcon} <strong>0x${index.toString(16).toUpperCase()}</strong>: ${value} <span style="color: #666;">(${type})</span>`;
        
        foundElement.appendChild(registerInfo);
    }


    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    function switchTab(tabName) {
      // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
      });

      // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
      document.getElementById(tabName + '-tab').classList.add('active');
      event.target.classList.add('active');
    }

    // –§—É–Ω–∫—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
    function updateStatus(isLocked) {
      const statusCard = document.getElementById('statusCard');
      const statusText = document.getElementById('statusText');
      const statusSubtext = document.getElementById('statusSubtext');
      
      currentStatus = isLocked;
      
      if (isLocked) {
        statusCard.className = 'card status-card';
        statusText.innerHTML = 'üîí –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù';
        statusSubtext.innerHTML = '–°–∞–º–æ–∫–∞—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
      } else {
        statusCard.className = 'card status-card unlocked';
        statusText.innerHTML = 'üîì –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù';
        statusSubtext.innerHTML = '–°–∞–º–æ–∫–∞—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ';
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadStatus() {
      try {
        const [statusRes, dataRes] = await Promise.all([
          fetch('/status'),
          fetch('/data')
        ]);
        
        const statusData = await statusRes.json();
        const scooterData = await dataRes.json();
        
        if (statusData.success) {
          updateStatus(statusData.isLocked);
        }
        
        if (scooterData.success) {
          updateScooterData(scooterData);
        }
      } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', true);
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–∞–º–æ–∫–∞—Ç–∞
    function updateScooterData(data) {
      // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      document.getElementById('batteryValue').textContent = data.battery + '%';
      document.getElementById('speedValue').textContent = data.speed;
      document.getElementById('tempValue').textContent = data.temperature + '¬∞';
      document.getElementById('mileageValue').textContent = data.mileage;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
      updateButtonState('headlightBtn', 'üí° –§–∞—Ä—ã', data.headlightState);
      updateButtonState('beepBtn', 'üîä –ó–≤—É–∫', data.beepState);
      updateButtonState('cruiseBtn', '‚è±Ô∏è –ö—Ä—É–∏–∑', data.cruiseControl);
      updateButtonState('engineBtn', '‚ö° –î–≤–∏–≥–∞—Ç–µ–ª—å', data.engineState);

      // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      document.getElementById('driveVoltageValue').textContent = data.driveVoltage;
      document.getElementById('motorCurrentValue').textContent = data.motorCurrent;
      document.getElementById('powerValue').textContent = data.power;
      document.getElementById('avgSpeedValue').textContent = data.avgSpeed;
      
      // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
      document.getElementById('bodyTempValue').textContent = data.temperature + '¬∞';
      document.getElementById('bat1TempValue').textContent = data.battery1Temp + '¬∞';
      document.getElementById('bat2TempValue').textContent = data.battery2Temp + '¬∞';
      document.getElementById('mosTempValue').textContent = data.mosTemp + '¬∞';
      
      // –ë–∞—Ç–∞—Ä–µ–∏
      document.getElementById('battery1Value').textContent = data.battery1 + '%';
      document.getElementById('battery2Value').textContent = data.battery2 + '%';
      document.getElementById('actualRangeValue').textContent = data.actualRange;
      document.getElementById('predictedRangeValue').textContent = data.predictedRange;
      
      // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      document.getElementById('serialValue').textContent = data.serial || 'N/A';
      document.getElementById('bmsVersionValue').textContent = data.bmsVersion || 'N/A';
      document.getElementById('bms2VersionValue').textContent = data.bms2Version || 'N/A';
      document.getElementById('bleVersionValue').textContent = data.bleVersion || 'N/A';
      document.getElementById('boolStatusValue').textContent = data.boolStatus || 'N/A';
      document.getElementById('alarmStatusValue').textContent = data.alarmStatus || '–ù–µ—Ç';
      document.getElementById('errorValue').textContent = data.errorCode || '0';
      
      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      document.getElementById('singleMileageValue').textContent = data.singleMileage;
      document.getElementById('singleRideTimeValue').textContent = data.singleRideTime;
      document.getElementById('totalOperationTimeValue').textContent = data.totalOperationTime;
      document.getElementById('totalRideTimeValue').textContent = data.totalRideTime;
      
      document.getElementById('workModeValue').textContent = getWorkModeName(data.workMode);
      document.getElementById('speedLimitValue').textContent = data.speedLimit;
      document.getElementById('errorCodeValue').textContent = data.errorCode;
      document.getElementById('cruiseValue').textContent = data.cruiseControl ? '–í–ö–õ' : '–í–´–ö–õ';
      document.getElementById('headlightValue').textContent = data.headlightState ? '–í–ö–õ' : '–í–´–ö–õ';
      document.getElementById('beepValue').textContent = data.beepState ? '–í–ö–õ' : '–í–´–ö–õ';

      // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      document.getElementById('lockStatus').textContent = data.isLocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
      document.getElementById('engineStatus').textContent = data.engineState ? '–í–ö–õ' : '–í–´–ö–õ';
      document.getElementById('currentLedMode').textContent = getLedModeName(data.ledMode || 1);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
      updateSettingsSwitches(data);
    }

    function getWorkModeName(mode) {
      switch(mode) {
        case 0: return 'NORMAL';
        case 1: return 'ECO';
        case 2: return 'SPORT';
        default: return 'N/A';
      }
    }

    function getLedModeName(mode) {
      const modes = {
        0: '–í—ã–∫–ª—é—á–µ–Ω–æ',
        1: '–û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ',
        2: '–í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ',
        3: '–î–≤–∞ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ',
        4: '–í—Å–µ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ',
        5: '–û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ',
        6: '–í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ',
        7: '–ü–æ–ª–∏—Ü–∏—è 1',
        8: '–ü–æ–ª–∏—Ü–∏—è 2',
        9: '–ü–æ–ª–∏—Ü–∏—è 3'
      };
      return modes[mode] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
    function updateButtonState(btnId, prefix, state) {
      const btn = document.getElementById(btnId);
      btn.innerHTML = `<span>${prefix.split(' ')[0]}</span> ${prefix.split(' ')[1]} ${state ? '–í–ö–õ' : '–í–´–ö–õ'}`;
      btn.className = state ? 'btn btn-active' : 'btn btn-toggle';
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function updateSettingsSwitches(data) {
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö —Å —Å–∞–º–æ–∫–∞—Ç–∞
      // –ù–∞–ø—Ä–∏–º–µ—Ä: document.getElementById('headlightAlwaysOn').checked = data.headlightAlwaysOn;
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
    function setLedMode(mode) {
      fetch('/led_mode?mode=' + mode)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–†–µ–∂–∏–º –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω: ' + getLedModeName(mode));
            updateLedModeButtons();
            currentLedMode = mode;
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function setLedColor(colorIndex, color) {
      fetch('/led_color?index=' + colorIndex + '&color=' + color.toString(16))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–¶–≤–µ—Ç ' + colorIndex + ' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            updateColorButtons(colorIndex, color);
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function updateLedModeButtons() {
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
      document.querySelectorAll('.led-mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é
      if (document.getElementById('ledMode' + currentLedMode)) {
        document.getElementById('ledMode' + currentLedMode).classList.add('active');
      }
    }

    function updateColorButtons(colorIndex, color) {
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ü–≤–µ—Ç–æ–≤
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    function toggleSetting(setting, enabled) {
      fetch('/' + setting + '?enabled=' + (enabled ? '1' : '0'))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function toggleHeadlight(enabled) {
      fetch('/headlight_toggle')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification(enabled ? '–§–∞—Ä—ã –≤–∫–ª—é—á–µ–Ω—ã' : '–§–∞—Ä—ã –≤—ã–∫–ª—é—á–µ–Ω—ã');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function toggleBeepAlarm(enabled) {
      fetch('/beep_alarm?enabled=' + (enabled ? '1' : '0'))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification(enabled ? '–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –≤–∫–ª—é—á–µ–Ω' : '–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –≤—ã–∫–ª—é—á–µ–Ω');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function toggleBeepTotal(enabled) {
      fetch('/beep_total?enabled=' + (enabled ? '1' : '0'))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification(enabled ? '–û–±—â–∏–π –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω' : '–û–±—â–∏–π –∑–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏
    function setSpeedLimit(limit) {
      fetch('/speed_limit?limit=' + limit)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ' + (limit / 10) + ' –∫–º/—á');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
    function loadDiagnostics() {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
      loadStatus();
      showNotification('–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    function startAutoRefresh() {
      autoRefreshInterval = setInterval(loadStatus, 2000);
      document.getElementById('refreshBtn').className = 'btn btn-active';
    }

    function stopAutoRefresh() {
      clearInterval(autoRefreshInterval);
      document.getElementById('refreshBtn').className = 'btn btn-primary';
    }

    function toggleDataRefresh() {
      if (autoRefreshInterval) {
        stopAutoRefresh();
      } else {
        startAutoRefresh();
      }
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥
    async function sendCommand(cmd) {
      try {
        const response = await fetch('/' + cmd);
        const data = await response.json();
        
        if (data.success) {
          showNotification(data.message);
          setTimeout(loadStatus, 500);
        } else {
          showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
        }
      } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
      }
    }

    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification(message, isError = false) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${isError ? 'error' : ''} show`;
      
      setTimeout(() => {
        notification.className = 'notification';
      }, 3000);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    let touchStartX = 0;
    let touchEndX = 0;

    document.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    });

    document.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });

    function handleSwipe() {
      const swipeMin = 50;
      if (touchStartX - touchEndX > swipeMin) {
        if (currentStatus) sendCommand('unlock');
      } else if (touchEndX - touchStartX > swipeMin) {
        if (!currentStatus) sendCommand('lock');
      }
    }
  </script>
</body>
</html>