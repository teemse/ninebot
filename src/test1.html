<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ninebot ES Controller</title>
  <style>
    :root {
      --primary: #2d3436;
      --secondary: #636e72;
      --accent: #0984e3;
      --success: #00b894;
      --danger: #d63031;
      --warning: #fdcb6e;
      --info: #6c5ce7;
      --light: #f8f9fa;
      --dark: #2d3436;
      --gray: #dfe6e9;
      --card-bg: #ffffff;
      --body-bg: #f5f6fa;
      --border-radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,0.08);
      --shadow-hover: 0 20px 40px rgba(0,0,0,0.12);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--body-bg);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* –ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª—å—é */
    .app-container {
      display: flex;
      min-height: 100vh;
    }

    /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
    .sidebar {
      width: 280px;
      background: var(--primary);
      color: white;
      padding: 30px 20px;
      display: flex;
      flex-direction: column;
      position: sticky;
      top: 0;
      height: 100vh;
      box-shadow: 5px 0 20px rgba(0,0,0,0.1);
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(255,255,255,0.1);
    }

    .logo-icon {
      font-size: 32px;
      background: linear-gradient(135deg, var(--accent), var(--info));
      padding: 12px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 56px;
      height: 56px;
    }

    .logo-text h1 {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .logo-text p {
      font-size: 0.85rem;
      opacity: 0.8;
    }

    .nav-menu {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border-radius: 12px;
      text-decoration: none;
      color: rgba(255,255,255,0.8);
      font-weight: 500;
      transition: var(--transition);
      cursor: pointer;
    }

    .nav-item:hover {
      background: rgba(255,255,255,0.1);
      color: white;
      transform: translateX(5px);
    }

    .nav-item.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 5px 15px rgba(9, 132, 227, 0.3);
    }

    .nav-item .icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    .status-bar {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid rgba(255,255,255,0.1);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      margin-bottom: 10px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    .status-dot.offline {
      background: var(--danger);
      animation: none;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--gray);
    }

    .page-header h2 {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
    }

    .quick-actions {
      display: flex;
      gap: 10px;
    }

    /* –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ */
    .status-panel {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      transition: var(--transition);
    }

    .status-panel:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }

    .status-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .lock-status {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 24px;
      background: var(--danger);
      color: white;
      border-radius: 50px;
      font-weight: 600;
      transition: var(--transition);
    }

    .lock-status.unlocked {
      background: var(--success);
    }

    .lock-status .icon {
      font-size: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--light), white);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 1px solid rgba(0,0,0,0.05);
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-3px);
      border-color: var(--accent);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--secondary);
      font-weight: 500;
    }

    .stat-unit {
      font-size: 1rem;
      color: var(--accent);
      font-weight: 600;
    }

    /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .control-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .control-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 25px;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .control-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }

    .control-card h3 {
      font-size: 1.1rem;
      margin-bottom: 15px;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .control-card h3 .icon {
      font-size: 24px;
    }

    .btn-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
    }

    .btn {
      padding: 12px 16px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-align: center;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-warning {
      background: var(--warning);
      color: var(--dark);
    }

    .btn-info {
      background: var(--info);
      color: white;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--gray);
      color: var(--secondary);
    }

    .btn-outline.active {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(9, 132, 227, 0.1);
    }

    /* –°–µ–∫—Ü–∏–∏ */
    .section {
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .section-title .icon {
      font-size: 24px;
      color: var(--accent);
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
    }

    .info-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .info-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .info-value {
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .info-label {
      font-size: 0.85rem;
      color: var(--secondary);
      font-weight: 500;
    }

    /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ */
    .switch-group {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid var(--gray);
    }

    .switch-label {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
    }

    .switch-label .icon {
      font-size: 20px;
      color: var(--accent);
    }

    .switch {
      position: relative;
      width: 54px;
      height: 28px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--gray);
      transition: var(--transition);
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 4px;
      bottom: 4px;
      background: white;
      transition: var(--transition);
      border-radius: 50%;
    }

    input:checked + .slider {
      background: var(--success);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    /* –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ */
    .color-picker {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 15px 0;
    }

    .color-option {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: var(--transition);
    }

    .color-option:hover {
      transform: scale(1.1);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .color-option.active {
      border-color: var(--dark);
      transform: scale(1.1);
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
    .scan-progress {
      background: var(--gray);
      border-radius: 10px;
      height: 8px;
      margin: 20px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--info));
      transition: width 0.3s ease;
      border-radius: 10px;
    }

    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
    .notification {
      position: fixed;
      top: 30px;
      right: 30px;
      padding: 16px 24px;
      background: var(--card-bg);
      color: var(--dark);
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      transform: translateX(400px);
      transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 1000;
      border-left: 4px solid var(--success);
      max-width: 350px;
    }

    .notification.error {
      border-left-color: var(--danger);
    }

    .notification.warning {
      border-left-color: var(--warning);
    }

    .notification.info {
      border-left-color: var(--accent);
    }

    .notification.show {
      transform: translateX(0);
    }

    /* –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ */
    .research-panel {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }

    .scan-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 15px 0;
    }

    .manual-test {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      margin: 20px 0;
    }

    .manual-test input {
      padding: 12px 16px;
      border: 2px solid var(--gray);
      border-radius: 10px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.9rem;
      transition: var(--transition);
    }

    .manual-test input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .log-panel {
      background: #1a1a1a;
      color: #00ff00;
      border-radius: 10px;
      padding: 20px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.85rem;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .log-entry {
      padding: 8px 0;
      border-bottom: 1px solid #333;
    }

    .log-entry.found {
      color: #00ff00;
    }

    .log-entry.error {
      color: #ff4444;
    }

    /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
    @media (prefers-color-scheme: dark) {
      :root {
        --primary: #ffffff;
        --secondary: #b2bec3;
        --accent: #74b9ff;
        --success: #00cec9;
        --danger: #ff7675;
        --warning: #fdcb6e;
        --info: #a29bfe;
        --light: #2d3436;
        --dark: #ffffff;
        --gray: #4a4a4a;
        --card-bg: #2d3436;
        --body-bg: #1a1a1a;
        --shadow: 0 10px 30px rgba(0,0,0,0.3);
        --shadow-hover: 0 20px 40px rgba(0,0,0,0.4);
      }

      .status-panel, .control-card, .info-card, .research-panel {
        border: 1px solid var(--gray);
      }
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 1200px) {
      .app-container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        padding: 20px;
      }

      .nav-menu {
        flex-direction: row;
        overflow-x: auto;
        padding-bottom: 10px;
      }

      .nav-item {
        white-space: nowrap;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 20px;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .control-grid {
        grid-template-columns: 1fr;
      }

      .btn-group {
        grid-template-columns: repeat(2, 1fr);
      }

      .manual-test {
        grid-template-columns: 1fr;
      }

      .page-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }

      .quick-actions {
        width: 100%;
        overflow-x: auto;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .nav-menu {
        flex-wrap: wrap;
      }

      .btn-group {
        grid-template-columns: 1fr;
      }

      .color-picker {
        justify-content: center;
      }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate {
      animation: slideIn 0.4s ease-out;
    }

    /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--gray);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--info);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <div class="sidebar">
      <div class="logo">
        <div class="logo-icon">üõ¥</div>
        <div class="logo-text">
          <h1>Ninebot ES</h1>
          <p>–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä</p>
        </div>
      </div>

      <nav class="nav-menu">
        <a class="nav-item active" onclick="switchTab('dashboard')">
          <span class="icon">üìä</span>
          <span>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
        </a>
        <a class="nav-item" onclick="switchTab('extended')">
          <span class="icon">üîç</span>
          <span>–î–µ—Ç–∞–ª–∏</span>
        </a>
        <a class="nav-item" onclick="switchTab('lights')">
          <span class="icon">üåà</span>
          <span>–ü–æ–¥—Å–≤–µ—Ç–∫–∞</span>
        </a>
        <a class="nav-item" onclick="switchTab('stats')">
          <span class="icon">üìà</span>
          <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
        </a>
        <a class="nav-item" onclick="switchTab('settings')">
          <span class="icon">‚öôÔ∏è</span>
          <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        </a>
        <a class="nav-item" onclick="switchTab('research')">
          <span class="icon">üî¨</span>
          <span>–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</span>
        </a>
        <a class="nav-item" onclick="switchTab('system')">
          <span class="icon">üíª</span>
          <span>–°–∏—Å—Ç–µ–º–∞</span>
        </a>
        <a class="nav-item" onclick="switchTab('ota')">
          <span class="icon">üîÑ</span>
          <span>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
        </a>
      </nav>

      <div class="status-bar">
        <div class="status-indicator">
          <div class="status-dot"></div>
          <div>–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ</div>
        </div>
        <div style="font-size: 0.85rem; opacity: 0.8; text-align: center;">
          –í–µ—Ä—Å–∏—è: 2.1.0
        </div>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    <div class="main-content">
      <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≥–ª–∞–≤–Ω–∞—è) -->
      <div id="dashboard-tab" class="tab-content active">
        <div class="page-header">
          <h2>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
          <div class="quick-actions">
            <button class="btn btn-outline" onclick="toggleDataRefresh()" id="refreshBtn">
              <span>üîÑ</span> –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            </button>
            <button class="btn btn-success" onclick="sendCommand('unlock')">
              <span>üîì</span> –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class="btn btn-danger" onclick="sendCommand('lock')">
              <span>üîí</span> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
            </button>
          </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∞—Ç—É—Å -->
        <div class="status-panel animate">
          <div class="status-header">
            <div class="lock-status" id="statusCard">
              <span class="icon">üîí</span>
              <span id="statusText">–°–∞–º–æ–∫–∞—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
            </div>
            <div class="btn-group" style="grid-template-columns: repeat(3, auto);">
              <button class="btn btn-outline" onclick="sendCommand('open_deck')">
                <span>üì¶</span> –û—Ç–∫—Ä—ã—Ç—å –¥–µ–∫—É
              </button>
              <button class="btn btn-outline" onclick="sendCommand('find_scooter')">
                <span>üîç</span> –ù–∞–π—Ç–∏
              </button>
              <button class="btn btn-outline" onclick="sendCommand('reboot')">
                <span>üîÑ</span> –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
              </button>
            </div>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="batteryValue">0<span class="stat-unit">%</span></div>
              <div class="stat-label">–ë–∞—Ç–∞—Ä–µ—è</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="speedValue">0<span class="stat-unit">–∫–º/—á</span></div>
              <div class="stat-label">–°–∫–æ—Ä–æ—Å—Ç—å</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="tempValue">0<span class="stat-unit">¬∞C</span></div>
              <div class="stat-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="mileageValue">0<span class="stat-unit">–∫–º</span></div>
              <div class="stat-label">–ü—Ä–æ–±–µ–≥</div>
            </div>
          </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏ -->
        <div class="section">
          <h3 class="section-title">
            <span class="icon">üéÆ</span>
            –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã
          </h3>
          <div class="control-grid">
            <div class="control-card">
              <h3><span class="icon">üö∂</span> –†–µ–∂–∏–º –¥–≤–∏–∂–µ–Ω–∏—è</h3>
              <div class="btn-group">
                <button class="btn btn-outline" onclick="sendCommand('mode_normal')">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç
                </button>
                <button class="btn btn-outline" onclick="sendCommand('mode_eco')">
                  –≠–∫–æ
                </button>
                <button class="btn btn-outline" onclick="sendCommand('mode_sport')">
                  –°–ø–æ—Ä—Ç
                </button>
              </div>
            </div>

            <div class="control-card">
              <h3><span class="icon">‚ö°</span> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
              <div class="btn-group">
                <button class="btn btn-outline" onclick="sendCommand('headlight_toggle')" id="headlightBtn">
                  <span>üí°</span> –§–∞—Ä—ã
                </button>
                <button class="btn btn-outline" onclick="sendCommand('beep_toggle')" id="beepBtn">
                  <span>üîä</span> –ó–≤—É–∫
                </button>
                <button class="btn btn-outline" onclick="sendCommand('engine_on')" id="engineBtn">
                  <span>‚ö°</span> –î–≤–∏–≥–∞—Ç–µ–ª—å
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- –õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ -->
        <div class="section">
          <h3 class="section-title">
            <span class="icon">üìè</span>
            –õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
          </h3>
          <div class="control-card">
            <div class="btn-group">
              <button class="btn btn-outline" onclick="setSpeedLimit(150)">15 –∫–º/—á</button>
              <button class="btn btn-outline" onclick="setSpeedLimit(200)">20 –∫–º/—á</button>
              <button class="btn btn-outline" onclick="setSpeedLimit(250)">25 –∫–º/—á</button>
              <button class="btn btn-outline" onclick="setSpeedLimit(300)">30 –∫–º/—á</button>
              <button class="btn btn-outline active" onclick="setSpeedLimit(350)">35 –∫–º/—á</button>
            </div>
          </div>
        </div>
      </div>

      <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ (—à–∞–±–ª–æ–Ω) -->
      <div id="extended-tab" class="tab-content">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
      </div>

      <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
      <div class="notification" id="notification"></div>
    </div>
  </div>

  <script>
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞
    let autoRefreshInterval = null;
    let currentStatus = true;
    let currentLedMode = 1;
    let scanInProgress = false;
    let packetLogging = false;
    let packetLog = [];
    let otaInProgress = false;

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
    function switchTab(tabName) {
      // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.classList.add('active');

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.getElementById(tabName + '-tab').classList.add('active');
      document.getElementById(tabName + '-tab').classList.add('animate');

      // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–∫–ª–∞–¥–æ–∫
      if (tabName === 'ota') {
        loadSystemInfo();
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
    function updateStatus(isLocked) {
      const statusCard = document.getElementById('statusCard');
      const statusText = document.getElementById('statusText');
      
      currentStatus = isLocked;
      
      if (isLocked) {
        statusCard.className = 'lock-status';
        statusText.textContent = '–°–∞–º–æ–∫–∞—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
      } else {
        statusCard.className = 'lock-status unlocked';
        statusText.textContent = '–°–∞–º–æ–∫–∞—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
      }
    }

    // –£–ª—É—á—à–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    // –í—Å–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–º–∏
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
      loadStatus();
      startAutoRefresh();
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('animate');
      });
    });

    // –î–∞–ª–µ–µ —Å–ª–µ–¥—É—é—Ç –≤—Å–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞,
    // –æ–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–º–∏, —Ç–∞–∫ –∫–∞–∫ –ª–æ–≥–∏–∫–∞ –±–µ–∫–µ–Ω–¥–∞ –Ω–µ –º–µ–Ω—è–ª–∞—Å—å
    // –Ø –ø—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏–ª HTML/CSS —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –≤–∞—à–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ JavaScript —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∏–∂–µ...
    // [–í–µ—Å—å –≤–∞—à –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π JavaScript –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –∑–¥–µ—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    async function loadSystemInfo() {
        try {
            const response = await fetch('/firmware_info');
            const data = await response.json();
            
            if (data.success) {
                document.getElementById('systemInfo').innerHTML = `
                    <p><strong>–í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏:</strong> ${data.version || 'N/A'}</p>
                    <p><strong>ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> ${data.chip_id || 'N/A'}</p>
                    <p><strong>–°–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å:</strong> ${Math.round(data.free_heap/1024)} KB</p>
                    <p><strong>–†–∞–∑–º–µ—Ä –ø—Ä–æ—à–∏–≤–∫–∏:</strong> ${Math.round(data.sketch_size/1024)} KB</p>
                    <p><strong>–°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ:</strong> ${Math.round(data.free_sketch_space/1024)} KB</p>
                    <p><strong>Flash —Ä–∞–∑–º–µ—Ä:</strong> ${Math.round(data.flash_size/1024)} KB</p>
                `;
                document.getElementById('currentVersion').textContent = data.version || 'N/A';
                document.getElementById('freeMemory').textContent = Math.round(data.free_heap/1024) + ' KB';
                document.getElementById('deviceId').textContent = data.chip_id || 'N/A';
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏', 'error');
        }
    }

    async function startSafeScan() {
        if (scanInProgress) {
            showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', 'error');
            return;
        }

        scanInProgress = true;
        showNotification('–ù–∞—á–∞—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', 'info');
        // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    }

    // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–µ–≥–æ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞...
    // [–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–µ–≥–æ JavaScript –∫–æ–¥–∞]









// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã OTA
document.getElementById('otaForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (otaInProgress) {
        showNotification('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', true);
        return;
    }
    
    const fileInput = document.querySelector('input[type="file"]');
    const file = fileInput.files[0];
    
    if (!file) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏', true);
        return;
    }
    
    if (!file.name.endsWith('.bin')) {
        showNotification('–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .bin', true);
        return;
    }
    
    if (!confirm(`üöÄ –ù–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏?\n\n–§–∞–π–ª: ${file.name}\n–†–∞–∑–º–µ—Ä: ${Math.round(file.size/1024)} KB\n\n–ü–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ–ª—å–∑—è –ø—Ä–µ—Ä–≤–∞—Ç—å!`)) {
        return;
    }
    
    await uploadFirmware(file);
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏
async function uploadFirmware(file) {
    otaInProgress = true;
    const formData = new FormData();
    formData.append('firmware', file);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    document.getElementById('otaProgress').style.display = 'block';
    document.getElementById('uploadBtn').disabled = true;
    updateOtaProgress(0, '–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏...');
    
    try {
        const response = await fetch('/firmware', {
            method: 'POST',
            body: formData,
            credentials: 'include' // –î–ª—è –±–∞–∑–æ–≤–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        });
        
        if (response.ok) {
            updateOtaProgress(100, '‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞...');
            showNotification('–ü—Ä–æ—à–∏–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞! –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                window.location.reload();
            }, 3000);
        } else {
            throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + response.status);
        }
    } catch (error) {
        updateOtaProgress(0, '‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ' + error.message);
        showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ' + error.message, true);
        otaInProgress = false;
        document.getElementById('uploadBtn').disabled = false;
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ OTA
function updateOtaProgress(percent, message) {
    document.getElementById('otaProgressBar').style.width = percent + '%';
    document.getElementById('otaProgressText').textContent = percent + '%';
    document.getElementById('otaStatus').textContent = message;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –¥–µ—Ç–∞–ª–∏
    const details = document.getElementById('otaDetails');
    const timestamp = new Date().toLocaleTimeString();
    details.innerHTML += `[${timestamp}] ${message}\n`;
    details.scrollTop = details.scrollHeight;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
async function checkForUpdates() {
    try {
        showNotification('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...');
        
        const response = await fetch('/check_updates');
        const data = await response.json();
        
        if (data.success) {
            if (data.update_available) {
                showNotification(`üéØ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ! –¢–µ–∫—É—â–∞—è: ${data.current_version}, –ù–æ–≤–∞—è: ${data.latest_version}`);
            } else {
                showNotification('‚úÖ –£ –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏');
            }
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π', true);
    }
}

// –¢–µ—Å—Ç OTA —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
async function testOTAConnection() {
    try {
        showNotification('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OTA —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...');
        
        // –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ OTA —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        const response = await fetch('/update', {
            method: 'HEAD',
            credentials: 'include'
        });
        
        if (response.status === 200 || response.status === 401) {
            showNotification('‚úÖ OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω');
        } else {
            showNotification('‚ùå OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', true);
        }
    } catch (error) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ OTA', true);
    }
}

// –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
function showOTAInstructions() {
    const instructions = `
üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–Ø OTA –û–ë–ù–û–í–õ–ï–ù–ò–Ø:

1. üì§ –ù–∞–∂–º–∏—Ç–µ "–û—Ç–∫—Ä—ã—Ç—å OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"
2. üîê –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å:
   - –õ–æ–≥–∏–Ω: admin
   - –ü–∞—Ä–æ–ª—å: NinebotOTA123!
3. üìÅ –í—ã–±–µ—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏ (.bin)
4. ‚ö° –ù–∞–∂–º–∏—Ç–µ "Update"
5. ‚è≥ –ñ–¥–∏—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
6. üîÑ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

‚ö†Ô∏è –í–ê–ñ–ù–û:
- –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º WiFi —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏
    `;
    
    alert(instructions);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥)
document.getElementById('otaForm').addEventListener('submit', function(e) {
    if (!confirm('üöÄ –ù–∞—á–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è?\n\n–ë—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.')) {
        e.preventDefault();
        return;
    }
    showNotification('üì§ –û—Ç–∫—Ä—ã—Ç–∏–µ OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...');
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏


// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
function toggleAutoUpdate(enabled) {
    showNotification(enabled ? '–ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤–∫–ª—é—á–µ–Ω–∞' : '–ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤—ã–∫–ª—é—á–µ–Ω–∞');
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
}

function toggleUpdateNotifications(enabled) {
    showNotification(enabled ? '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã' : '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω—ã');
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
}

// –°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫
function resetSettings() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OTA?')) {
        showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ OTA —Å–±—Ä–æ—à–µ–Ω—ã');
        document.getElementById('autoUpdateCheck').checked = false;
        document.getElementById('updateNotifications').checked = true;
    }
}

// –§–∞–±—Ä–∏—á–Ω—ã–π —Å–±—Ä–æ—Å
function factoryReset() {
    if (confirm('üö® –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ–ª–Ω–æ–º—É —Å–±—Ä–æ—Å—É –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
        showNotification('–§–∞–±—Ä–∏—á–Ω—ã–π —Å–±—Ä–æ—Å –∑–∞–ø—É—â–µ–Ω...', true);
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å API –¥–ª—è —Å–±—Ä–æ—Å–∞
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
function switchTab(tabName) {
    // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫...
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });

    document.getElementById(tabName + '-tab').classList.add('active');
    event.target.classList.add('active');
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ OTA
    if (tabName === 'ota') {
        loadSystemInfo();
    }
}


    async function startSafeScan() {
        if (scanInProgress) {
            showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', true);
            return;
        }

        scanInProgress = true;
        const results = document.getElementById('scanResults');
        results.innerHTML = '';
        updateScanProgress(0, 256);

        let foundCount = 0;

        for (let index = 0; index <= 0xFF; index++) {
            if (!scanInProgress) break;

            updateScanProgress(index + 1, 256);
            document.getElementById('scanStatus').textContent = `–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: 0x${index.toString(16).toUpperCase()}`;

            try {
                const response = await fetch(`/scan_read?index=0x${index.toString(16)}`);
                const data = await response.json();

                if (data.success && data.value !== undefined) {
                    foundCount++;
                    addScanResult(`üéØ 0x${index.toString(16).toUpperCase()}: ${data.value} (0x${data.value.toString(16)})`, 'found');
                    addFoundRegister(index, data.value, 'read');
                }
            } catch (error) {
                addScanResult(`‚ùå 0x${index.toString(16).toUpperCase()}: –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è`, 'error');
            }

            // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
            await new Promise(resolve => setTimeout(resolve, 50));
        }

        scanInProgress = false;
        showNotification(`–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–π–¥–µ–Ω–æ: ${foundCount} —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤`);
    }

    // –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞–ø–∏—Å—å —Å –æ—Ç–≤–µ—Ç–æ–º)
    async function startBruteForceScan() {
        if (!confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∞–º–æ–∫–∞—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }

        if (scanInProgress) {
            showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', true);
            return;
        }

        scanInProgress = true;
        const results = document.getElementById('scanResults');
        results.innerHTML = '';
        updateScanProgress(0, 256);

        let foundCount = 0;

        for (let index = 0; index <= 0xFF; index++) {
            if (!scanInProgress) break;

            updateScanProgress(index + 1, 256);
            document.getElementById('scanStatus').textContent = `–ë—Ä—É—Ç—Ñ–æ—Ä—Å: 0x${index.toString(16).toUpperCase()}`;

            try {
                const response = await fetch(`/scan_write?index=0x${index.toString(16)}&value=0x0001`);
                const data = await response.json();

                if (data.success) {
                    foundCount++;
                    addScanResult(`üéØ 0x${index.toString(16).toUpperCase()}: –ó–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–π —Ä–µ–≥–∏—Å—Ç—Ä!`, 'found');
                    addFoundRegister(index, 1, 'write');
                }
            } catch (error) {
                addScanResult(`‚ùå 0x${index.toString(16).toUpperCase()}: –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏`, 'error');
            }

            await new Promise(resolve => setTimeout(resolve, 100));
        }

        scanInProgress = false;
        showNotification(`–ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–π–¥–µ–Ω–æ: ${foundCount} —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤`);
    }

    // –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    async function startDeepScan() {
        if (!confirm('üö® –û–ü–ê–°–ù–û: –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –ø–æ–≤—Ä–µ–¥–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–º–æ–∫–∞—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }
        showNotification('–ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ', true);
    }

    // –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    async function manualTest() {
        const indexInput = document.getElementById('manualIndex').value;
        const valueInput = document.getElementById('manualValue').value;

        if (!indexInput) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', true);
            return;
        }

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –≤ —á–∏—Å–ª–æ
        const index = parseInt(indexInput.replace('0x', ''), 16);
        if (isNaN(index)) {
            showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–Ω–¥–µ–∫—Å–∞', true);
            return;
        }

        try {
            let response, data;

            if (valueInput) {
                // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
                const value = parseInt(valueInput.replace('0x', ''), 16);
                response = await fetch(`/scan_write?index=0x${index.toString(16)}&value=0x${value.toString(16)}`);
            } else {
                // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
                response = await fetch(`/scan_read?index=0x${index.toString(16)}`);
            }

            data = await response.json();
            
            if (data.success) {
                showNotification(`‚úÖ –£—Å–ø–µ—Ö! ${valueInput ? '–ó–∞–ø–∏—Å—å' : '–ß—Ç–µ–Ω–∏–µ'} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞`);
                addScanResult(`üîß 0x${index.toString(16).toUpperCase()}: ${valueInput ? `–ó–∞–ø–∏—Å—å 0x${value.toString(16)}` : `–ß—Ç–µ–Ω–∏–µ ${data.value}`}`, 'found');
            } else {
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${data.message}`, true);
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        }
    }

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
    function startPacketLog() {
        packetLogging = true;
        packetLog = [];
        showNotification('–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –∑–∞–ø—É—â–µ–Ω–æ');
        
        // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ WebSocket)
        simulatePacketLog();
    }

    function stopPacketLog() {
        packetLogging = false;
        showNotification('–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    }

    function clearPacketLog() {
        document.getElementById('packetLog').innerHTML = '';
    }

    function simulatePacketLog() {
        if (!packetLogging) return;
        
        // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        setTimeout(() => {
            if (packetLogging) {
                const logEntry = `[${new Date().toLocaleTimeString()}] –ü–∞–∫–µ—Ç: 5A A5 02 3D 20 04 3E 36 01`;
                packetLog.push(logEntry);
                
                const logElement = document.getElementById('packetLog');
                logElement.innerHTML = packetLog.slice(-10).join('<br>');
                logElement.scrollTop = logElement.scrollHeight;
                
                simulatePacketLog();
            }
        }, 1000);
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function updateScanProgress(current, total) {
        const progress = (current / total) * 100;
        document.getElementById('scanProgress').style.width = `${progress}%`;
        document.getElementById('scanProgressText').textContent = `${current}/${total}`;
    }

    function addScanResult(message, type = '') {
        const results = document.getElementById('scanResults');
        const item = document.createElement('div');
        item.className = `scan-result-item ${type}`;
        item.textContent = message;
        results.appendChild(item);
        results.scrollTop = results.scrollHeight;
    }

    function addFoundRegister(index, value, type) {
        const foundElement = document.getElementById('foundRegisters');
        const registerInfo = document.createElement('div');
        registerInfo.style.padding = '8px';
        registerInfo.style.borderBottom = '1px solid #eee';
        registerInfo.style.fontFamily = 'monospace';
        
        const typeIcon = type === 'read' ? 'üìñ' : '‚úèÔ∏è';
        registerInfo.innerHTML = `${typeIcon} <strong>0x${index.toString(16).toUpperCase()}</strong>: ${value} <span style="color: #666;">(${type})</span>`;
        
        foundElement.appendChild(registerInfo);
    }


// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
    async function startSafeScan() {
        if (scanInProgress) {
            showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', true);
            return;
        }

        scanInProgress = true;
        const results = document.getElementById('scanResults');
        results.innerHTML = '';
        updateScanProgress(0, 256);

        let foundCount = 0;

        for (let index = 0; index <= 0xFF; index++) {
            if (!scanInProgress) break;

            updateScanProgress(index + 1, 256);
            document.getElementById('scanStatus').textContent = `–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: 0x${index.toString(16).toUpperCase()}`;

            try {
                const response = await fetch(`/scan_read?index=0x${index.toString(16)}`);
                const data = await response.json();

                if (data.success && data.value !== undefined) {
                    foundCount++;
                    addScanResult(`üéØ 0x${index.toString(16).toUpperCase()}: ${data.value} (0x${data.value.toString(16)})`, 'found');
                    addFoundRegister(index, data.value, 'read');
                }
            } catch (error) {
                addScanResult(`‚ùå 0x${index.toString(16).toUpperCase()}: –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è`, 'error');
            }

            // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
            await new Promise(resolve => setTimeout(resolve, 50));
        }

        scanInProgress = false;
        showNotification(`–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–π–¥–µ–Ω–æ: ${foundCount} —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤`);
    }

    // –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞–ø–∏—Å—å —Å –æ—Ç–≤–µ—Ç–æ–º)
    async function startBruteForceScan() {
        if (!confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∞–º–æ–∫–∞—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }

        if (scanInProgress) {
            showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', true);
            return;
        }

        scanInProgress = true;
        const results = document.getElementById('scanResults');
        results.innerHTML = '';
        updateScanProgress(0, 256);

        let foundCount = 0;

        for (let index = 0; index <= 0xFF; index++) {
            if (!scanInProgress) break;

            updateScanProgress(index + 1, 256);
            document.getElementById('scanStatus').textContent = `–ë—Ä—É—Ç—Ñ–æ—Ä—Å: 0x${index.toString(16).toUpperCase()}`;

            try {
                const response = await fetch(`/scan_write?index=0x${index.toString(16)}&value=0x0001`);
                const data = await response.json();

                if (data.success) {
                    foundCount++;
                    addScanResult(`üéØ 0x${index.toString(16).toUpperCase()}: –ó–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–π —Ä–µ–≥–∏—Å—Ç—Ä!`, 'found');
                    addFoundRegister(index, 1, 'write');
                }
            } catch (error) {
                addScanResult(`‚ùå 0x${index.toString(16).toUpperCase()}: –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏`, 'error');
            }

            await new Promise(resolve => setTimeout(resolve, 100));
        }

        scanInProgress = false;
        showNotification(`–ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–π–¥–µ–Ω–æ: ${foundCount} —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤`);
    }

    // –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    async function startDeepScan() {
        if (!confirm('üö® –û–ü–ê–°–ù–û: –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –ø–æ–≤—Ä–µ–¥–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–º–æ–∫–∞—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }
        showNotification('–ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ', true);
    }

    // –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    async function manualTest() {
        const indexInput = document.getElementById('manualIndex').value;
        const valueInput = document.getElementById('manualValue').value;

        if (!indexInput) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', true);
            return;
        }

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –≤ —á–∏—Å–ª–æ
        const index = parseInt(indexInput.replace('0x', ''), 16);
        if (isNaN(index)) {
            showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–Ω–¥–µ–∫—Å–∞', true);
            return;
        }

        try {
            let response, data;

            if (valueInput) {
                // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
                const value = parseInt(valueInput.replace('0x', ''), 16);
                response = await fetch(`/scan_write?index=0x${index.toString(16)}&value=0x${value.toString(16)}`);
            } else {
                // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
                response = await fetch(`/scan_read?index=0x${index.toString(16)}`);
            }

            data = await response.json();
            
            if (data.success) {
                showNotification(`‚úÖ –£—Å–ø–µ—Ö! ${valueInput ? '–ó–∞–ø–∏—Å—å' : '–ß—Ç–µ–Ω–∏–µ'} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞`);
                addScanResult(`üîß 0x${index.toString(16).toUpperCase()}: ${valueInput ? `–ó–∞–ø–∏—Å—å 0x${value.toString(16)}` : `–ß—Ç–µ–Ω–∏–µ ${data.value}`}`, 'found');
            } else {
                showNotification(`‚ùå –û—à–∏–±–∫–∞: ${data.message}`, true);
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        }
    }

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
    function startPacketLog() {
        packetLogging = true;
        packetLog = [];
        showNotification('–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –∑–∞–ø—É—â–µ–Ω–æ');
        
        // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ WebSocket)
        simulatePacketLog();
    }

    function stopPacketLog() {
        packetLogging = false;
        showNotification('–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    }

    function clearPacketLog() {
        document.getElementById('packetLog').innerHTML = '';
    }

    function simulatePacketLog() {
        if (!packetLogging) return;
        
        // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        setTimeout(() => {
            if (packetLogging) {
                const logEntry = `[${new Date().toLocaleTimeString()}] –ü–∞–∫–µ—Ç: 5A A5 02 3D 20 04 3E 36 01`;
                packetLog.push(logEntry);
                
                const logElement = document.getElementById('packetLog');
                logElement.innerHTML = packetLog.slice(-10).join('<br>');
                logElement.scrollTop = logElement.scrollHeight;
                
                simulatePacketLog();
            }
        }, 1000);
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    function switchTab(tabName) {
      // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
      });

      // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
      document.getElementById(tabName + '-tab').classList.add('active');
      event.target.classList.add('active');
    }



    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadStatus() {
      try {
        const [statusRes, dataRes] = await Promise.all([
          fetch('/status'),
          fetch('/data')
        ]);
        
        const statusData = await statusRes.json();
        const scooterData = await dataRes.json();
        
        if (statusData.success) {
          updateStatus(statusData.isLocked);
        }
        
        if (scooterData.success) {
          updateScooterData(scooterData);
        }
      } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', true);
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–∞–º–æ–∫–∞—Ç–∞
    function updateScooterData(data) {
      // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      document.getElementById('batteryValue').textContent = data.battery + '%';
      document.getElementById('speedValue').textContent = data.speed;
      document.getElementById('tempValue').textContent = data.temperature + '¬∞';
      document.getElementById('mileageValue').textContent = data.mileage;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
      updateButtonState('headlightBtn', 'üí° –§–∞—Ä—ã', data.headlightState);
      updateButtonState('beepBtn', 'üîä –ó–≤—É–∫', data.beepState);
      updateButtonState('cruiseBtn', '‚è±Ô∏è –ö—Ä—É–∏–∑', data.cruiseControl);
      updateButtonState('engineBtn', '‚ö° –î–≤–∏–≥–∞—Ç–µ–ª—å', data.engineState);

      // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      document.getElementById('driveVoltageValue').textContent = data.driveVoltage;
      document.getElementById('motorCurrentValue').textContent = data.motorCurrent;
      document.getElementById('powerValue').textContent = data.power;
      document.getElementById('avgSpeedValue').textContent = data.avgSpeed;
      
      // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
      document.getElementById('bodyTempValue').textContent = data.temperature + '¬∞';
      document.getElementById('bat1TempValue').textContent = data.battery1Temp + '¬∞';
      document.getElementById('bat2TempValue').textContent = data.battery2Temp + '¬∞';
      document.getElementById('mosTempValue').textContent = data.mosTemp + '¬∞';
      
      // –ë–∞—Ç–∞—Ä–µ–∏
      document.getElementById('battery1Value').textContent = data.battery1 + '%';
      document.getElementById('battery2Value').textContent = data.battery2 + '%';
      document.getElementById('actualRangeValue').textContent = data.actualRange;
      document.getElementById('predictedRangeValue').textContent = data.predictedRange;
      
      // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      document.getElementById('serialValue').textContent = data.serial || 'N/A';
      document.getElementById('bmsVersionValue').textContent = data.bmsVersion || 'N/A';
      document.getElementById('bms2VersionValue').textContent = data.bms2Version || 'N/A';
      document.getElementById('bleVersionValue').textContent = data.bleVersion || 'N/A';
      document.getElementById('boolStatusValue').textContent = data.boolStatus || 'N/A';
      document.getElementById('alarmStatusValue').textContent = data.alarmStatus || '–ù–µ—Ç';
      document.getElementById('errorValue').textContent = data.errorCode || '0';
      
      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      document.getElementById('singleMileageValue').textContent = data.singleMileage;
      document.getElementById('singleRideTimeValue').textContent = data.singleRideTime;
      document.getElementById('totalOperationTimeValue').textContent = data.totalOperationTime;
      document.getElementById('totalRideTimeValue').textContent = data.totalRideTime;
      
      document.getElementById('workModeValue').textContent = getWorkModeName(data.workMode);
      document.getElementById('speedLimitValue').textContent = data.speedLimit;
      document.getElementById('errorCodeValue').textContent = data.errorCode;
      document.getElementById('cruiseValue').textContent = data.cruiseControl ? '–í–ö–õ' : '–í–´–ö–õ';
      document.getElementById('headlightValue').textContent = data.headlightState ? '–í–ö–õ' : '–í–´–ö–õ';
      document.getElementById('beepValue').textContent = data.beepState ? '–í–ö–õ' : '–í–´–ö–õ';

      // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      document.getElementById('lockStatus').textContent = data.isLocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω';
      document.getElementById('engineStatus').textContent = data.engineState ? '–í–ö–õ' : '–í–´–ö–õ';
      document.getElementById('currentLedMode').textContent = getLedModeName(data.ledMode || 1);
      
      // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã
      document.getElementById('UnkReg1').textContent = data.UnkReg1 || 'N/A';
      document.getElementById('UnkReg2').textContent = data.UnkReg2 || 'N/A';
      document.getElementById('UnkReg3').textContent = data.UnkReg3 || 'N/A';
      document.getElementById('UnkReg4').textContent = data.UnkReg4 || 'N/A';
      document.getElementById('UnkReg5').textContent = data.UnkReg5 || 'N/A';
      document.getElementById('UnkReg6').textContent = data.UnkReg6 || 'N/A';
      document.getElementById('UnkReg7').textContent = data.UnkReg7 || 'N/A';
      document.getElementById('UnkReg8').textContent = data.UnkReg8 || 'N/A';
      document.getElementById('UnkReg9').textContent = data.UnkReg9 || 'N/A';
      document.getElementById('UnkReg10').textContent = data.UnkReg10 || 'N/A';
      document.getElementById('UnkReg11').textContent = data.UnkReg11 || 'N/A';
      document.getElementById('UnkReg12').textContent = data.UnkReg12 || 'N/A';
      document.getElementById('UnkReg13').textContent = data.UnkReg13 || 'N/A';
      document.getElementById('UnkReg14').textContent = data.UnkReg14 || 'N/A';
      document.getElementById('UnkReg15').textContent = data.UnkReg15 || 'N/A';
      document.getElementById('UnkReg16').textContent = data.UnkReg16 || 'N/A';
      document.getElementById('UnkReg17').textContent = data.UnkReg17 || 'N/A';
      document.getElementById('UnkReg18').textContent = data.UnkReg18 || 'N/A';
      document.getElementById('UnkReg19').textContent = data.UnkReg19 || 'N/A';
      document.getElementById('UnkReg20').textContent = data.UnkReg20 || 'N/A';
      document.getElementById('UnkReg21').textContent = data.UnkReg21 || 'N/A';
      document.getElementById('UnkReg22').textContent = data.UnkReg22 || 'N/A';
      document.getElementById('UnkReg23').textContent = data.UnkReg23 || 'N/A';
      document.getElementById('UnkReg24').textContent = data.UnkReg24 || 'N/A';
      document.getElementById('UnkReg25').textContent = data.UnkReg25 || 'N/A';
      document.getElementById('UnkReg26').textContent = data.UnkReg26 || 'N/A';
      document.getElementById('UnkReg27').textContent = data.UnkReg27 || 'N/A';
      document.getElementById('UnkReg28').textContent = data.UnkReg28 || 'N/A';
      document.getElementById('UnkReg29').textContent = data.UnkReg29 || 'N/A';
      document.getElementById('UnkReg30').textContent = data.UnkReg30 || 'N/A';
      document.getElementById('UnkReg31').textContent = data.UnkReg31 || 'N/A';
      document.getElementById('UnkReg32').textContent = data.UnkReg32 || 'N/A';
      document.getElementById('UnkReg33').textContent = data.UnkReg33 || 'N/A';
      document.getElementById('UnkReg34').textContent = data.UnkReg34 || 'N/A';
      document.getElementById('UnkReg35').textContent = data.UnkReg35 || 'N/A';
      document.getElementById('UnkReg36').textContent = data.UnkReg36 || 'N/A';
      document.getElementById('UnkReg37').textContent = data.UnkReg37 || 'N/A';
      document.getElementById('UnkReg38').textContent = data.UnkReg38 || 'N/A';
      document.getElementById('UnkReg39').textContent = data.UnkReg39 || 'N/A';
      


      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
      updateSettingsSwitches(data);
    }

    function getWorkModeName(mode) {
      switch(mode) {
        case 0: return 'NORMAL';
        case 1: return 'ECO';
        case 2: return 'SPORT';
        default: return 'N/A';
      }
    }

    function getLedModeName(mode) {
      const modes = {
        0: '–í—ã–∫–ª—é—á–µ–Ω–æ',
        1: '–û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ',
        2: '–í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ',
        3: '–î–≤–∞ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ',
        4: '–í—Å–µ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ',
        5: '–û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ',
        6: '–í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ',
        7: '–ü–æ–ª–∏—Ü–∏—è 1',
        8: '–ü–æ–ª–∏—Ü–∏—è 2',
        9: '–ü–æ–ª–∏—Ü–∏—è 3'
      };
      return modes[mode] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
    function updateButtonState(btnId, prefix, state) {
      const btn = document.getElementById(btnId);
      btn.innerHTML = `<span>${prefix.split(' ')[0]}</span> ${prefix.split(' ')[1]} ${state ? '–í–ö–õ' : '–í–´–ö–õ'}`;
      btn.className = state ? 'btn btn-active' : 'btn btn-toggle';
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function updateSettingsSwitches(data) {
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö —Å —Å–∞–º–æ–∫–∞—Ç–∞
      // –ù–∞–ø—Ä–∏–º–µ—Ä: document.getElementById('headlightAlwaysOn').checked = data.headlightAlwaysOn;
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
    function setLedMode(mode) {
      fetch('/led_mode?mode=' + mode)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–†–µ–∂–∏–º –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω: ' + getLedModeName(mode));
            updateLedModeButtons();
            currentLedMode = mode;
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function setLedColor(colorIndex, color) {
      fetch('/led_color?index=' + colorIndex + '&color=' + color.toString(16))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–¶–≤–µ—Ç ' + colorIndex + ' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            updateColorButtons(colorIndex, color);
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function updateLedModeButtons() {
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
      document.querySelectorAll('.led-mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é
      if (document.getElementById('ledMode' + currentLedMode)) {
        document.getElementById('ledMode' + currentLedMode).classList.add('active');
      }
    }

    function updateColorButtons(colorIndex, color) {
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ü–≤–µ—Ç–æ–≤
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    function toggleSetting(setting, enabled) {
      fetch('/' + setting + '?enabled=' + (enabled ? '1' : '0'))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function toggleHeadlight(enabled) {
      fetch('/headlight_toggle')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification(enabled ? '–§–∞—Ä—ã –≤–∫–ª—é—á–µ–Ω—ã' : '–§–∞—Ä—ã –≤—ã–∫–ª—é—á–µ–Ω—ã');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function toggleBeepAlarm(enabled) {
      fetch('/beep_alarm?enabled=' + (enabled ? '1' : '0'))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification(enabled ? '–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –≤–∫–ª—é—á–µ–Ω' : '–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –≤—ã–∫–ª—é—á–µ–Ω');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    function toggleBeepTotal(enabled) {
      fetch('/beep_total?enabled=' + (enabled ? '1' : '0'))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification(enabled ? '–û–±—â–∏–π –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω' : '–û–±—â–∏–π –∑–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏
    function setSpeedLimit(limit) {
      fetch('/speed_limit?limit=' + limit)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ' + (limit / 10) + ' –∫–º/—á');
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

    // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
    function loadDiagnostics() {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
      loadStatus();
      showNotification('–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    function startAutoRefresh() {
      autoRefreshInterval = setInterval(loadStatus, 2000);
      document.getElementById('refreshBtn').className = 'btn btn-active';
    }

    function stopAutoRefresh() {
      clearInterval(autoRefreshInterval);
      document.getElementById('refreshBtn').className = 'btn btn-primary';
    }

    function toggleDataRefresh() {
      if (autoRefreshInterval) {
        stopAutoRefresh();
      } else {
        startAutoRefresh();
      }
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥
    async function sendCommand(cmd) {
      try {
        const response = await fetch('/' + cmd);
        const data = await response.json();
        
        if (data.success) {
          showNotification(data.message);
          setTimeout(loadStatus, 500);
        } else {
          showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
        }
      } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
      }
    }


    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    let touchStartX = 0;
    let touchEndX = 0;

    document.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    });

    document.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });

    function handleSwipe() {
      const swipeMin = 50;
      if (touchStartX - touchEndX > swipeMin) {
        if (currentStatus) sendCommand('unlock');
      } else if (touchEndX - touchStartX > swipeMin) {
        if (!currentStatus) sendCommand('lock');
      }
    }

  </script>
</body>
</html>