<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent" />
    <title>Ninebot ES Controller</title>
    <style>
      :root {
        --primary: #2d3436;
        --secondary: #636e72;
        --accent: #0984e3;
        --success: #00b894;
        --danger: #d63031;
        --warning: #fdcb6e;
        --info: #6c5ce7;
        --light: #f8f9fa;
        --dark: #2d3436;
        --gray: #dfe6e9;
        --card-bg: #ffffff;
        --body-bg: #f5f6fa;
        --border-radius: 16px;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --safe-top: env(safe-area-inset-top);
        --safe-bottom: env(safe-area-inset-bottom);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      html {
        height: 100%;
        -webkit-text-size-adjust: 100%;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Inter", "Segoe UI",
          sans-serif;
        background: var(--body-bg);
        color: var(--dark);
        line-height: 1.6;
        min-height: 100vh;
        min-height: -webkit-fill-available;
        padding: 0;
        touch-action: manipulation;
        overscroll-behavior: none;
      }

      /* –ú–æ–±–∏–ª—å–Ω—ã–π header */
      .mobile-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: var(--light);
        color: white;
        padding: calc(12px + var(--safe-top, 0px)) 16px 12px;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        height: 60px;
      }

      .menu-toggle {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        padding: 8px;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .mobile-title {
        font-size: 1.1rem;
        font-weight: 600;
        flex: 1;
        text-align: center;
        margin: 0 10px;
      }

      .mobile-actions {
        display: flex;
        gap: 8px;
        width: 120px;
        justify-content: flex-end;
      }

      /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .sidebar {
        width: 280px;
        background: var(--light);
        color: white;
        padding: 30px 20px;
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        height: 100dvh;
        box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
        z-index: 1001;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        padding-top: max(30px, var(--safe-top, 30px));
        padding-bottom: max(20px, var(--safe-bottom, 20px));
        transform: translateX(-100%);
      }

      .sidebar.mobile-visible {
        transform: translateX(0);
      }

      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
      }

      .sidebar-overlay.active {
        display: block;
      }

      /* –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
      .main-content {
        flex: 1;
        padding: 0;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding-top: 60px;
        padding-bottom: 80px;
        padding-left: 16px;
        padding-right: 16px;
        width: 100%;
        min-height: 100vh;
        position: relative;
      }

      /* –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å) */
      .mobile-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--card-bg);
        border-top: 1px solid var(--gray);
        display: flex;
        justify-content: space-around;
        padding: 8px 4px calc(8px + var(--safe-bottom, 0px));
        z-index: 999;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        height: 80px;
      }

      .mobile-nav-item {
        flex: 1;
        display: grid;
        flex-direction: column;
        align-items: center;
        padding: 8px 4px;
        border-radius: 12px;
        text-decoration: none;
        color: var(--secondary);
        font-size: 0.7rem;
        transition: var(--transition);
        min-height: 56px;
        cursor: pointer;
        border: none;
        background: transparent;
      }

      .mobile-nav-item.active {
        color: var(--accent);
        background: rgba(9, 132, 227, 0.1);
      }

      .mobile-nav-icon {
        font-size: 20px;
        margin-bottom: 4px;
      }

      /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .card {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 16px;
        margin-top: 20px;
        box-shadow: var(--shadow);
        transition: var(--transition);
        border: 0.5px solid var(--gray);
      }

      /* –ü–æ—Å–ª–µ —Å—Ç–∏–ª–µ–π .card */
      .card-locked {
        background: linear-gradient(135deg, #ff6b6b, #ee5a52) !important;
        border-color: #ff4757 !important;
        color: white !important;
      }

      .card-unlocked {
        background: linear-gradient(135deg, #1dd1a1, #10ac84) !important;
        border-color: #00b894 !important;
        color: white !important;
      }

      /* –ß—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –±—ã–ª —á–∏—Ç–∞–µ–º—ã–º */
      .card-locked .value-display,
      .card-unlocked .value-display {
        color: white !important;
      }

      .card-locked .value-unit,
      .card-unlocked .value-unit {
        color: rgba(255, 255, 255, 0.9) !important;
      }

      .card-locked .btn-outline,
      .card-unlocked .btn-outline {
        background: rgba(255, 255, 255, 0.15) !important;
        border-color: rgba(255, 255, 255, 0.3) !important;
        color: white !important;
      }

      .card-locked .btn-outline:active,
      .card-unlocked .btn-outline:active {
        background: rgba(255, 255, 255, 0.25) !important;
      }

      .card.interactive {
        cursor: pointer;
      }

      .card.interactive:active {
        transform: scale(0.98);
      }

      /* –ö–Ω–æ–ø–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–∞ */
      .btn {
        padding: 14px 20px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-align: center;
        min-height: 48px;
        touch-action: manipulation;
        user-select: none;
        position: relative;
        overflow: hidden;
      }

      .btn:active {
        transform: scale(0.95);
      }

      .btn-primary {
        background: var(--accent);
        color: white;
      }

      .btn-success {
        background: var(--success);
        color: white;
      }

      .btn-danger {
        background: var(--danger);
        color: white;
      }

      .btn-warning {
        background: var(--warning);
        color: var(--dark);
      }

      .btn-info {
        background: var(--info);
        color: white;
      }

      .btn-block {
        width: 100%;
      }

      .btn-outline {
        background: transparent;
        border: 1px solid var(--gray);
        box-shadow: var(--shadow);
        color: var(--secondary);
      }

      .btn-outline.active {
        border-color: var(--accent);
        color: var(--accent);
        background: rgba(9, 132, 227, 0.1);
      }

      /* –°–≤–∞–π–ø-–ø–∞–Ω–µ–ª—å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
      .swipe-control {
        background: linear-gradient(135deg, var(--accent), var(--info));
        color: white;
        padding: 20px;
        border-radius: var(--border-radius);
        margin: 16px 0;
        text-align: center;
        position: relative;
        overflow: hidden;
        user-select: none;
      }

      .swipe-track {
        position: relative;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 30px;
        margin: 20px 0;
        overflow: hidden;
      }

      .swipe-handle {
        position: absolute;
        left: 4px;
        top: 4px;
        background: rgba(255, 255, 255, 0.9);
        color: var(--light);
        height: 52px;
        width: 52px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        cursor: grab;
        touch-action: none;
        z-index: 2;
      }

      .swipe-progress {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        background: rgba(255, 255, 255, 0.3);
        width: 0%;
        transition: width 0.1s;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
      .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 16px;
      }

      .grid-3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 16px;
      }

      .grid-4 {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
        margin-bottom: 16px;
      }

      .grid-5 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 16px;
      }

      /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
      .value-display {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--primary);
        line-height: 1;
        text-align: center;
      }

      .value-unit {
        font-size: 1rem;
        color: white;
        font-weight: 500;
      }

      /* –ü–æ–ª–∑—É–Ω–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .slider-container {
        padding: 20px 0;
      }

      input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: var(--gray);
        outline: none;
        margin: 15px 0;
        position: relative;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--accent);
        cursor: pointer;
        border: 3px solid white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      /* –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ –º–µ–Ω—é */
      .action-sheet {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--card-bg);
        border-radius: 20px 20px 0 0;
        padding: 20px;
        padding-bottom: calc(20px + var(--safe-bottom, 0px));
        z-index: 1002;
        transform: translateY(100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
        max-height: 90vh;
        overflow-y: auto;
      }

      .action-sheet.active {
        transform: translateY(0);
      }

      .action-sheet-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 20px;
        text-align: center;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--gray);
      }

      .action-sheet-item {
        padding: 16px;
        border-bottom: 1px solid var(--gray);
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        background: transparent;
        border: none;
        width: 100%;
        text-align: left;
        font-size: 1rem;
        color: var(--dark);
      }

      .action-sheet-item:active {
        background: var(--gray);
      }

      .action-sheet-cancel {
        margin-top: 12px;
        padding: 16px;
        text-align: center;
        color: var(--danger);
        font-weight: 600;
        border-radius: 12px;
        background: rgba(214, 48, 49, 0.1);
        cursor: pointer;
        border: none;
        width: 100%;
      }

      /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .notification {
        position: fixed;
        top: 20px;
        left: 16px;
        right: 16px;
        background: var(--card-bg);
        color: var(--dark);
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        transform: translateY(-100px);
        transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        z-index: 1003;
        border-left: 4px solid var(--success);
        display: flex;
        align-items: center;
        gap: 12px;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
      }

      .notification.error {
        border-left-color: var(--danger);
      }

      .notification.warning {
        border-left-color: var(--warning);
      }

      .notification.info {
        border-left-color: var(--accent);
      }

      .notification.show {
        transform: translateY(0);
      }

      .notification-icon {
        font-size: 20px;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã */
      @media (max-width: 768px) {
        .grid-2 {
          grid-template-columns: repeat(2, 1fr);
          gap: 8px;
        }

        .grid-3 {
          grid-template-columns: repeat(2, 1fr);
        }

        .grid-4 {
          grid-template-columns: repeat(2, 1fr);
        }

        .mobile-nav-item {
          min-height: 52px;
          padding: 6px 2px;
          font-size: 0.65rem;
        }

        .mobile-nav-icon {
          font-size: 18px;
        }

        .swipe-control {
          padding: 16px;
        }

        .swipe-handle {
          width: 50px;
          height: 50px;
        }

        .value-display {
          font-size: 2rem;
        }
      }

      @media (max-width: 480px) {
        .grid-4 {
          grid-template-columns: repeat(2, 1fr);
        }

        .grid-5 {
          grid-template-columns: repeat(3, 1fr);
        }

        .value-display {
          font-size: 1.8rem;
        }

        /* .mobile-nav-item span {
        font-size: 0.65rem;
      } */

        .card {
          padding: 16px;
        }
      }

      /* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ */
      @media (orientation: landscape) and (max-height: 600px) {
        .mobile-nav {
          display: none;
        }

        .main-content {
          padding-bottom: 20px;
        }
      }

      /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
      @media (prefers-color-scheme: dark) {
        :root {
          --primary: #ffffff;
          --secondary: #b2bec3;
          --accent: #74b9ff;
          --success: #00cec9;
          --danger: #ff7675;
          --warning: #fdcb6e;
          --info: #a29bfe;
          --light: #222222;
          --dark: #ffffff;
          --gray: #4a4a4a;
          --card-bg: #222222;
          --body-bg: #141414;
          --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.4);
        }

        .mobile-nav {
          border-top: 1px solid #4a4a4a;
        }

        .action-sheet {
          background: #2d3436;
        }
      }

      /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-slide {
        animation: slideUp 0.3s ease-out;
      }

      /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ zoom –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ iOS */
      input,
      select,
      textarea {
        font-size: 16px !important;
      }

      /* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .scrollable {
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
      }

      /* –°–∫—Ä—ã—Ç–∏–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .scrollable::-webkit-scrollbar {
        display: none;
      }

      /* –í–∫–ª–∞–¥–∫–∏ */
      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* –õ–æ–≥–æ –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      }

      .logo-icon {
        font-size: 32px;
        background: linear-gradient(135deg, var(--accent), var(--info));
        padding: 12px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 56px;
        height: 56px;
      }

      .logo-text h1 {
        font-size: 1.4rem;
        font-weight: 700;
        margin-bottom: 4px;
      }

      .logo-text p {
        font-size: 0.85rem;
        opacity: 0.8;
      }

      /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
      .nav-menu {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        overflow-y: auto;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 16px;
        border-radius: 12px;
        text-decoration: none;
        color: rgba(255, 255, 255, 0.8);
        font-weight: 500;
        transition: var(--transition);
        cursor: pointer;
        border: none;
        background: transparent;
        text-align: left;
        font-size: 1rem;
      }

      .nav-item:hover,
      .nav-item:active {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        transform: translateX(5px);
      }

      .nav-item.active {
        background: var(--accent);
        color: white;
        box-shadow: 0 5px 15px rgba(9, 132, 227, 0.3);
      }

      .nav-item .icon {
        font-size: 20px;
        width: 24px;
        text-align: center;
      }

      /* –°—Ç–∞—Ç—É—Å –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
      .status-bar {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid rgba(255, 255, 255, 0.1);
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        margin-bottom: 10px;
      }

      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--success);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }

        50% {
          opacity: 0.5;
        }

        100% {
          opacity: 1;
        }
      }

      /* –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ */
      .unknown-registers {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 12px;
        margin-top: 20px;
      }

      .register-item {
        background: var(--gray);
        padding: 12px;
        border-radius: 8px;
        font-family: monospace;
        font-size: 0.85rem;
        word-break: break-all;
      }

      .register-label {
        font-weight: 600;
        margin-bottom: 4px;
        color: var(--secondary);
      }

      .register-value {
        color: var(--accent);
        font-weight: bold;
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ */
      .scan-controls {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        margin-bottom: 20px;
      }

      .scan-btn {
        padding: 16px;
        border-radius: 12px;
        border: none;
        color: white;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: var(--transition);
      }

      .scan-btn:active {
        transform: scale(0.98);
      }

      .scan-btn.safe {
        background: var(--success);
      }

      .scan-btn.warning {
        background: var(--warning);
        color: var(--dark);
      }

      .scan-btn.danger {
        background: var(--danger);
      }

      .scan-progress {
        height: 8px;
        background: var(--gray);
        border-radius: 4px;
        overflow: hidden;
        margin: 20px 0;
      }

      .scan-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--success), var(--accent));
        transition: width 0.3s ease;
        width: 0%;
      }

      /* LED —Ä–µ–∂–∏–º—ã */
      .led-mode-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 20px;
      }

      .led-mode-btn {
        padding: 16px;
        background: var(--gray);
        border-radius: 12px;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.9rem;
      }

      .led-mode-btn:active {
        background: var(--accent);
        color: white;
        transform: scale(0.95);
      }

      /* –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ */
      .color-picker {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 12px;
        margin-top: 15px;
      }

      .color-option {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        transition: var(--transition);
        border: 3px solid transparent;
      }

      .color-option:active {
        transform: scale(0.9);
        border-color: var(--accent);
      }

      /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ */
      .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
        border-bottom: 1px solid var(--gray);
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 26px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: var(--success);
      }

      input:checked + .slider:before {
        transform: translateX(24px);
      }

      /* –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –¥–∞–Ω–Ω—ã—Ö */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .data-table th,
      .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--gray);
      }

      .data-table th {
        background: var(--gray);
        font-weight: 600;
      }

      /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –æ—à–∏–±–æ–∫ */
      .error-indicator {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-left: 8px;
      }

      .error-indicator.none {
        background: var(--success);
        color: white;
      }

      .error-indicator.warning {
        background: var(--warning);
        color: var(--dark);
      }

      .error-indicator.error {
        background: var(--danger);
        color: white;
      }

      /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-top: 20px;
      }

      .stat-card {
        background: var(--gray);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 8px;
      }

      .stat-label {
        font-size: 0.9rem;
        color: var(--secondary);
      }

      /* Material Design –±–∞—Ç–∞—Ä–µ—è */
      .material-battery {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 60px;
        height: 24px;
        position: relative;
      }

      .material-battery-shape {
        width: 50px;
        height: 20px;
        border: 2px solid currentColor;
        border-radius: 4px;
        position: relative;
      }

      .material-battery-shape::after {
        content: "";
        position: absolute;
        right: -6px;
        top: 50%;
        transform: translateY(-50%);
        width: 5px;
        height: 8px;
        background: currentColor;
        border-radius: 0 2px 2px 0;
      }

      .material-battery-fill {
        position: absolute;
        top: 2px;
        left: 2px;
        bottom: 2px;
        border-radius: 2px;
        background: currentColor;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* –¶–≤–µ—Ç–æ–≤—ã–µ —Ç–µ–º—ã */
      .material-battery[data-theme="light"] {
        color: #333;
      }

      .material-battery[data-theme="dark"] {
        color: #fff;
      }

      .material-battery[data-theme="green"] .material-battery-fill {
        background: linear-gradient(90deg, #4caf50, #8bc34a);
      }

      .material-battery[data-theme="yellow"] .material-battery-fill {
        background: linear-gradient(90deg, #adaf4c, #adc34a);
      }

      .material-battery[data-theme="red"] .material-battery-fill {
        background: linear-gradient(90deg, #af4c4c, #c34a4a);
      }

      .material-battery[data-theme="gradient"] .material-battery-fill {
        background: linear-gradient(90deg, #4cd964, #2196f3, #9c27b0);
      }

      /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞—Ä—è–¥–∫–∏ */
      @keyframes chargingWave {
        0% {
          background-position: 0% 50%;
        }

        50% {
          background-position: 100% 50%;
        }

        100% {
          background-position: 0% 50%;
        }
      }

      .material-battery.charging .material-battery-fill {
        background: linear-gradient(90deg, #4cd964, #34c759, #4cd964, #34c759);
        background-size: 200% 100%;
        animation: chargingWave 2s linear infinite;
      }

      /* –¢–µ–∫—Å—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
      .material-battery-percent {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.65rem;
        font-weight: 700;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        z-index: 1;
      }

      /* –í–∞—Ä–∏–∞–Ω—Ç —Å –∏–∫–æ–Ω–∫–æ–π –≤–Ω—É—Ç—Ä–∏ */
      .battery-with-icon {
        display: flex;
        align-items: center;
        gap: 8px;
        /* padding: 10px 15px; */
        background: rgba(0, 0, 0, 0.1);
        border-radius: 10px;
      }

      .battery-label {
        font-size: 0.9rem;
        opacity: 0.8;
      }

      .top-bar {              
        box-shadow: var(--shadow);
        border-radius: 16px;
        padding: 16px;
        margin-top: 20px;
      }

    </style>
  </head>

  <body>
    <!-- –ú–æ–±–∏–ª—å–Ω—ã–π —Ö–µ–¥–µ—Ä -->
    <div class="mobile-header">
      <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
      <div class="mobile-title" id="mobileTitle">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
      <div class="mobile-actions">
        <button
          class="btn btn-outline"
          style="padding: 8px; min-height: 40px; min-width: 40px"
          onclick="toggleDataRefresh()">
          üóò
        </button>
        <div class="battery-with-icon">
          <div class="material-battery" id="materialBattery" data-theme="green">
            <div class="material-battery-shape">
              <div class="material-battery-fill" id="materialBatteryFill"></div>
            </div>
            <span class="material-battery-percent" id="materialBatteryPercent"
              >?</span
            >
          </div>
        </div>
      </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="sidebar">
      <div class="logo" style="margin-bottom: 30px">
        <div class="logo-icon">üõ¥</div>
        <div class="logo-text">
          <h1>Ninebot ES</h1>
          <p>–ú–æ–±–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä</p>
        </div>
      </div>

      <nav class="nav-menu scrollable">
        <button class="nav-item active" onclick="switchTab('dashboard')">
          <span class="icon">üìä</span>
          <span>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
        </button>
        <button class="nav-item" onclick="switchTab('extended')">
          <span class="icon">üîç</span>
          <span>–î–µ—Ç–∞–ª–∏</span>
        </button>
        <button class="nav-item" onclick="switchTab('lights')">
          <span class="icon">üåà</span>
          <span>–ü–æ–¥—Å–≤–µ—Ç–∫–∞</span>
        </button>
        <button class="nav-item" onclick="switchTab('stats')">
          <span class="icon">üìà</span>
          <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
        </button>
        <button class="nav-item" onclick="switchTab('settings')">
          <span class="icon">‚öôÔ∏è</span>
          <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
        </button>
        <button class="nav-item" onclick="switchTab('research')">
          <span class="icon">üî¨</span>
          <span>–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</span>
        </button>
        <button class="nav-item" onclick="switchTab('system')">
          <span class="icon">üíª</span>
          <span>–°–∏—Å—Ç–µ–º–∞</span>
        </button>
        <button class="nav-item" onclick="switchTab('ota')">
          <span class="icon">üîÑ</span>
          <span>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
        </button>
      </nav>

      <div class="status-bar">
        <div class="status-indicator">
          <div class="status-dot" id="connectionStatus"></div>
          <div id="connectionText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        <div
          style="
            font-size: 0.85rem;
            opacity: 0.8;
            text-align: center;
            margin-top: 10px;
          ">
          <div>–ë–∞—Ç–∞—Ä–µ—è: <span id="sidebarBattery">0%</span></div>
          <div id="sidebarSpeed">–°–∫–æ—Ä–æ—Å—Ç—å: 0 –∫–º/—á</div>
        </div>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    <div class="main-content scrollable">
      <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
      <div id="dashboard-tab" class="tab-content active">
        <!-- –°–≤–∞–π–ø-–∫–æ–Ω—Ç—Ä–æ–ª—å –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ -->
        <div class="swipe-control animate-slide" id="swipeControl">
          <div
            class="grid-5 top-bar">
            <div style="text-align: center">
              <div class="value-display" id="batteryValue">
                0<span class="value-unit">%</span>
              </div>
              <div style="font-size: 0.85rem; color: white; margin-top: 4px">
                –ë–∞—Ç–∞—Ä–µ—è
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="actualRangeValue">
                0<span class="value-unit">–∫–º</span>
              </div>
              <div style="font-size: 0.85rem; color: white; margin-top: 4px">
                –ó–∞–ø–∞—Å —Ö–æ–¥–∞
              </div>
            </div>
            <!-- <div style="text-align: center">
              <div class="value-display" id="speedValue">
                0<span class="value-unit">–∫–º/—á</span>
              </div>
              <div style="font-size: 0.85rem; color: white; margin-top: 4px">
                –°–∫–æ—Ä–æ—Å—Ç—å
              </div>
            </div> -->
            <div style="text-align: center">
              <div class="value-display" id="tempValue">
                0<span class="value-unit">¬∞C</span>
              </div>
              <div style="font-size: 0.85rem; color: white; margin-top: 4px">
                –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
              </div>
            </div>
          </div>
          <img
            src="head.png"
            alt="–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
            style="max-width: 100%" />
          <div
            style="
              text-align: center;
              margin-top: 16px;
              font-size: 0.9rem;
              color: white;
            ">
            <span id="statusText">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
          </div>
          <div class="swipe-track">
            <div class="swipe-progress" id="swipeProgress"></div>
            <div
              class="swipe-handle"
              id="swipeHandle"
              ontouchstart="handleSwipeStart(event)"
              ontouchmove="handleSwipeMove(event)"
              ontouchend="handleSwipeEnd(event)">
              ‚ûú
            </div>
          </div>
          <div
            style="font-size: 0.85rem; opacity: 0.9; margin-top: 12px"
            id="swipeInstruction">
            –ü–æ—Ç—è–Ω–∏—Ç–µ –≤–ø—Ä–∞–≤–æ —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
          </div>
        </div>

        <button
          class="btn btn-outline"
          onclick="sendCommand('open_deck')"
          style="
            padding: 13px;
            width: 100%;
            display: flex;
            align-items: center;
            gap: 12px;
            border-radius: 16px;
            margin-bottom: 12px;
            background: var(--card-bg);
            border: 1px solid var(--gray);
            color: var(--secondary);
            font-weight: 600;
          ">
          <span style="font-size: 20px">üì¶</span>
          <span style="font-size: 0.75rem">–û—Ç–∫—Ä—ã—Ç—å –¥–µ–∫—É</span>
        </button>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="card animate-slide">
          <div
            style="
              font-weight: 600;
              margin-bottom: 16px;
              display: flex;
              align-items: center;
              gap: 8px;
            ">
            <span>‚ö°</span> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
          </div>
          <div class="grid-3">
            <button
              class="btn btn-outline"
              onclick="sendCommand('find_scooter')"
              style="flex-direction: column; padding: 12px">
              <span style="font-size: 20px">üîç</span>
              <span style="font-size: 0.75rem">–ù–∞–π—Ç–∏</span>
            </button>
            <button
              class="btn btn-outline"
              onclick="showActionSheet('power')"
              style="flex-direction: column; padding: 12px">
              <span style="font-size: 20px">üîã</span>
              <span style="font-size: 0.75rem">–ü–∏—Ç–∞–Ω–∏–µ</span>
            </button>
            <button
              class="btn btn-outline"
              onclick="toggleDataRefresh()"
              style="flex-direction: column; padding: 12px">
              <span style="font-size: 20px">üîÑ</span>
              <span style="font-size: 0.75rem">–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
            </button>
            <button
              class="btn btn-outline"
              onclick="sendCommand('toggle_limit')"
              style="flex-direction: column; padding: 12px">
              <span style="font-size: 20px">üìè</span>
              <span style="font-size: 0.75rem">–õ–∏–º–∏—Ç</span>
            </button>
            <button
              class="btn btn-outline"
              onclick="toggleCruise()"
              style="flex-direction: column; padding: 12px"
              id="cruiseBtn">
              <span style="font-size: 20px">‚è±Ô∏è</span>
              <span style="font-size: 0.75rem">–ö—Ä—É–∏–∑</span>
            </button>
          </div>
        </div>

        <!-- –†–µ–∂–∏–º—ã —Å–∫–æ—Ä–æ—Å—Ç–∏ -->
        <div class="card animate-slide">
          <div
            style="
              font-weight: 600;
              margin-bottom: 16px;
              display: flex;
              align-items: center;
              gap: 8px;
            ">
            <span>üéÆ</span> –†–µ–∂–∏–º —Å–∫–æ—Ä–æ—Å—Ç–∏
          </div>
          <div class="grid-5">
            <button
              class="btn btn-outline"
              onclick="sendCommand('mode_eco')"
              id="modeEcoBtn"
              style="padding: 12px">
              –≠–∫–æ
            </button>
            <button
              class="btn btn-outline"
              onclick="sendCommand('mode_normal')"
              id="modeNormalBtn"
              style="padding: 12px">
              –°—Ç–∞–Ω–¥–∞—Ä—Ç
            </button>
            <button
              class="btn btn-outline active"
              onclick="sendCommand('mode_sport')"
              id="modeSportBtn"
              style="padding: 12px">
              –°–ø–æ—Ä—Ç
            </button>
          </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ -->
        <div class="card animate-slide">
          <div
            style="
              font-weight: 600;
              margin-bottom: 16px;
              display: flex;
              align-items: center;
              gap: 8px;
            ">
            <span>üîß</span> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
          </div>
          <div class="grid-2">
            <button
              class="btn btn-outline"
              onclick="toggleFunction('headlight')"
              id="headlightBtn"
              style="padding: 14px">
              <span>üí°</span> –§–∞—Ä—ã
            </button>
            <button
              class="btn btn-outline"
              onclick="toggleFunction('beep')"
              id="beepBtn"
              style="padding: 14px">
              <span>üîä</span> –ó–≤—É–∫
            </button>
          </div>
        </div>

        <!-- –õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ -->
        <div class="card animate-slide">
          <div
            style="
              font-weight: 600;
              margin-bottom: 16px;
              display: flex;
              align-items: center;
              justify-content: space-between;
            ">
            <div style="display: flex; align-items: center; gap: 8px">
              <span>üìè</span> –õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
            </div>
            <div
              style="font-size: 1.2rem; font-weight: 700"
              id="speedLimitValue">
              35 –∫–º/—á
            </div>
          </div>
          <div class="slider-container">
            <input
              type="range"
              min="15"
              max="35"
              value="35"
              step="5"
              class="speed-slider"
              id="speedSlider"
              oninput="updateSpeedLimit(this.value)" />
            <div
              style="
                display: flex;
                justify-content: space-between;
                font-size: 0.85rem;
                color: var(--secondary);
              ">
              <span>15</span>
              <span>20</span>
              <span>25</span>
              <span>30</span>
              <span>35</span>
            </div>
          </div>
        </div>
      </div>

      <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <div id="extended-tab" class="tab-content">
        <!-- –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üîß –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
          <div class="grid-4">
            <div style="text-align: center">
              <div class="value-display" id="driveVoltageValue">
                0.0<span style="font-size: 0.8rem">V</span>
              </div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="motorCurrentValue">
                0.0<span style="font-size: 0.8rem">A</span>
              </div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –¢–æ–∫
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="powerValue">
                0<span style="font-size: 0.8rem">W</span>
              </div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –ú–æ—â–Ω–æ—Å—Ç—å
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="avgSpeedValue">
                0<span style="font-size: 0.8rem">–∫–º/—á</span>
              </div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –°—Ä. —Å–∫–æ—Ä–æ—Å—Ç—å
              </div>
            </div>
          </div>
        </div>

        <!-- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã -->
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</h3>
          <div class="grid-4">
            <div style="text-align: center">
              <div class="value-display" id="bodyTempValue">0¬∞</div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –ö–æ—Ä–ø—É—Å
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="bat1TempValue">0¬∞</div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –ë–∞—Ç–∞—Ä–µ—è 1
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="bat2TempValue">0¬∞</div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –ë–∞—Ç–∞—Ä–µ—è 2
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="mosTempValue">0¬∞</div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                MOS
              </div>
            </div>
          </div>
        </div>

        <!-- –ë–∞—Ç–∞—Ä–µ–∏ -->
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üîã –ë–∞—Ç–∞—Ä–µ–∏</h3>
          <div class="grid-4">
            <div style="text-align: center">
              <div class="value-display" id="battery1Value">0%</div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –ë–∞—Ç–∞—Ä–µ—è 1
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="battery2Value">0%</div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –ë–∞—Ç–∞—Ä–µ—è 2
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="actualRangeValue">
                0<span style="font-size: 0.8rem">–∫–º</span>
              </div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –ó–∞–ø–∞—Å —Ö–æ–¥–∞
              </div>
            </div>
            <div style="text-align: center">
              <div class="value-display" id="predictedRangeValue">
                0<span style="font-size: 0.8rem">–∫–º</span>
              </div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--secondary);
                  margin-top: 4px;
                ">
                –ü—Ä–æ–≥–Ω–æ–∑
              </div>
            </div>
          </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üìä –°–∏—Å—Ç–µ–º–∞</h3>
          <div class="grid-2" style="gap: 16px">
            <div>
              <p>
                <strong>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä:</strong>
                <span id="serialValue">N/A</span>
              </p>
              <p>
                <strong>BMS –≤–µ—Ä—Å–∏—è:</strong>
                <span id="bmsVersionValue">N/A</span>
              </p>
              <p>
                <strong>–í–Ω–µ—à–Ω—è—è BMS:</strong>
                <span id="bms2VersionValue">N/A</span>
              </p>
              <p>
                <strong>BLE –≤–µ—Ä—Å–∏—è:</strong>
                <span id="bleVersionValue">N/A</span>
              </p>
            </div>
            <div>
              <p>
                <strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="boolStatusValue">N/A</span>
              </p>
              <p>
                <strong>–¢—Ä–µ–≤–æ–≥–∏:</strong> <span id="alarmStatusValue">–ù–µ—Ç</span>
              </p>
              <p><strong>–û—à–∏–±–∫–∏:</strong> <span id="errorValue">0</span></p>
            </div>
          </div>
        </div>
      </div>

      <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ -->
      <div id="lights-tab" class="tab-content">
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üåà –†–µ–∂–∏–º—ã –ø–æ–¥—Å–≤–µ—Ç–∫–∏</h3>
          <div class="led-mode-grid">
            <div class="led-mode-btn" onclick="setLedMode(0)" id="ledMode0">
              –í—ã–∫–ª—é—á–µ–Ω–æ
            </div>
            <div class="led-mode-btn" onclick="setLedMode(1)" id="ledMode1">
              –û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ
            </div>
            <div class="led-mode-btn" onclick="setLedMode(2)" id="ledMode2">
              –í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ
            </div>
            <div class="led-mode-btn" onclick="setLedMode(3)" id="ledMode3">
              –î–≤–∞ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ
            </div>
            <div class="led-mode-btn" onclick="setLedMode(4)" id="ledMode4">
              –í—Å–µ —Ü–≤–µ—Ç–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–æ
            </div>
            <div class="led-mode-btn" onclick="setLedMode(5)" id="ledMode5">
              –û–¥–Ω–æ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ
            </div>
            <div class="led-mode-btn" onclick="setLedMode(6)" id="ledMode6">
              –í—Å–µ—Ü–≤–µ—Ç–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ
            </div>
            <div class="led-mode-btn" onclick="setLedMode(7)" id="ledMode7">
              –ü–æ–ª–∏—Ü–∏—è 1
            </div>
            <div class="led-mode-btn" onclick="setLedMode(8)" id="ledMode8">
              –ü–æ–ª–∏—Ü–∏—è 2
            </div>
            <div class="led-mode-btn" onclick="setLedMode(9)" id="ledMode9">
              –ü–æ–ª–∏—Ü–∏—è 3
            </div>
          </div>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üé® –¶–≤–µ—Ç–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏</h3>
          <div style="margin: 20px 0">
            <h4 style="margin-bottom: 12px">–¶–≤–µ—Ç 1 (–û—Å–Ω–æ–≤–Ω–æ–π)</h4>
            <div class="color-picker">
              <div
                class="color-option"
                style="background: rgb(0, 0, 255)"
                onclick="setLedColor(1, 0xA0F0)"
                title="–°–∏–Ω–∏–π"></div>
              <div
                class="color-option"
                style="background: rgb(0, 255, 0)"
                onclick="setLedColor(1, 0x50F0)"
                title="–ó–µ–ª–µ–Ω—ã–π"></div>
              <div
                class="color-option"
                style="background: rgb(255, 0, 0)"
                onclick="setLedColor(1, 0x00F0)"
                title="–ö—Ä–∞—Å–Ω—ã–π"></div>
              <div
                class="color-option"
                style="background: rgb(255, 0, 255)"
                onclick="setLedColor(1, 0xC8F0)"
                title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
              <div
                class="color-option"
                style="background: rgb(255, 255, 255)"
                onclick="setLedColor(1, 0xF0F0)"
                title="–ë–µ–ª—ã–π"></div>
              <div
                class="color-option"
                style="background: rgb(255, 255, 0)"
                onclick="setLedColor(1, 0xFFF0)"
                title="–ñ–µ–ª—Ç—ã–π"></div>
            </div>
          </div>

          <div style="margin: 20px 0">
            <h4 style="margin-bottom: 12px">–¶–≤–µ—Ç 2 (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π)</h4>
            <div class="color-picker">
              <div
                class="color-option"
                style="background: rgb(0, 0, 255)"
                onclick="setLedColor(2, 0xA0F0)"
                title="–°–∏–Ω–∏–π"></div>
              <div
                class="color-option"
                style="background: rgb(0, 255, 0)"
                onclick="setLedColor(2, 0x50F0)"
                title="–ó–µ–ª–µ–Ω—ã–π"></div>
              <div
                class="color-option"
                style="background: rgb(255, 0, 0)"
                onclick="setLedColor(2, 0x00F0)"
                title="–ö—Ä–∞—Å–Ω—ã–π"></div>
              <div
                class="color-option"
                style="background: rgb(255, 0, 255)"
                onclick="setLedColor(2, 0xC8F0)"
                title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
              <div
                class="color-option"
                style="background: rgb(255, 255, 255)"
                onclick="setLedColor(2, 0xF0F0)"
                title="–ë–µ–ª—ã–π"></div>
              <div
                class="color-option"
                style="background: rgb(255, 255, 0)"
                onclick="setLedColor(2, 0xFFF0)"
                title="–ñ–µ–ª—Ç—ã–π"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div id="stats-tab" class="tab-content">
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–µ–∑–¥–æ–∫</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="singleMileageValue">0</div>
              <div class="stat-label">–ü—Ä–æ–±–µ–≥ –ø–æ–µ–∑–¥–∫–∏ (–∫–º)</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="singleRideTimeValue">0</div>
              <div class="stat-label">–í—Ä–µ–º—è –ø–æ–µ–∑–¥–∫–∏ (–º–∏–Ω)</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="totalOperationTimeValue">0</div>
              <div class="stat-label">–û–±—â–µ–µ –≤—Ä–µ–º—è (—á)</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="totalRideTimeValue">0</div>
              <div class="stat-label">–í—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è (—á)</div>
            </div>
          </div>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
          <div style="margin-top: 15px">
            <p>
              <strong>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</strong> <span id="workModeValue">N/A</span>
            </p>
            <p>
              <strong>–õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏:</strong>
              <span id="speedLimitValue">0</span> –∫–º/—á
            </p>
            <p>
              <strong>–ö–æ–¥ –æ—à–∏–±–∫–∏:</strong> <span id="errorCodeValue">0</span>
            </p>
            <p>
              <strong>–ö—Ä—É–∏–∑-–∫–æ–Ω—Ç—Ä–æ–ª—å:</strong>
              <span id="cruiseValue">–í–´–ö–õ</span>
            </p>
            <p><strong>–§–∞—Ä—ã:</strong> <span id="headlightValue">–í–ö–õ</span></p>
            <p><strong>–ó–≤—É–∫:</strong> <span id="beepValue">–í–ö–õ</span></p>
          </div>
        </div>
      </div>

      <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div id="settings-tab" class="tab-content">
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π</h3>
          <div style="margin-top: 20px">
            <div class="setting-row">
              <span class="setting-label">–§–∞—Ä—ã –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω—ã</span>
              <label class="switch">
                <input
                  type="checkbox"
                  id="headlightAlwaysOn"
                  onchange="toggleSetting('headlight_always_on', this.checked)" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-row">
              <span class="setting-label">–°–∫–æ—Ä–æ—Å—Ç—å –≤ MPH (–≤–º–µ—Å—Ç–æ KM/H)</span>
              <label class="switch">
                <input
                  type="checkbox"
                  id="speedInMPH"
                  onchange="toggleSetting('speed_mph', this.checked)" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-row">
              <span class="setting-label"
                >–û—Ç–∫–ª—é—á–∏—Ç—å —Ç—Ä–µ–≤–æ–≥—É –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ</span
              >
              <label class="switch">
                <input
                  type="checkbox"
                  id="noAlarmLock"
                  onchange="toggleSetting('no_alarm_lock', this.checked)" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-row">
              <span class="setting-label">Bluetooth broadcast</span>
              <label class="switch">
                <input
                  type="checkbox"
                  id="btBroadcast"
                  onchange="toggleSetting('bt_broadcast', this.checked)" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-row">
              <span class="setting-label">–ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏</span>
              <label class="switch">
                <input
                  type="checkbox"
                  id="buttonSpeedMode"
                  checked
                  onchange="toggleSetting('button_speed_mode', this.checked)" />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üîä –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞ –∏ —Å–≤–µ—Ç–∞</h3>
          <div style="margin-top: 20px">
            <div class="setting-row">
              <span class="setting-label">–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª</span>
              <label class="switch">
                <input
                  type="checkbox"
                  id="beepAlarm"
                  checked
                  onchange="toggleBeepAlarm(this.checked)" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-row">
              <span class="setting-label">–û–±—â–∏–π –∑–≤—É–∫</span>
              <label class="switch">
                <input
                  type="checkbox"
                  id="beepTotal"
                  checked
                  onchange="toggleBeepTotal(this.checked)" />
                <span class="slider"></span>
              </label>
            </div>

            <div class="setting-row">
              <span class="setting-label">–§–∞—Ä—ã</span>
              <label class="switch">
                <input
                  type="checkbox"
                  id="headlight"
                  checked
                  onchange="toggleHeadlight(this.checked)" />
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ -->
      <div id="research-tab" class="tab-content">
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤</h3>
          <p style="margin-bottom: 20px; color: var(--secondary)">
            –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ —Å–∞–º–æ–∫–∞—Ç–∞
          </p>

          <div class="scan-controls">
            <button class="scan-btn safe" onclick="startSafeScan()">
              üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—á—Ç–µ–Ω–∏–µ)
            </button>
            <button class="scan-btn warning" onclick="startBruteForceScan()">
              ‚ö†Ô∏è –ë—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞–ø–∏—Å—å)
            </button>
            <button class="scan-btn danger" onclick="startDeepScan()">
              üö® –ì–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            </button>
          </div>

          <div class="scan-progress">
            <div
              class="scan-progress-bar"
              id="scanProgress"
              style="width: 0%"></div>
          </div>

          <div style="text-align: center; margin: 10px 0">
            <span id="scanStatus">–ì–æ—Ç–æ–≤ –∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é</span>
            <span id="scanProgressText">0/256</span>
          </div>

          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 8px;
              margin-top: 20px;
            ">
            <input
              type="text"
              id="manualIndex"
              placeholder="–ò–Ω–¥–µ–∫—Å (hex)"
              style="
                padding: 12px;
                border: 1px solid var(--gray);
                border-radius: 8px;
                font-family: monospace;
                width: 100%;
                grid-column: 1;
              " />
            <input
              type="text"
              id="manualValue"
              placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ (hex)"
              style="
                padding: 12px;
                border: 1px solid var(--gray);
                border-radius: 8px;
                font-family: monospace;
                width: 100%;
                grid-column: 2;
              " />
            <button
              class="btn btn-primary"
              onclick="manualTest()"
              style="padding: 12px 16px; width: 100%; grid-column: 1 / span 2">
              –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
          </div>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üéØ –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã</h3>
          <div id="foundRegisters" style="max-height: 300px; overflow-y: auto">
            <p
              style="
                color: var(--secondary);
                text-align: center;
                padding: 20px;
              ">
              –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            </p>
          </div>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üìã –õ–æ–≥ –ø–∞–∫–µ—Ç–æ–≤</h3>
          <div style="margin-bottom: 15px; display: flex; gap: 8px">
            <button
              class="btn btn-primary"
              onclick="startPacketLog()"
              style="flex: 1">
              –ù–∞—á–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
            </button>
            <button
              class="btn btn-danger"
              onclick="stopPacketLog()"
              style="flex: 1">
              –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
            </button>
            <button
              class="btn"
              onclick="clearPacketLog()"
              style="flex: 1; background: var(--secondary); color: white">
              –û—á–∏—Å—Ç–∏—Ç—å
            </button>
          </div>
          <div
            id="packetLog"
            style="
              max-height: 200px;
              overflow-y: auto;
              background: var(--gray);
              padding: 10px;
              border-radius: 5px;
              font-family: monospace;
              font-size: 0.8rem;
            "></div>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üìã –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã</h3>
          <div class="unknown-registers">
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x51, –ö—É—Ä–æ–∫ –≥–∞–∑–∞:</div>
              <div class="register-value" id="UnkReg18">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x52, –¢–æ—Ä–º–æ–∑:</div>
              <div class="register-value" id="UnkReg19">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x2C(–ö–∞–∫ 56):</div>
              <div class="register-value" id="UnkReg8">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x4C(–Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è):</div>
              <div class="register-value" id="UnkReg15">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x54(–ö–∞–∫ 56):</div>
              <div class="register-value" id="UnkReg20">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x56(–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è1-5):</div>
              <div class="register-value" id="UnkReg21">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x57–Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è:</div>
              <div class="register-value" id="UnkReg22">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x66(–Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è):</div>
              <div class="register-value" id="UnkReg26">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">
                –†–µ–≥–∏—Å—Ç—Ä 0x7F(–Ω–µ —Ç—Ä–æ–≥–∞—Ç—å, –æ—à–∏–±–∫–∞ 32):
              </div>
              <div class="register-value" id="UnkReg28">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">
                –†–µ–≥–∏—Å—Ç—Ä 0x80(–§–∞—Ä–∞:0-–í—ã–∫–ª,1-–í–∫–ª,2-–°—Ç—Ä–æ–±):
              </div>
              <div class="register-value" id="UnkReg30">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x0:</div>
              <div class="register-value" id="UnkReg1">N/A</div>
            </div>
            <div class="register-item">
              <div class="register-label">–†–µ–≥–∏—Å—Ç—Ä 0x1:</div>
              <div class="register-value" id="UnkReg2">N/A</div>
            </div>
            <!-- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ -->
          </div>
        </div>
      </div>

      <!-- –°–∏—Å—Ç–µ–º–∞ -->
      <div id="system-tab" class="tab-content">
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üõ†Ô∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>
          <div class="grid-3" style="margin-top: 20px">
            <button
              class="btn btn-warning"
              onclick="sendCommand('find_scooter')">
              <span>üîç</span> –ù–∞–π—Ç–∏ —Å–∞–º–æ–∫–∞—Ç
            </button>
            <button class="btn btn-info" onclick="sendCommand('reboot')">
              <span>üîÑ</span> –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
            </button>
            <button class="btn btn-danger" onclick="sendCommand('power_off')">
              <span>‚≠ï</span> –í—ã–∫–ª—é—á–∏—Ç—å
            </button>
          </div>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üíª –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
          <div style="margin-top: 15px">
            <p>
              <strong>–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –ø–æ–¥—Å–≤–µ—Ç–∫–∏:</strong>
              <span id="currentLedMode">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
            </p>
            <p>
              <strong>–í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:</strong>
              <span id="fwVersion">N/A</span>
            </p>
            <p>
              <strong>–†–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞:</strong> <span id="workSystem">1</span>
            </p>
            <p>
              <strong>–°—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</strong>
              <span id="lockStatus">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
            </p>
            <p>
              <strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–≤–∏–≥–∞—Ç–µ–ª—è:</strong>
              <span id="engineStatus">–í–ö–õ</span>
            </p>
          </div>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
          <div style="margin-top: 15px">
            <p>
              <strong>–ö–æ–¥ –æ—à–∏–±–∫–∏:</strong> <span id="diagnosticError">0</span>
            </p>
            <p>
              <strong>–ö–æ–¥ —Ç—Ä–µ–≤–æ–≥–∏:</strong> <span id="diagnosticAlarm">0</span>
            </p>
            <p>
              <strong>–ë—É–ª–µ–≤—ã —Å—Ç–∞—Ç—É—Å—ã:</strong>
              <span id="diagnosticBool">0x0000</span>
            </p>
            <p>
              <strong>–ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞—Ç—É—Å—ã:</strong>
              <span id="diagnosticQuickBool">0x0000</span>
            </p>
            <button
              class="btn btn-primary"
              onclick="loadDiagnostics()"
              style="margin-top: 10px; width: 100%">
              –û–±–Ω–æ–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
            </button>
          </div>
        </div>
      </div>

      <!-- OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ -->
      <div id="ota-tab" class="tab-content">
        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üíª –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h3>
          <div id="systemInfo" style="margin-top: 15px">
            <p><strong>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</strong></p>
          </div>
          <button
            class="btn btn-primary"
            onclick="loadSystemInfo()"
            style="margin-top: 10px; width: 100%">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
          </button>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üöÄ OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏</h3>
          <div style="margin: 20px 0">
            <p>
              <strong>–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:</strong>
              <span id="currentVersion">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </p>
            <p>
              <strong>–°–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å:</strong> <span id="freeMemory">-</span>
            </p>
            <p><strong>ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> <span id="deviceId">-</span></p>
          </div>

          <div
            style="
              background: var(--gray);
              padding: 20px;
              border-radius: 10px;
              margin: 20px 0;
            ">
            <h4 style="margin-bottom: 15px">üì§ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h4>
            <p style="margin-bottom: 15px">
              –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ESP8266 –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
            </p>

            <div class="grid-2" style="margin-bottom: 15px">
              <a
                href="/update"
                target="_blank"
                class="btn btn-success"
                style="text-decoration: none; width: 100%">
                üì§ –û—Ç–∫—Ä—ã—Ç—å OTA –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
              </a>
              <button
                class="btn btn-info"
                onclick="checkForUpdates()"
                style="width: 100%">
                üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
              </button>
            </div>

            <div
              style="
                margin-top: 15px;
                font-size: 0.9rem;
                color: var(--secondary);
              ">
              <p><strong>–õ–æ–≥–∏–Ω:</strong> admin</p>
              <p><strong>–ü–∞—Ä–æ–ª—å:</strong> NinebotOTA123!</p>
            </div>
          </div>

          <div style="margin-top: 20px">
            <h4 style="margin-bottom: 15px">üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</h4>
            <form
              id="otaForm"
              action="/update"
              method="POST"
              enctype="multipart/form-data"
              target="_blank">
              <div style="margin: 15px 0">
                <label
                  style="
                    display: block;
                    margin-bottom: 10px;
                    font-weight: bold;
                  ">
                  üì§ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏ (.bin):
                </label>
                <input
                  type="file"
                  name="update"
                  accept=".bin"
                  required
                  style="
                    width: 100%;
                    padding: 10px;
                    border: 2px dashed var(--gray);
                    border-radius: 8px;
                    background: var(--card-bg);
                  " />
              </div>

              <button type="submit" class="btn btn-warning" style="width: 100%">
                ‚ö° –ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
              </button>
            </form>
          </div>
        </div>

        <div class="card animate-slide">
          <h3 style="margin-bottom: 16px">üìä –°—Ç–∞—Ç—É—Å OTA</h3>
          <div id="otaStatus" style="margin-top: 15px">
            <p>
              <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong>
              <span id="lastUpdate">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
            </p>
            <p>
              <strong>–°—Ç–∞—Ç—É—Å:</strong>
              <span id="updateStatus">–ì–æ—Ç–æ–≤ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é</span>
            </p>
          </div>

          <div class="grid-2" style="margin-top: 15px">
            <button
              class="btn btn-info"
              onclick="testOTAConnection()"
              style="width: 100%">
              üß™ –¢–µ—Å—Ç OTA —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            </button>
            <button
              class="btn btn-danger"
              onclick="showOTAInstructions()"
              style="width: 100%">
              üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="mobile-nav">
      <button class="mobile-nav-item active" onclick="switchTab('dashboard')">
        <span class="mobile-nav-icon">üìä</span>
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
      </button>
      <button class="mobile-nav-item" onclick="switchTab('lights')">
        <span class="mobile-nav-icon">üåà</span>
        <span>–°–≤–µ—Ç</span>
      </button>
      <button class="mobile-nav-item" onclick="switchTab('stats')">
        <span class="mobile-nav-icon">üìà</span>
        <span>–°—Ç–∞—Ç—ã</span>
      </button>
      <button class="mobile-nav-item" onclick="showActionSheet('more')">
        <span class="mobile-nav-icon">‚ãØ</span>
        <span>–ï—â–µ</span>
      </button>
    </div>

    <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –º–µ–Ω—é -->
    <div class="action-sheet" id="actionSheet">
      <div class="action-sheet-title" id="actionSheetTitle">–î–µ–π—Å—Ç–≤–∏—è</div>
      <div id="actionSheetContent">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
      <button class="action-sheet-cancel" onclick="hideActionSheet()">
        –û—Ç–º–µ–Ω–∞
      </button>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification">
      <div class="notification-icon">‚úÖ</div>
      <div id="notificationText">–ì–æ—Ç–æ–≤–æ</div>
    </div>

    <script>
      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      let isMobile =
        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent
        );
      let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      let currentTab = "dashboard";
      let autoRefreshInterval = null;
      let lastTapTime = 0;
      let scanActive = false;
      let isLocked = false;

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      document.addEventListener("DOMContentLoaded", function () {
        initApp();
        loadStatus();
        startAutoRefresh();

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω –¥–ª—è iOS
        if (isIOS) {
          setupIOSSafeAreas();
        }
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      function initApp() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤–∞–π–ø-–∫–æ–Ω—Ç—Ä–æ–ª—è
        initSwipeControl();

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
        setupDoubleTap();

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
        setupLongPress();

        const slider = document.getElementById("speedSlider");
        if (slider) {
          updateSpeedLimit(slider.value);
        }
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏

        updateSpeedLimit(35);
      }

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω –¥–ª—è iOS
      function setupIOSSafeAreas() {
        const style = document.createElement("style");
        style.textContent = `
        .mobile-header { padding-top: calc(12px + constant(safe-area-inset-top)) !important; }
        .sidebar { padding-top: calc(30px + constant(safe-area-inset-top)) !important; }
        .mobile-nav { padding-bottom: calc(8px + constant(safe-area-inset-bottom)) !important; }
        .action-sheet { padding-bottom: calc(20px + constant(safe-area-inset-bottom)) !important; }
      `;
        document.head.appendChild(style);
      }

      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª—å—é
      function toggleSidebar() {
        const sidebar = document.querySelector(".sidebar");
        const overlay = document.querySelector(".sidebar-overlay");

        if (sidebar.classList.contains("mobile-visible")) {
          sidebar.classList.remove("mobile-visible");
          overlay.classList.remove("active");
          document.body.style.overflow = "auto";
        } else {
          sidebar.classList.add("mobile-visible");
          overlay.classList.add("active");
          document.body.style.overflow = "hidden";
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤–∞–π–ø-–∫–æ–Ω—Ç—Ä–æ–ª—è
      function initSwipeControl() {
        const swipeHandle = document.getElementById("swipeHandle");
        const swipeTrack = document.querySelector(".swipe-track");
        const swipeProgress = document.getElementById("swipeProgress");

        let isDragging = false;
        let startX = 0;
        let currentX = 0;
        const maxSwipe = swipeTrack.offsetWidth - swipeHandle.offsetWidth;

        swipeHandle.addEventListener("touchstart", function (e) {
          e.preventDefault();
          isDragging = true;
          startX = e.touches[0].clientX;
          swipeHandle.style.transition = "none";
          swipeProgress.style.transition = "none";
        });

        swipeHandle.addEventListener("touchmove", function (e) {
          if (!isDragging) return;
          e.preventDefault();

          currentX = e.touches[0].clientX - startX;
          if (currentX < 0) currentX = 0;
          if (currentX > maxSwipe) currentX = maxSwipe;

          swipeHandle.style.transform = `translateX(${currentX}px)`;
          swipeProgress.style.width = `${(currentX / maxSwipe) * 100}%`;

          // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞
          if (currentX > maxSwipe * 0.5) {
            document.getElementById("swipeControl").style.background =
              "linear-gradient(135deg, var(--success), var(--info))";
          } else {
            document.getElementById("swipeControl").style.background =
              "linear-gradient(135deg, var(--accent), var(--info))";
          }
        });

        swipeHandle.addEventListener("touchend", function (e) {
          if (!isDragging) return;
          isDragging = false;

          swipeHandle.style.transition = "transform 0.3s ease";
          swipeProgress.style.transition = "width 0.3s ease";

          if (currentX > maxSwipe * 0.8) {
            // –£—Å–ø–µ—à–Ω—ã–π —Å–≤–∞–π–ø
            toggleLock();
            vibrate();
          }

          // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏
          setTimeout(() => {
            swipeHandle.style.transform = "translateX(0)";
            swipeProgress.style.width = "0%";
            document.getElementById("swipeControl").style.background =
              "linear-gradient(135deg, var(--accent), var(--info))";
          }, 300);
        });
      }

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
      function setupLongPress() {
        const elements = ["headlightBtn", "beepBtn"];

        elements.forEach((id) => {
          const element = document.getElementById(id);
          let pressTimer;

          element.addEventListener("touchstart", function (e) {
            pressTimer = setTimeout(() => {
              if (id === "headlightBtn") {
                showActionSheet("lights");
              } else if (id === "beepBtn") {
                showActionSheet("sound");
              }
              vibrate(50);
            }, 500);
          });

          element.addEventListener("touchend", function () {
            clearTimeout(pressTimer);
          });

          element.addEventListener("touchmove", function () {
            clearTimeout(pressTimer);
          });
        });
      }

      // –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ –º–µ–Ω—é
      function showActionSheet(type) {
        const sheet = document.getElementById("actionSheet");
        const title = document.getElementById("actionSheetTitle");
        const content = document.getElementById("actionSheetContent");

        let html = "";

        switch (type) {
          case "power":
            title.textContent = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏–µ–º";
            html = `
            <button class="action-sheet-item" onclick="sendCommand('reboot'); hideActionSheet();">
              <span>üîÑ</span>
              <span>–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</span>
            </button>
            <button class="action-sheet-item" onclick="sendCommand('power_off'); hideActionSheet();">
              <span>‚≠ï</span>
              <span>–í—ã–∫–ª—é—á–∏—Ç—å</span>
            </button>
          `;
            break;

          case "lights":
            title.textContent = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π";
            html = `
            <button class="action-sheet-item" onclick="setLedMode(0); hideActionSheet();">
              <span>‚ö™</span>
              <span>–í—ã–∫–ª—é—á–∏—Ç—å</span>
            </button>
            <button class="action-sheet-item" onclick="setLedMode(1); hideActionSheet();">
              <span>üåà</span>
              <span>–î—ã—Ö–∞–Ω–∏–µ</span>
            </button>
            <button class="action-sheet-item" onclick="setLedMode(5); hideActionSheet();">
              <span>‚ú®</span>
              <span>–ú–µ—Ä—Ü–∞–Ω–∏–µ</span>
            </button>
            <button class="action-sheet-item" onclick="setLedMode(7); hideActionSheet();">
              <span>üö®</span>
              <span>–ü–æ–ª–∏—Ü–∏—è</span>
            </button>
          `;
            break;

          case "sound":
            title.textContent = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–æ–º";
            html = `
            <button class="action-sheet-item" onclick="sendCommand('beep_toggle'); hideActionSheet();">
              <span>üîä</span>
              <span>–í–∫–ª/–í—ã–∫–ª –∑–≤—É–∫</span>
            </button>
            <button class="action-sheet-item" onclick="toggleBeepAlarm(true); hideActionSheet();">
              <span>üö®</span>
              <span>–í–∫–ª—é—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª</span>
            </button>
            <button class="action-sheet-item" onclick="toggleBeepTotal(false); hideActionSheet();">
              <span>üîá</span>
              <span>–í—ã–∫–ª—é—á–∏—Ç—å –≤—Å–µ –∑–≤—É–∫–∏</span>
            </button>
          `;
            break;

          case "more":
            title.textContent = "–ù–∞–≤–∏–≥–∞—Ü–∏—è";
            html = `
            <button class="action-sheet-item" onclick="switchTab('extended'); hideActionSheet();">
              <span>üîç</span>
              <span>–î–µ—Ç–∞–ª–∏</span>
            </button>
            <button class="action-sheet-item" onclick="switchTab('settings'); hideActionSheet();">
              <span>‚öôÔ∏è</span>
              <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </button>
            <button class="action-sheet-item" onclick="switchTab('research'); hideActionSheet();">
              <span>üî¨</span>
              <span>–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</span>
            </button>
            <button class="action-sheet-item" onclick="switchTab('ota'); hideActionSheet();">
              <span>üîÑ</span>
              <span>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
            </button>
            <button class="action-sheet-item" onclick="switchTab('system'); hideActionSheet();">
              <span>üíª</span>
              <span>–°–∏—Å—Ç–µ–º–∞</span>
            </button>
          `;
            break;
        }

        content.innerHTML = html;
        sheet.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function hideActionSheet() {
        const sheet = document.getElementById("actionSheet");
        sheet.classList.remove("active");
        document.body.style.overflow = "auto";
      }

      // –í–∏–±—Ä–∞—Ü–∏—è
      function vibrate(duration = 30) {
        if (navigator.vibrate) {
          navigator.vibrate(duration);
        }
      }

      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
      function switchTab(tabName) {
        // –ó–∞–∫—Ä—ã—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        // if (window.innerWidth <= 768) {
        //   toggleSidebar();
        // }

        // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
          tab.classList.remove("animate-slide");
        });

        // –°–∫—Ä—ã—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.querySelectorAll(".mobile-nav-item").forEach((item) => {
          item.classList.remove("active");
        });
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.classList.remove("active");
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
        const tabElement = document.getElementById(tabName + "-tab");
        if (tabElement) {
          tabElement.classList.add("active");
          setTimeout(() => {
            tabElement.classList.add("animate-slide");
          }, 10);

          // –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
          document.getElementById("mobileTitle").textContent =
            getTabTitle(tabName);

          // –ù–∞–π—Ç–∏ –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
          // –î–ª—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ (.nav-item)
          const navItems = document.querySelectorAll(".nav-item");
          const tabIndexMap = {
            dashboard: 0,
            extended: 1,
            lights: 2,
            stats: 3,
            settings: 4,
            research: 5,
            system: 6,
            ota: 7,
          };

          if (
            tabIndexMap[tabName] !== undefined &&
            navItems[tabIndexMap[tabName]]
          ) {
            navItems[tabIndexMap[tabName]].classList.add("active");
          }

          // –î–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (.mobile-nav-item)
          const mobileNavItems = document.querySelectorAll(".mobile-nav-item");
          const mobileTabIndexMap = {
            dashboard: 0,
            lights: 1,
            stats: 2,
            // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫ –º–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
          };

          if (
            mobileTabIndexMap[tabName] !== undefined &&
            mobileNavItems[mobileTabIndexMap[tabName]]
          ) {
            mobileNavItems[mobileTabIndexMap[tabName]].classList.add("active");
          }
        }

        currentTab = tabName;

        // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –Ω–∞—á–∞–ª—É
        document.querySelector(".main-content").scrollTop = 0;
      }

      function getTabTitle(tabName) {
        const titles = {
          dashboard: "–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
          extended: "–î–µ—Ç–∞–ª–∏",
          lights: "–ü–æ–¥—Å–≤–µ—Ç–∫–∞",
          stats: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
          settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
          research: "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
          system: "–°–∏—Å—Ç–µ–º–∞",
          ota: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ",
        };
        return titles[tabName] || "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ";
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
      // function updateMobileStatus(data) {
      //   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
      //   document.getElementById("batteryValue").innerHTML = `${
      //     data.battery || 0
      //   }<span class="value-unit">%</span>`;
      //   document.getElementById("speedValue").innerHTML = `${
      //     data.speed || 0
      //   }<span class="value-unit">–∫–º/—á</span>`;
      //   document.getElementById("tempValue").innerHTML = `${
      //     data.temperature || 0
      //   }<span class="value-unit">¬∞C</span>`;

      //   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
      //   document.getElementById("statusText").textContent =
      //     data.statusText || "–ó–∞–≥—Ä—É–∑–∫–∞...";

      //   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞
      //   document.getElementById("sidebarBattery").textContent = `${
      //     data.battery || 0
      //   }%`;
      //   document.getElementById("sidebarSpeed").textContent = `–°–∫–æ—Ä–æ—Å—Ç—å: ${
      //     data.speed || 0
      //   } –∫–º/—á`;

      //   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      //   if (data.isLocked !== undefined) {
      //     isLocked = data.isLocked;
      //     updateLockStatus(isLocked);
      //   }

      //   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
      //   if (data.connected) {
      //     document.getElementById("connectionStatus").style.background =
      //       "var(--success)";
      //     document.getElementById("connectionText").textContent = "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";
      //   } else {
      //     document.getElementById("connectionStatus").style.background =
      //       "var(--danger)";
      //     document.getElementById("connectionText").textContent = "–û—Ç–∫–ª—é—á–µ–Ω–æ";
      //   }
      // }

      function updateLockStatus(locked) {
        // 1. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
        const statusElement = document.getElementById("statusText");
        if (locked) {
          statusElement.textContent = "–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù";
          statusElement.style.color = "var(--danger)";
        } else {
          statusElement.textContent = "–†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù";
          statusElement.style.color = "var(--success)";
        }
      }

      function toggleLock() {
        if (isLocked) {
          sendCommand("unlock");
        } else {
          sendCommand("lock");
        }
        vibrate();
      }

      function toggleFunction(func) {
        sendCommand(func + "_toggle");
        vibrate();
      }

      function toggleCruise() {
        sendCommand("cruise_toggle");
        vibrate();
      }

      function updateSpeedLimit(value) {
        const limit = parseInt(value) * 10;
        document.getElementById("speedLimitValue").textContent =
          value + " –∫–º/—á";
        setSpeedLimit(limit);
      }

      // –§—É–Ω–∫—Ü–∏–∏ API –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞
      // async function loadStatus() {
      //   try {
      //     const [statusRes, dataRes] = await Promise.all([
      //       fetch('/status'),
      //       fetch('/data')
      //     ]);

      //     const statusData = await statusRes.json();
      //     const scooterData = await dataRes.json();

      //     if (statusData.success) {
      //       // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      //       updateMobileStatus({
      //         ...statusData,
      //         ...scooterData,
      //         battery: scooterData.battery || 0,
      //         speed: scooterData.speed || 0,
      //         temperature: scooterData.temperature || 0,
      //         connected: statusData.connected
      //       });

      //       // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –µ—Å–ª–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–µ
      //       if (currentTab === 'extended') {
      //         updateExtendedInfo(scooterData);
      //       }

      //       // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      //       if (currentTab === 'stats') {
      //         updateStats(scooterData);
      //       }

      //       // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
      //       if (currentTab === 'system') {
      //         updateSystemInfo(scooterData);
      //       }
      //     }
      //   } catch (error) {
      //     console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
      //     showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
      //   }
      // }

      // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è loadStatus()
      async function loadStatus() {
        try {
          const [statusRes, dataRes] = await Promise.all([
            fetch('/status'),
            fetch('/data')
          ]);
          
          // –î–û–ë–ê–í–¨–¢–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï:
          console.log('Status response:', statusRes);
          console.log('Data response:', dataRes);
          
          const statusData = await statusRes.json();
          const scooterData = await dataRes.json();
          
          console.log('Status JSON:', statusData);
          console.log('Scooter JSON:', scooterData);

          if (true) {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
            const batteryValue = scooterData.battery || 0;
            const actualRangeValue = scooterData.actualRange || 0;
            const tempValue = scooterData.temperature || 0;
            const speedValue = scooterData.speed || 0;
            // console.log('batteryValue', batteryValue);
            // console.log('actualRange:', actualRangeValue);
            // console.log('tempValue:', tempValue);

            // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –±–∞—Ç–∞—Ä–µ–∏
            document.getElementById(
              "batteryValue"
            ).innerHTML = `${batteryValue}<span class="value-unit">%</span>`;

            // –ù–û–í–û–ï: –û–±–Ω–æ–≤–ª—è–µ–º Material Design –±–∞—Ç–∞—Ä–µ—é
            updateMaterialBattery(
              batteryValue,
              scooterData.isCharging || false
            );

            document.getElementById(
              "actualRangeValue"
            ).innerHTML = `${actualRangeValue}<span class="value-unit">–∫–º</span>`;
            document.getElementById(
              "tempValue"
            ).innerHTML = `${tempValue}<span class="value-unit">¬∞C</span>`;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            document.getElementById("statusText").textContent =
              statusData.success || "–ó–∞–≥—Ä—É–∑–∫–∞...";

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞
            document.getElementById(
              "sidebarBattery"
            ).textContent = `${batteryValue}%`;
            document.getElementById(
              "sidebarSpeed"
            ).textContent = `–°–∫–æ—Ä–æ—Å—Ç—å: ${speedValue} –∫–º/—á`;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

            isLocked = statusData.isLocked;
            console.log('isLocked:', statusData.isLocked);
            updateLockStatus(isLocked);


            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            if (statusData.success) {
              document.getElementById("connectionStatus").style.background =
                "var(--success)";
              document.getElementById("connectionText").textContent =
                "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ";
            } else {
              document.getElementById("connectionStatus").style.background =
                "var(--danger)";
              document.getElementById("connectionText").textContent =
                "–û—Ç–∫–ª—é—á–µ–Ω–æ";
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –µ—Å–ª–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–µ
            if (currentTab === "extended") {
              updateExtendedInfo(scooterData);
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            if (currentTab === "stats") {
              updateStats(scooterData);
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
            if (currentTab === "system") {
              updateSystemInfo(scooterData);
            }
          }
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
          showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö", "error");
        }
      }

      async function sendCommand(cmd) {
        try {
          vibrate();
          const response = await fetch("/" + cmd);
          const data = await response.json();

          if (data.success) {
            showNotification(data.message || "–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞");
            setTimeout(loadStatus, 500);
          } else {
            showNotification("–û—à–∏–±–∫–∞: " + data.message, "error");
          }
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã:", error);
          showNotification("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", "error");
        }
      }

      function setSpeedLimit(limit) {
        fetch("/speed_limit?limit=" + limit)
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showNotification(
                "–õ–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " + limit / 10 + " –∫–º/—á"
              );
            } else {
              showNotification("–û—à–∏–±–∫–∞: " + data.message, "error");
            }
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–∏–º–∏—Ç–∞:", error);
            showNotification("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", "error");
          });
      }

      function setLedMode(mode) {
        fetch("/led_mode?mode=" + mode)
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showNotification("–†–µ–∂–∏–º –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω");
            } else {
              showNotification("–û—à–∏–±–∫–∞: " + data.message, "error");
            }
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏:", error);
            showNotification("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", "error");
          });
      }

    function setLedColor(colorIndex, color) {
      fetch('/led_color?index=' + colorIndex + '&color=' + color.toString(16))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification('–¶–≤–µ—Ç ' + colorIndex + ' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            updateColorButtons(colorIndex, color);
          } else {
            showNotification('–û—à–∏–±–∫–∞: ' + data.message, true);
          }
        })
        .catch(error => {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', true);
        });
    }

      function toggleBeepAlarm(enabled) {
        fetch("/beep_alarm?enabled=" + (enabled ? "1" : "0"))
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showNotification(
                enabled ? "–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –≤–∫–ª—é—á–µ–Ω" : "–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –≤—ã–∫–ª—é—á–µ–Ω"
              );
            }
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞:", error);
          });
      }

      function toggleBeepTotal(enabled) {
        fetch("/beep_total?enabled=" + (enabled ? "1" : "0"))
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showNotification(
                enabled ? "–û–±—â–∏–π –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω" : "–û–±—â–∏–π –∑–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω"
              );
            }
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ–±—â–µ–≥–æ –∑–≤—É–∫–∞:", error);
          });
      }

      function toggleSetting(setting, enabled) {
        fetch("/setting?name=" + setting + "&value=" + (enabled ? "1" : "0"))
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showNotification("–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞");
            }
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:", error);
          });
      }

      function toggleHeadlight(enabled) {
        fetch("/headlight?enabled=" + (enabled ? "1" : "0"))
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              showNotification(enabled ? "–§–∞—Ä—ã –≤–∫–ª—é—á–µ–Ω—ã" : "–§–∞—Ä—ã –≤—ã–∫–ª—é—á–µ–Ω—ã");
            }
          })
          .catch((error) => {
            console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞—Ä:", error);
          });
      }

      // –§—É–Ω–∫—Ü–∏–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      function startSafeScan() {
        if (scanActive) return;
        scanActive = true;
        showNotification("–ù–∞—á–∞—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "info");
        simulateScan();
      }

      function startBruteForceScan() {
        if (scanActive) return;
        scanActive = true;
        showNotification(
          "–í–Ω–∏–º–∞–Ω–∏–µ: –±—Ä—É—Ç—Ñ–æ—Ä—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø–∞—Å–Ω—ã–º!",
          "warning"
        );
        simulateScan();
      }

      function startDeepScan() {
        if (scanActive) return;
        scanActive = true;
        showNotification("–ù–∞—á–∞—Ç–æ –≥–ª—É–±–æ–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "info");
        simulateScan();
      }

      function simulateScan() {
        const progressBar = document.getElementById("scanProgress");
        const progressText = document.getElementById("scanProgressText");
        const scanStatus = document.getElementById("scanStatus");
        const foundRegisters = document.getElementById("foundRegisters");

        let progress = 0;
        const total = 256;

        scanStatus.textContent = "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...";

        const interval = setInterval(() => {
          progress += 4;
          if (progress > total) progress = total;

          progressBar.style.width = (progress / total) * 100 + "%";
          progressText.textContent = progress + "/" + total;

          if (progress >= total) {
            clearInterval(interval);
            scanActive = false;
            scanStatus.textContent = "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ";
            showNotification("–ù–∞–π–¥–µ–Ω–æ 15 –Ω–æ–≤—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤", "success");

            // –ü—Ä–∏–º–µ—Ä –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
            foundRegisters.innerHTML = `
            <div style="padding: 10px; background: var(--success); color: white; border-radius: 8px; margin-bottom: 10px;">
              <strong>–†–µ–≥–∏—Å—Ç—Ä 0x51</strong>: –ö—É—Ä–æ–∫ –≥–∞–∑–∞ (0x0000 - 0xFFFF)
            </div>
            <div style="padding: 10px; background: var(--info); color: white; border-radius: 8px; margin-bottom: 10px;">
              <strong>–†–µ–≥–∏—Å—Ç—Ä 0x52</strong>: –¢–æ—Ä–º–æ–∑ (0x0000 - 0xFFFF)
            </div>
            <div style="padding: 10px; background: var(--warning); color: var(--dark); border-radius: 8px; margin-bottom: 10px;">
              <strong>–†–µ–≥–∏—Å—Ç—Ä 0x80</strong>: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞—Ä–∞–º–∏ (0-2)
            </div>
          `;
          }
        }, 50);
      }

      function manualTest() {
        const index = document.getElementById("manualIndex").value;
        const value = document.getElementById("manualValue").value;

        // –í–∞–ª–∏–¥–∞—Ü–∏—è hex –∑–Ω–∞—á–µ–Ω–∏—è
        if (!/^0x[0-9A-Fa-f]{1,2}$/.test(index)) {
          showNotification("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–Ω–¥–µ–∫—Å–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞", "error");
          return;
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è
        if (value && !/^0x[0-9A-Fa-f]{1,4}$/.test(value)) {
          showNotification("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è", "error");
          return;
        }

        if (!index) {
          showNotification("–í–≤–µ–¥–∏—Ç–µ –∏–Ω–¥–µ–∫—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞", "error");
          return;
        }

        showNotification(
          `–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞ ${index} —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º ${value || "—á—Ç–µ–Ω–∏–µ"}`,
          "info"
        );

        // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        setTimeout(() => {
          showNotification("–¢–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ", "success");
        }, 1000);
      }

      function startPacketLog() {
        showNotification("–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞—á–∞—Ç–æ", "info");
      }

      function stopPacketLog() {
        showNotification("–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ", "info");
      }

      function clearPacketLog() {
        document.getElementById("packetLog").innerHTML = "";
        showNotification("–õ–æ–≥ –æ—á–∏—â–µ–Ω", "info");
      }

      function loadDiagnostics() {
        // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        showNotification("–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞", "info");
      }

      function loadSystemInfo() {
        // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ
        showNotification("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞", "info");
      }

      function checkForUpdates() {
        showNotification("–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...", "info");
        setTimeout(() => {
          showNotification("–û–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", "info");
        }, 2000);
      }

      function testOTAConnection() {
        showNotification("–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OTA —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...", "info");
        setTimeout(() => {
          showNotification("OTA —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç", "success");
        }, 1500);
      }

      function showOTAInstructions() {
        showNotification(
          "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ",
          "info"
        );
        window.open("/ota_instructions", "_blank");
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
      function updateExtendedInfo(data) {
        const elements = [
          "driveVoltageValue",
          "motorCurrentValue",
          "powerValue",
          "avgSpeedValue",
          "bodyTempValue",
          "bat1TempValue",
          "bat2TempValue",
          "mosTempValue",
          "battery1Value",
          "battery2Value",
          "actualRangeValue",
          "predictedRangeValue",
          "serialValue",
          "bmsVersionValue",
          "bms2VersionValue",
          "bleVersionValue",
          "boolStatusValue",
          "alarmStatusValue",
          "errorValue",
        ];

        elements.forEach((id) => {
          const element = document.getElementById(id);
          if (element && data[id]) {
            element.textContent = data[id];
          }
        });
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      function updateStats(data) {
        const elements = [
          "singleMileageValue",
          "singleRideTimeValue",
          "totalOperationTimeValue",
          "totalRideTimeValue",
          "workModeValue",
          "speedLimitValue",
          "errorCodeValue",
          "cruiseValue",
          "headlightValue",
          "beepValue",
        ];

        elements.forEach((id) => {
          const element = document.getElementById(id);
          if (element && data[id]) {
            element.textContent = data[id];
          }
        });
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
      function updateSystemInfo(data) {
        const elements = [
          "currentLedMode",
          "fwVersion",
          "workSystem",
          "lockStatus",
          "engineStatus",
          "diagnosticError",
          "diagnosticAlarm",
          "diagnosticBool",
          "diagnosticQuickBool",
        ];

        elements.forEach((id) => {
          const element = document.getElementById(id);
          if (element && data[id]) {
            element.textContent = data[id];
          }
        });
      }

      // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
      function startAutoRefresh() {
        autoRefreshInterval = setInterval(loadStatus, 3000);
      }

      function toggleDataRefresh() {
        if (autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
          autoRefreshInterval = null;
          showNotification("–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ", "warning");
        } else {
          startAutoRefresh();
          showNotification("–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ", "success");
        }
      }

      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      function showNotification(message, type = "info") {
        const notification = document.getElementById("notification");
        const text = document.getElementById("notificationText");
        const icon = notification.querySelector(".notification-icon");

        text.textContent = message;
        notification.className = `notification ${type}`;

        switch (type) {
          case "error":
            icon.textContent = "‚ùå";
            break;
          case "warning":
            icon.textContent = "‚ö†Ô∏è";
            break;
          case "success":
            icon.textContent = "‚úÖ";
            break;
          default:
            icon.textContent = "‚ÑπÔ∏è";
        }

        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, 3000);
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
      window.addEventListener("online", () => {
        showNotification("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ", "success");
        loadStatus();
      });

      window.addEventListener("offline", () => {
        showNotification("–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", "error");
      });

      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–Ω–∞ —ç–∫—Ä–∞–Ω–∞ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
      let wakeLock = null;
      if ("wakeLock" in navigator && isMobile) {
        try {
          navigator.wakeLock.request("screen").then((wl) => {
            wakeLock = wl;
          });
        } catch (err) {
          console.log("Wake Lock –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
        }
      }

      // –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ Wake Lock –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
      window.addEventListener("beforeunload", () => {
        if (wakeLock) {
          wakeLock.release();
          wakeLock = null;
        }
      });

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
      window.addEventListener("resize", function () {
        // –ó–∞–∫—Ä—ã—Ç—å –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö
        if (window.innerWidth > 768) {
          const sidebar = document.querySelector(".sidebar");
          const overlay = document.querySelector(".sidebar-overlay");
          sidebar.classList.remove("mobile-visible");
          overlay.classList.remove("active");
          document.body.style.overflow = "auto";
        }
      });

      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
      if (isMobile) {
        document.addEventListener("contextmenu", function (e) {
          e.preventDefault();
        });
      }

      function updateMaterialBattery(percent, isCharging = false) {
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
        const battery = document.getElementById("materialBattery");
        const fill = document.getElementById("materialBatteryFill");
        const percentText = document.getElementById("materialBatteryPercent");

        // –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å
        if (fill) fill.style.width = `${percent}%`;
        if (percentText) percentText.textContent = `${percent}%`;

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å—ã
        if (battery) {
          battery.classList.remove("charging", "low");
          battery.removeAttribute("data-theme");

          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
          if (isCharging) {
            battery.classList.add("charging");
            battery.setAttribute("data-theme", "green");
          } else {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è
            if (percent > 50) {
              battery.setAttribute("data-theme", "green");
            } else if (percent > 20) {
              battery.setAttribute("data-theme", "yellow");
            } else {
              battery.setAttribute("data-theme", "red");
              battery.classList.add("low");
            }
          }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è —Ö–µ–¥–µ—Ä–∞
        updateCompactBattery(percent, isCharging);
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π –±–∞—Ç–∞—Ä–µ–∏
      function updateCompactBattery(percent, isCharging = false) {
        const compactBattery = document.getElementById("headerBattery");
        const compactFill = document.getElementById("compactBatteryFill");
        const compactText = document.getElementById("compactBatteryText");
        const boltIcon = document.getElementById("chargingBoltIcon");

        if (compactFill) compactFill.style.width = `${percent}%`;
        if (compactText) compactText.textContent = `${percent}%`;

        if (compactBattery) {
          compactBattery.classList.remove("charging", "low");

          if (isCharging) {
            compactBattery.classList.add("charging");
            if (boltIcon) boltIcon.style.display = "inline";
          } else {
            if (boltIcon) boltIcon.style.display = "none";

            if (percent < 20) {
              compactBattery.classList.add("low");
            }
          }
        }
      }

      if (history.scrollRestoration) {
        history.scrollRestoration = 'manual';
      }

      window.addEventListener('load', function() {
        // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
        setTimeout(function() {
          window.scrollTo(0, 0);
        }, 100);
      });
      
    </script>
  </body>
</html>
